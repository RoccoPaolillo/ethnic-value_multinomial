plot mean [count (turtles-on neighbors) with [abs (color - [color] of myself) = 3 or (color - [color] of myself) = 0 ] / count (turtles-on neighbors)] of turtles with [ count (turtles-on neighbors) >= 1]
plot mean [count (turtles-on neighbors) with [shape = [shape] of myself] / count (turtles-on neighbors) ] of turtles with [ count (turtles-on neighbors) >= 1]
plot mean [count (turtles-on neighbors) with [color mod 2 = [color] of myself mod 2] / count (turtles-on neighbors)] of turtles with [count (turtles-on neighbors) >= 1]
plot mean [utility_myself] of turtles



((count turtles with [color = 108 or color = 105 and shape = "circle" and color mod 2 = 0]) / count turtles) * 100
((count turtles with [color = 108 or color = 105 and shape = "square" and color mod 2 = 0]) / count turtles) * 100
((count turtles with [color = 108 or color = 105 and shape = "circle"  and color mod 2 = 1]) / count turtles) * 100
((count turtles with [color = 108 or color = 105 and shape = "square"  and color mod 2 = 1]) / count turtles) * 100

((count turtles with [color = 28 or color = 25 and shape = "circle" and color mod 2 = 0]) / count turtles) * 100
((count turtles with [color = 28 or color = 25 and shape = "square" and color mod 2 = 0]) / count turtles) * 100
((count turtles with [color = 28 or color = 25 and shape = "circle"  and color mod 2 = 1]) / count turtles) * 100
((count turtles with [color = 28 or color = 25 and shape = "square"  and color mod 2 = 1]) / count turtles) * 100

(count turtles with [color = 28 or color = 25 and shape = "circle"] / count turtles with [color = 28 or color = 25]) * 100
(count turtles with [color = 28 or color = 25 and color mod = 0] / count turtles  with [color = 28 or color = 25]) * 100


plot mean [count (turtles-on neighbors) with [abs (color - [color] of myself) = 3 or (color - [color] of myself) = 0 ] / count (turtles-on neighbors)] of turtles with [shape = "circle" and count (turtles-on neighbors) >= 1]
plot mean [count (turtles-on neighbors) with [shape = [shape] of myself] / count (turtles-on neighbors) ] of turtles with [shape = "circle" and  count (turtles-on neighbors) >= 1]
plot mean [count (turtles-on neighbors) with [color mod 2 = [color] of myself mod 2] / count (turtles-on neighbors)] of turtles with [shape = "circle" and count (turtles-on neighbors) >= 1]
plot mean [utility_myself] of turtles with [shape = "circle"]


plot mean [count (turtles-on neighbors) with [abs (color - [color] of myself) = 3 or (color - [color] of myself) = 0 ] / count (turtles-on neighbors)] of turtles with [shape = "square" and count (turtles-on neighbors) >= 1]
plot mean [count (turtles-on neighbors) with [shape = [shape] of myself] / count (turtles-on neighbors) ] of turtles with [shape = "square" and  count (turtles-on neighbors) >= 1]
plot mean [count (turtles-on neighbors) with [color mod 2 = [color] of myself mod 2] / count (turtles-on neighbors)] of turtles with [shape = "square" and count (turtles-on neighbors) >= 1]
plot mean [utility_myself] of turtles with [shape = "square"]


plot mean [count (turtles-on neighbors) with [abs (color - [color] of myself) = 3 or (color - [color] of myself) = 0 ] / count (turtles-on neighbors)] of turtles with [color mod 2 = 0 and count (turtles-on neighbors) >= 1]
plot mean [count (turtles-on neighbors) with [shape = [shape] of myself] / count (turtles-on neighbors) ] of turtles with [color mod 2 = 0 and  count (turtles-on neighbors) >= 1]
plot mean [count (turtles-on neighbors) with [color mod 2 = [color] of myself mod 2] / count (turtles-on neighbors)] of turtles with [color mod 2 = 0 and count (turtles-on neighbors) >= 1]
plot mean [utility_myself] of turtles with [color mod 2 = 0]

plot mean [count (turtles-on neighbors) with [abs (color - [color] of myself) = 3 or (color - [color] of myself) = 0 ] / count (turtles-on neighbors)] of turtles with [color mod 2 = 1 and count (turtles-on neighbors) >= 1]
plot mean [count (turtles-on neighbors) with [shape = [shape] of myself] / count (turtles-on neighbors) ] of turtles with [color mod 2 = 1 and  count (turtles-on neighbors) >= 1]
plot mean [count (turtles-on neighbors) with [color mod 2 = [color] of myself mod 2] / count (turtles-on neighbors)] of turtles with [color mod 2 = 1 and count (turtles-on neighbors) >= 1]
plot mean [utility_myself] of turtles with [color mod 2 = 1]


-----


set uti_eth ifelse-value (ethnic_peak = 0 and (xe / n) = 0) [1][ ifelse-value (n = 0) 
        [0]
        [ifelse-value ((xe / n) <= [ethnic_peak] of myself) [(xe / n) / [ethnic_peak] of myself] [M + (( (1 - (xe / n)) * (1 - M)) / (1 - [ethnic_peak] of myself))]
      ]
      ]     ; ethnic utility
      
      set uti_val ifelse-value (value_peak = 0 and (xv / n) = 0) [1][ifelse-value (n = 0) 
        [0]
        [ifelse-value ((xv / n) <= [value_peak] of myself) [(xv / n) / [value_peak] of myself] [M + (( (1 - (xv / n)) * (1 - M)) / (1 - [value_peak] of myself))]
        ]
        ]        ; value utility
      
      
      set uti_ses ifelse-value (ses_peak = 0 and (xs / n) = 0) [1][ifelse-value (n = 0)
      [0]
      [ifelse-value  ((xs / n) <= [ses_peak] of myself) [(xs / n) / [ses_peak] of myself] [M + (( (1 - (xs / n)) * (1 - M)) / (1 - [ses_peak] of myself))]
        ]
        ]

---------------
"blu-hig-sqr"

if subgroup = "blu-hig-sqr" [plot mean [count (turtles-on neighbors) with [abs (color - [color] of myself) = 3 or (color - [color] of myself) = 0 ] / count (turtles-on neighbors)] of
 turtles with [color = 108 or color = 105 and shape = "square" and color mod 2 = 0 and count (turtles-on neighbors) >= 1]]

if subgroup = "blu-hig-sqr" [plot mean [count (turtles-on neighbors) with [shape = [shape] of myself] / count (turtles-on neighbors) ] of 
turtles with [ color = 108 or color = 105 and shape = "square" and color mod 2 = 0 and count (turtles-on neighbors) >= 1]]

if subgroup = "blu-hig-sqr" [plot mean [count (turtles-on neighbors) with [color mod 2 = [color] of myself mod 2] / count (turtles-on neighbors)] of 
turtles with [color = 108 or color = 105 and shape = "square" and color mod 2 = 0 and count (turtles-on neighbors) >= 1]]

if subgroup = "blu-hig-sqr" [plot mean [utility_myself] of turtles with [color = 108 or color = 105 and shape = "square" and color mod 2 = 0 and count (turtles-on neighbors) >= 1]]

"blu-low-sqr"

if subgroup = "blu-low-sqr" [plot mean [count (turtles-on neighbors) with [abs (color - [color] of myself) = 3 or (color - [color] of myself) = 0 ] / count (turtles-on neighbors)] of
 turtles with [color = 108 or color = 105 and shape = "square" and color mod 2 = 1 and count (turtles-on neighbors) >= 1]]

if subgroup = "blu-low-sqr" [plot mean [count (turtles-on neighbors) with [shape = [shape] of myself] / count (turtles-on neighbors) ] of 
turtles with [ color = 108 or color = 105 and shape = "square" and color mod 2 = 1 and count (turtles-on neighbors) >= 1]]

if subgroup = "blu-low-sqr" [plot mean [count (turtles-on neighbors) with [color mod 2 = [color] of myself mod 2] / count (turtles-on neighbors)] of
 turtles with [color = 108 or color = 105 and shape = "square" and color mod 2 = 1 and count (turtles-on neighbors) >= 1]]

if subgroup = "blu-low-sqr" [plot mean [utility_myself] of turtles with [color = 108 or color = 105 and shape = "square" and color mod 2 = 1 and count (turtles-on neighbors) >= 1]]

----

"blu-hig-crl"

if subgroup = "blu-hig-crl" [plot mean [count (turtles-on neighbors) with [abs (color - [color] of myself) = 3 or (color - [color] of myself) = 0 ] / count (turtles-on neighbors)] of 
turtles with [color = 108 or color = 105 and shape = "circle" and color mod 2 = 0 and count (turtles-on neighbors) >= 1]]

if subgroup = "blu-hig-crl" [plot mean [count (turtles-on neighbors) with [shape = [shape] of myself] / count (turtles-on neighbors) ] of 
turtles with [ color = 108 or color = 105 and shape = "circle" and color mod 2 = 0 and count (turtles-on neighbors) >= 1]]

if subgroup = "blu-hig-crl" [plot mean [count (turtles-on neighbors) with [color mod 2 = [color] of myself mod 2] / count (turtles-on neighbors)] of
 turtles with [color = 108 or color = 105 and shape = "circle" and color mod 2 = 0 and count (turtles-on neighbors) >= 1]]

if subgroup = "blu-hig-crl" [plot mean [utility_myself] of turtles with [color = 108 or color = 105 and shape = "circle" and color mod 2 = 0 and count (turtles-on neighbors) >= 1]]

"blu-low-crl"

if subgroup = "blu-low-crl" [plot mean [count (turtles-on neighbors) with [abs (color - [color] of myself) = 3 or (color - [color] of myself) = 0 ] / count (turtles-on neighbors)] of
 turtles with [color = 108 or color = 105 and shape = "circle" and color mod 2 = 1 and count (turtles-on neighbors) >= 1]]

if subgroup = "blu-low-crl" [plot mean [count (turtles-on neighbors) with [shape = [shape] of myself] / count (turtles-on neighbors) ] of 
turtles with [ color = 108 or color = 105 and shape = "circle" and color mod 2 = 1 and count (turtles-on neighbors) >= 1]]

if subgroup = "blu-low-crl" [plot mean [count (turtles-on neighbors) with [color mod 2 = [color] of myself mod 2] / count (turtles-on neighbors)] of
 turtles with [color = 108 or color = 105 and shape = "circle" and color mod 2 = 1 and count (turtles-on neighbors) >= 1]]

if subgroup = "blu-low-crl" [plot mean [utility_myself] of turtles with [color = 108 or color = 105 and shape = "circle" and color mod 2 = 1 and count (turtles-on neighbors) >= 1]]

----orange-------------------

"org-hig-sqr"

if subgroup = "org-hig-sqr" [plot mean [count (turtles-on neighbors) with [abs (color - [color] of myself) = 3 or (color - [color] of myself) = 0 ] / count (turtles-on neighbors)] of
 turtles with [color = 28 or color = 25 and shape = "square" and color mod 2 = 0 and count (turtles-on neighbors) >= 1]]

if subgroup = "org-hig-sqr" [plot mean [count (turtles-on neighbors) with [shape = [shape] of myself] / count (turtles-on neighbors) ] of 
turtles with [ color = 28 or color = 25  and shape = "square" and color mod 2 = 0 and count (turtles-on neighbors) >= 1]]

if subgroup = "org-hig-sqr" [plot mean [count (turtles-on neighbors) with [color mod 2 = [color] of myself mod 2] / count (turtles-on neighbors)] of 
turtles with [color = 28 or color = 25 and shape = "square" and color mod 2 = 0 and count (turtles-on neighbors) >= 1]]

if subgroup = "org-hig-sqr" [plot mean [utility_myself] of turtles with [color = 28 or color = 25 and shape = "square" and color mod 2 = 0 and count (turtles-on neighbors) >= 1]]

"org-low-sqr"

if subgroup = "org-low-sqr" [plot mean [count (turtles-on neighbors) with [abs (color - [color] of myself) = 3 or (color - [color] of myself) = 0 ] / count (turtles-on neighbors)] of
 turtles with [color = 28 or color = 25 and shape = "square" and color mod 2 = 1 and count (turtles-on neighbors) >= 1]]

if subgroup = "org-low-sqr" [plot mean [count (turtles-on neighbors) with [shape = [shape] of myself] / count (turtles-on neighbors) ] of 
turtles with [color = 28 or color = 25 and shape = "square" and color mod 2 = 1 and count (turtles-on neighbors) >= 1]]

if subgroup = "org-low-sqr" [plot mean [count (turtles-on neighbors) with [color mod 2 = [color] of myself mod 2] / count (turtles-on neighbors)] of
 turtles with [color = 28 or color = 25 and shape = "square" and color mod 2 = 1 and count (turtles-on neighbors) >= 1]]

if subgroup = "org-low-sqr" [plot mean [utility_myself] of turtles with [color = 28 or color = 25 and shape = "square" and color mod 2 = 1 and count (turtles-on neighbors) >= 1]]

---
--
-

"org-hig-crl"

if subgroup = "org-hig-crl" [plot mean [count (turtles-on neighbors) with [abs (color - [color] of myself) = 3 or (color - [color] of myself) = 0 ] / count (turtles-on neighbors)] of
 turtles with [color = 28 or color = 25 and shape = "circle" and color mod 2 = 0 and count (turtles-on neighbors) >= 1]]

if subgroup = "org-hig-crl" [plot mean [count (turtles-on neighbors) with [shape = [shape] of myself] / count (turtles-on neighbors) ] of 
turtles with [ color = 28 or color = 25  and shape = "circle" and color mod 2 = 0 and count (turtles-on neighbors) >= 1]]

if subgroup = "org-hig-crl" [plot mean [count (turtles-on neighbors) with [color mod 2 = [color] of myself mod 2] / count (turtles-on neighbors)] of 
turtles with [color = 28 or color = 25 and shape = "circle" and color mod 2 = 0 and count (turtles-on neighbors) >= 1]]

if subgroup = "org-hig-crl" [plot mean [utility_myself] of turtles with [color = 28 or color = 25 and shape = "circle" and color mod 2 = 0 and count (turtles-on neighbors) >= 1]]

"org-low-crl"

if subgroup = "org-low-crl" [plot mean [count (turtles-on neighbors) with [abs (color - [color] of myself) = 3 or (color - [color] of myself) = 0 ] / count (turtles-on neighbors)] of
 turtles with [color = 28 or color = 25 and shape = "circle" and color mod 2 = 1 and count (turtles-on neighbors) >= 1]]

if subgroup = "org-low-crl" [plot mean [count (turtles-on neighbors) with [shape = [shape] of myself] / count (turtles-on neighbors) ] of 
turtles with [color = 28 or color = 25 and shape = "circle" and color mod 2 = 1 and count (turtles-on neighbors) >= 1]]

if subgroup = "org-low-crl" [plot mean [count (turtles-on neighbors) with [color mod 2 = [color] of myself mod 2] / count (turtles-on neighbors)] of
 turtles with [color = 28 or color = 25 and shape = "circle" and color mod 2 = 1 and count (turtles-on neighbors) >= 1]]

if subgroup = "org-low-crl" [plot mean [utility_myself] of turtles with [color = 28 or color = 25 and shape = "circle" and color mod 2 = 1 and count (turtles-on neighbors) >= 1]]
