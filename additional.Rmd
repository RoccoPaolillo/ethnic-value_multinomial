 ---
title: "additional3D"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

setwd("C:/Users/rocpa/OneDrive/Desktop/AF/ethnic-value_multinomial-master/additional/")

library(dplyr)
library(ggplot2)
library(plotly)
library(scatterplot3d)
library(reshape)
library(reshape2)
library(tidyr)
library(forcats)
library(plot3D)
library(xlsx)


valueminority.labs <- c("ß value liberals minority: 0", "ß value liberals minority: 1", "ß value liberals minority: 7")
names(valueminority.labs) <- c("0","1","7")
valuemajority.labs <- c("ß value liberals majority: 0", "ß value liberals majority: 1", "ß value liberals majority: 7")
names(valuemajority.labs) <- c("0","1","7")
ethnicminority.labs <- c("ß ethnic liberals minority: 0", "ß ethnic liberals minority: 1", "ß ethnic liberals minority: 7")
names(ethnicminority.labs) <- c("0","1","7")
ethnicmajority.labs <- c("ß ethnic liberals majority: 0", "ß ethnic liberals majority: 1", "ß ethnic liberals majority: 7")
names(ethnicmajority.labs) <- c("0","1","7")
ethnicity.labs <- c("50% Majority", "60% Majority","70% Majority","80% Majority","90% Majority")
names(ethnicity.labs) <- c("50","60","70","80","90")

mech <- read.csv("mech_lib.csv",sep=",")
excl <- names(mech) %in% c("run", "density","step")
mech <- mech[!excl] %>% group_by(eth_con_loc, eth_con_min,eth_lib_loc,eth_lib_min,val_lib_loc,val_lib_min,val_con_loc,val_con_min,circle_orange,circle_blue,fraction_blue) %>% summarise_all(mean)



df_3D <- read.csv("3D.csv",sep=",")
excl3D <- names(df_3D) %in% c("run", "density","step")
df_3D <- df_3D[!excl3D] %>% group_by(eth_con_loc, eth_con_min,eth_lib_loc,eth_lib_min,val_lib_loc,val_lib_min,val_con_loc,val_con_min,circle_orange,circle_blue,fraction_blue) %>% summarise_all(mean)

df_etlib <- read.csv("df_etlib_all.csv",sep=",")
excl <- names(df_etlib) %in% c("run", "density","step")
df_etlib <- df_etlib[!excl] %>% group_by(ID,eth_con_loc,eth_con_min,eth_lib_loc,eth_lib_min,val_lib_loc,val_lib_min,val_con_loc,val_con_min,circle_orange,circle_blue,fraction_blue) %>% summarise_all(mean)



df_sec <- read.csv("df_secondary.csv",sep=",")
exclet <- names(df_sec) %in% c("run", "density","step")
df_sec <- df_sec[!exclet] %>% group_by(ID,RND,eth_con_loc,eth_con_min,eth_lib_loc,eth_lib_min,val_lib_loc,val_lib_min,val_con_loc,val_con_min,circle_orange,circle_blue,fraction_blue) %>% summarise_all(mean)

df_3Do <- read.csv("3D_old.csv",sep=",")
excl3D <- names(df_3Do) %in% c("run", "density","step")
df_3Do <- df_3Do[!excl3D] %>% group_by(eth_con_loc, eth_con_min,eth_lib_loc,eth_lib_min,val_lib_loc,val_lib_min,val_con_loc,val_con_min,circle_orange,circle_blue,fraction_blue) %>% summarise_all(mean)


# value_dominant_den <- read.csv("dom_sqr_2.csv",skip = 6,sep = ",")
# leg <- read.csv("leg_value_dominant_den.csv",sep=";")
# 
# value_dominant_den$ID <- "square"
# value_dominant_den2 <- read.csv("dom_crl_2.csv",skip = 6,sep = ",")
# names(value_dominant_den2) <- leg[,1]
# value_dominant_den2$ID <- "circle"
# 
# value_dominant_den <- rbind(value_dominant_den,value_dominant_den2)
# 
# write.csv(value_dominant_den,"value_dominant_den.csv",row.names = F)


value_basic_den <- read.csv("value_basic_den.csv",sep = ",")
excl <- names(value_basic_den) %in% c("run","density","step")
value_basic_den <- value_basic_den[!excl] %>% group_by(ID,fraction_blue,circle_blue,circle_orange,circle,square) %>% summarise_all(mean)









value_dominant_den <- read.csv("value_dominant_den.csv",sep = ",")
excl <- names(value_dominant_den) %in% c("run","density","step")
value_dominant_den <- value_dominant_den[!excl] %>% group_by(ID,fraction_blue,circle_blue,circle_orange,dominant_square,dominant_circle,secondary_square,secondary_circle) %>% summarise_all(mean) 


dv <- c("step",
"et_sq",
"et_cl",
"vl_sq",
"vl_cl",
"et_sq_bl",
"et_cl_bl",
"et_sq_or",
"et_cl_or",
"vl_sq_bl",
"vl_cl_bl",
"vl_sq_or",
"vl_cl_or",
"den_sq_bl",
"den_sq_or",
"den_cl_bl",
"den_cl_or",
"den_sq",
"den_cl",
"de_sq_bl",
"de_cl_bl",
"de_sq_or",
"de_cl_or",
"dv_sq_bl",
"dv_cl_bl",
"dv_sq_or",
"dv_cl_or")
```

```{r test_val-eth, fig.cap= "Checking effect of lvalue liberal = ethnic liberal" echo =  FALSE}

# equal size; liberals: value = ethnic

df <- read.csv("val_eth_circle3.csv",skip=6,sep=",")
lg <- read.csv("lg_val_eth_circle3.csv",sep =";")
names(df) <- lg[,1]

df <- df %>%  gather(key = subgroup, value = Segra, et_sq,vl_sq,et_cl,vl_cl,den_sq,den_cl)  %>% mutate(
`outcome` = fct_relevel(fct_collapse(subgroup,"Ethnic Segregation" = c("et_sq","et_cl"), "Value Segregation" = c("vl_sq","vl_cl"), "Density" = c("den_sq","den_cl")),"Ethnic Segregation"), 
`orientation` = fct_relevel(fct_collapse(subgroup,"Conservatives" = c("et_sq","vl_sq","den_sq"), "Liberals" = c("et_cl","vl_cl","den_cl")), "Conservatives"))

df %>% filter(dominant_square == circle_both) %>% ggplot(aes(x= circle_both,y = Segra, color = `outcome`, shape = `orientation`)) + geom_point() + geom_line() +
  scale_color_manual(values = c("green","gray","purple"), guide = guide_legend(title = "Outcome")) +
  scale_shape_manual(values = c("square","circle"), guide = guide_legend(title = "Orientation"))  +
  scale_y_continuous(limits=c(0.45,1), breaks=seq(0.5,1,by=0.1)) +
  xlab("ß value liberals = ß ethnic liberals") +
  ylab("Outcome") +
  theme_bw()+
  theme(legend.position = "bottom")

```


```{r test_val-maj, fig.cap= "Checking effect of value liberal = ethnic liberal majority" echo =  FALSE}

# equal size; liberals: value = ethnic

df <- read.csv("mj_val_eth.csv",skip=6,sep=",")
lg <- read.csv("lg_mj_val_eth.csv",sep =";")
names(df) <- lg[,1]

df <- df %>%  gather(key = subgroup, value = Segra, de_sq_bl,dv_sq_bl,de_cl_bl,dv_cl_bl,de_sq_or,dv_sq_or,de_cl_or,dv_cl_or)  %>% mutate(
`segregation` = fct_relevel(fct_collapse(subgroup,"Ethnic" = c("de_sq_bl","de_cl_bl","de_sq_or","de_cl_or"), "Value" = c("dv_sq_bl","dv_cl_bl","dv_sq_or","dv_cl_or")),"Ethnic"), 
 `ethnicity` = fct_relevel(fct_collapse(subgroup, "Majority" = c("de_sq_bl","dv_cl_bl","de_cl_bl","dv_sq_bl"), "Minority" = c("de_sq_or","de_cl_or","dv_sq_or","dv_cl_or")), "Majority"),
`orientation` = fct_relevel(fct_collapse(subgroup,"Conservatives" = c("de_sq_bl","dv_sq_bl","de_sq_or","dv_sq_or"), "Liberals" = c("de_cl_bl","dv_cl_bl","de_cl_or","dv_cl_or")), "Conservatives"), 
`type` = fct_relevel(fct_collapse(subgroup,"Conservative Majority" = c("de_sq_bl","dv_sq_bl"),
      "Liberals Majority" = c("de_cl_bl","dv_cl_bl"),
      "Conservative Minority" = c("de_sq_or","dv_sq_or"),
      "Liberals Minority" = c("de_cl_or","dv_cl_or")), "Conservative Majority"))

df %>% filter(dominant_square == circle_mj) %>% ggplot(aes(x= circle_mj,y = Segra, color = `segregation`, shape = `orientation`)) + geom_point() + geom_line() +
  scale_color_manual(values = c("green","purple"), guide = guide_legend(title = "Outcome")) +
  scale_shape_manual(values = c("square","circle"), guide = guide_legend(title = "Orientation"))  +
 # scale_y_continuous(limits=c(0.45,1), breaks=seq(0.5,1,by=0.1)) +
  xlab("ß value liberals majority = ß ethnic liberals majority") +
  ylab("Outcome") +
  facet_wrap(~  `ethnicity` ) +
  theme_bw()+
  theme(legend.position = "bottom")


```




# Basic two preferences
```{r dompref, echo = FALSE}

value_dominant_den <- value_dominant_den %>%  gather(key = subgroup, value = Segra, et_sq,vl_sq,et_cl,vl_cl,den_sq,den_cl)  %>% mutate(
`outcome` = fct_relevel(fct_collapse(subgroup,"Ethnic Segregation" = c("et_sq","et_cl"), "Value Segregation" = c("vl_sq","vl_cl"), "Density" = c("den_sq","den_cl")),"Ethnic Segregation"), 
`orientation` = fct_relevel(fct_collapse(subgroup,"Conservatives" = c("et_sq","vl_sq","den_sq"), "Liberals" = c("et_cl","vl_cl","den_cl")), "Conservatives"))

value_basic_den <- value_basic_den %>%  gather(key = subgroup, value = Segra, et_sq,vl_sq,et_cl,vl_cl,den_sq,den_cl)  %>% mutate(
`outcome` = fct_relevel(fct_collapse(subgroup,"Ethnic Segregation" = c("et_sq","et_cl"), "Value Segregation" = c("vl_sq","vl_cl"), "Density" = c("den_sq","den_cl")),"Ethnic Segregation"), 
`orientation` = fct_relevel(fct_collapse(subgroup,"Conservatives" = c("et_sq","vl_sq","den_sq"), "Liberals" = c("et_cl","vl_cl","den_cl")), "Conservatives"))



lib_dom <- value_dominant_den %>% filter (ID == "circle") %>% ggplot(aes(x = dominant_circle, y = Segra, color = `outcome`, shape = `orientation` )) + geom_point(size = 2) + geom_line() +
  scale_color_manual(values = c("green","gray","purple"), guide = guide_legend(title = "Outcome")) +
  scale_shape_manual(values = c("square","circle"), guide = guide_legend(title = "Orientation"))  +
  scale_y_continuous(limits=c(0.45,1), breaks=seq(0.5,1,by=0.1)) +
  xlab("ß value liberals \nall other ß = 0") +
  ylab("Outcome") +
  theme_bw()

lib_both <- value_basic_den %>% filter (ID == "circle") %>% ggplot(aes(x = circle, y = Segra, color = `outcome`, shape = `orientation` )) + geom_point(size = 2) + geom_line() +
  scale_color_manual(values = c("green","gray","purple"), guide = guide_legend(title = "Outcome")) +
  scale_shape_manual(values = c("square","circle"), guide = guide_legend(title = "Orientation"))  +
   scale_y_continuous(limits=c(0.45,1), breaks=seq(0.5,1,by=0.1)) +
  xlab("ß value liberals = ß ethnic liberals") +
  ylab("Outcome") +
  theme_bw()





cons_dom <- value_dominant_den %>% filter (ID == "square" & dominant_circle == 0) %>% ggplot(aes(x = dominant_square, y = Segra, color = `outcome`, shape = `orientation` )) + geom_point(size = 2) + geom_line() +
  scale_color_manual(values = c("green","gray","purple"), guide = guide_legend(title = "Outcome")) +
  scale_shape_manual(values = c("square","circle"), guide = guide_legend(title = "Orientation"))  +
     scale_y_continuous(limits=c(0.45,1), breaks=seq(0.5,1,by=0.1)) +
  xlab("ß ethnic conservatives \nall other ß = 0") +
  ylab("Outcome") +
  theme_bw()

cons_both <- value_basic_den %>% filter (ID == "square") %>% ggplot(aes(x = square, y = Segra, color = `outcome`, shape = `orientation` )) + geom_point(size = 2) + geom_line() +
  scale_color_manual(values = c("green","gray","purple"), guide = guide_legend(title = "Outcome")) +
  scale_shape_manual(values = c("square","circle"), guide = guide_legend(title = "Orientation"))  +
    scale_y_continuous(limits=c(0.45,1), breaks=seq(0.5,1,by=0.1)) +
  xlab("ß ethnic conservatives = ß value conservatives") +
  ylab("Outcome") +
  theme_bw()

a <- ggpubr::ggarrange(lib_dom,cons_dom , common.legend = TRUE, legend = "bottom")
b <- ggpubr::ggarrange(lib_both,cons_both, common.legend = TRUE, legend = "bottom")


a
b

```






# Baseline asymmetric: dominant due to ethnic ration
```{r asym_baseline, fig.cap="Fig. 8 orig", echo = FALSE}
# Effect of ethnic asymmetry: all beta dominant equal

asym_dom <- read.csv("df_asym_dom.csv",sep = ",")

excl <- names(asym_dom) %in% c("run", "density","step")
asym_dom <- asym_dom[!excl] %>% group_by(dominant,circle_orange,circle_blue,fraction_blue,secondary) %>% summarise_all(mean)

# df <- df %>% filter(df$dominant <= 15) 
# df <- df %>% filter(df$fraction_blue==50|df$fraction_blue==60|df$fraction_blue==80)

asym_dom <- asym_dom  %>% filter(fraction_blue == 50 | fraction_blue == 80) %>% gather(key = subgroup, value = Segra, de_sq_bl,dv_sq_bl,de_cl_bl,dv_cl_bl,de_sq_or,dv_sq_or,de_cl_or,dv_cl_or)  %>% mutate(
`segregation` = fct_relevel(fct_collapse(subgroup,"Ethnic" = c("de_sq_bl","de_cl_bl","de_sq_or","de_cl_or"), "Value" = c("dv_sq_bl","dv_cl_bl","dv_sq_or","dv_cl_or")),"Ethnic"), 
 `ethnicity` = fct_relevel(fct_collapse(subgroup, "Majority" = c("de_sq_bl","dv_cl_bl","de_cl_bl","dv_sq_bl"), "Minority" = c("de_sq_or","de_cl_or","dv_sq_or","dv_cl_or")), "Majority"),
`orientation` = fct_relevel(fct_collapse(subgroup,"Conservatives" = c("de_sq_bl","dv_sq_bl","de_sq_or","dv_sq_or"), "Liberals" = c("de_cl_bl","dv_cl_bl","de_cl_or","dv_cl_or")), "Conservatives"), 
`type` = fct_relevel(fct_collapse(subgroup,"Conservative Majority" = c("de_sq_bl","dv_sq_bl"),
      "Liberals Majority" = c("de_cl_bl","dv_cl_bl"),
      "Conservative Minority" = c("de_sq_or","dv_sq_or"),
      "Liberals Minority" = c("de_cl_or","dv_cl_or")), "Conservative Majority"))



ggplot(data = asym_dom, aes(x = dominant, y = Segra, color = `segregation`, linetype = as.factor(fraction_blue))) + geom_point() + geom_line() +
  facet_wrap(~ `type`, nrow = 1) +
  scale_color_manual(values = c("green","purple"),labels =  c("Ethnic","Value"),guide = guide_legend(title = "Segregation \ntype")) +
   scale_linetype_manual(values = c("solid","dashed"),labels =  c("50 %","80 %"),guide = guide_legend(title = "% Majority")) +
  ylab("Spatial Clustering") +
  xlab("ß dominant") +
  theme_bw() +
 theme(legend.position = "bottom")


```


# Comparing beta majority over beta minority liberal

```{r by-product_cons_original, fig.cap="Effect of liberals majority vs minority on value segregation conservatives", echo = FALSE}
# It goes
# ethnic and value segregation for each group in the annex

##### 
# By-product value of conservatives by value preference liberals


# Majority

mech_cons <- mech %>% filter(fraction_blue == 50 | fraction_blue == 80) %>%  filter(val_lib_min==0 | val_lib_min==1 |val_lib_min==7) %>% gather(key=ethnics, value=Clust, dv_sq_bl,dv_sq_or)


cons_maj <- ggplot(data = mech_cons, aes(x=val_lib_loc,y=Clust,color=  `ethnics`,linetype= as.factor(fraction_blue))) + geom_point(size=1.5, shape = "square") + geom_line() + 
  facet_wrap(~val_lib_min,dir="v",labeller = labeller(val_lib_min = valueminority.labs)) +
    scale_y_continuous(breaks= seq(0,2,by=0.25)) +
  xlab("ß value liberal majority") + ylab("Spatial clustering") +
  geom_hline(yintercept=1,color="red") +
  scale_color_manual(values=c("blue","darkorange"),labels=c("Majority","Minority"),name="Ethnicity") +
    scale_linetype_manual(values=c("solid","dashed"),labels=c("50%","80%"),name="% Majority") +
   guides(color  = guide_legend(order = 1), linetype = guide_legend(order = 2)) +
  theme_bw() 


# Minority

mech_lib <- mech %>%  filter(fraction_blue == 50 | fraction_blue == 80) %>%  filter(val_lib_loc==0 | val_lib_loc==1 |val_lib_loc==7) %>% gather(key=ethnics, value=Cluste, dv_sq_bl,dv_sq_or)

cons_min <- ggplot(data = mech_lib, aes(x=val_lib_min,y=Cluste,color=  `ethnics`,linetype= as.factor(fraction_blue))) + geom_point(size=1.5, shape = "square") + geom_line() + 
  facet_wrap(~val_lib_loc,dir="v",labeller = labeller(val_lib_loc = valuemajority.labs)) +
  xlab("ß value liberal minority") + ylab("Spatial clustering") +
  scale_y_continuous(breaks= seq(0,2,by=0.25)) +
  geom_hline(yintercept=1,color="red") +
  scale_color_manual(values=c("blue","darkorange"),labels=c("Majority","Minority"),name="Ethnicity") +
    scale_linetype_manual(values=c("solid","dashed"),labels=c("50%","80%"),name="% Majority") +
   guides(color  = guide_legend(order = 1), linetype = guide_legend(order = 2)) +
 theme_bw()


ggplotly(cons_maj)
ggplotly(cons_min)

lib_cons <- ggpubr::ggarrange(cons_maj,cons_min, common.legend = TRUE, legend = "bottom")

# ggsave("lib_cons.jpg",plot=lib_cons)
ggpubr::annotate_figure(lib_cons,
               top = "Effect of liberals majority vs minority on value segregation conservatives")
```


```{r beta_maj, fig.cap="effect liberals one  dataset", echo = FALSE}
# It goes
#####
# Ethnic and value of liberals above each other
mech_vlmj <- mech %>% filter(fraction_blue == 50 | fraction_blue == 80) %>%  filter(val_lib_min==0 | val_lib_min==1 |val_lib_min==7) %>% gather(key = segregation, value = Clustmj, de_cl_bl, dv_cl_bl) 

librmj <- ggplot(data=mech_vlmj,aes(x=val_lib_loc,y = Clustmj,shape=`segregation`,linetype=as.factor(fraction_blue))) + 
  geom_point(size=1.5,color="blue") + geom_line(color="blue") +
facet_wrap(~val_lib_min,dir="v",labeller=labeller(val_lib_min=valueminority.labs)) +
  xlab("ß value liberals majority") + ylab("Spatial Clustering") +
  scale_y_continuous(breaks= seq(0,2,by=0.25)) +
  scale_linetype_manual(values=c("solid","dashed"),labels=c("50%","80%"),name="% Majority" ) +
  scale_shape_manual(values=c("square","circle"),labels=c("Ethnic","Value"),name="Segregation" ) +
 ggtitle("Liberals Majority") +
    geom_hline(yintercept=1,color="red") +
  guides(color = "black") +
      theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))
   


mech_vlmn <- mech %>%  filter(fraction_blue == 50 | fraction_blue == 80) %>%  filter(val_lib_loc==0 | val_lib_loc==1 |val_lib_loc==7) %>% gather(key = segregation, value = Clustmn, de_cl_or, dv_cl_or) 


librmn <- ggplot(data=mech_vlmn,aes(x=val_lib_min,y = Clustmn,shape=`segregation`,linetype=as.factor(fraction_blue))) + 
  geom_point(size=1.5,color="orange") + geom_line(color="orange") +
facet_wrap(~val_lib_loc,dir="v",labeller=labeller(val_lib_loc=valuemajority.labs)) +
 scale_y_continuous(breaks= seq(0,2,by=0.25)) +
  xlab("ß value liberals minority") + ylab("Spatial Clustering") +
    scale_linetype_manual(values=c("solid","dashed"),labels=c("50%","80%"),name="% Majority") +
  scale_shape_manual(values=c("square","circle"),labels=c("Ethnic","Value"),name="Segregation") +
    geom_hline(yintercept=1,color="red") +
    guides(  linetype = guide_legend(order = 1), shape = guide_legend(order = 2)) +
 #  guides(color=FALSE) + 
    ggtitle("Liberals Minority") +
    geom_hline(yintercept=1,color="red") +
      theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) 



ggplotly(librmj)
ggplotly(librmn)

lib_lib <- ggpubr::ggarrange(librmj,librmn, common.legend = TRUE, legend = "bottom")  

lib_lib
# ggsave("lib_lib.jpg",plot=lib_lib)

```


```{r lib_min, fig.cap="Each grouptype, distribution liberals faceted by ethnic ratio", echo = FALSE}

df_fin <- df_3D %>% mutate(RND = case_when(
  val_lib_loc==5 & val_lib_min==5 & eth_con_loc == 5 & eth_con_min == 5 ~ "H",
  val_lib_loc==20 & val_lib_min==20 & eth_con_loc == 20 & eth_con_min == 20 ~ "L"))
  
sb <- list(
  as.data.frame(cbind((subset(df_fin, eth_lib_loc == 0 & eth_lib_min  ==  0) %>% gather(subgroup, Segra, de_sq_bl,dv_sq_bl)),t="Conservative Majority",tt = "cmj")),
           as.data.frame(cbind((subset(df_fin, eth_lib_loc  ==  0 & eth_lib_min  ==  0) %>% gather(subgroup, Segra, de_cl_bl,dv_cl_bl)),t="Liberal Majority",tt = "lmj")),
            as.data.frame(cbind((subset(df_fin, eth_lib_loc  ==  0 & eth_lib_min  ==  0)  %>% gather(subgroup, Segra, de_sq_or,dv_sq_or)),t="Conservative Minority",tt = "cmn")),
           as.data.frame(cbind((subset(df_fin, eth_lib_loc  ==  0 & eth_lib_min  ==  0) %>% gather(subgroup, Segra, de_cl_or,dv_cl_or)),t="Liberal Minority",tt = "lmn")),
  
   as.data.frame(cbind((subset(df_fin, eth_lib_loc != 0 &  eth_lib_min != 0) %>% gather(subgroup, Segra, de_sq_bl,dv_sq_bl)),t="Conservative Majority_et",tt = "cmj_et")),
           as.data.frame(cbind((subset(df_fin,  eth_lib_loc != 0 &  eth_lib_min != 0) %>% gather(subgroup, Segra, de_cl_bl,dv_cl_bl)),t="Liberal Majority_et",tt = "lmj_et")),
            as.data.frame(cbind((subset(df_fin,  eth_lib_loc != 0 &  eth_lib_min != 0)  %>% gather(subgroup, Segra, de_sq_or,dv_sq_or)),t="Conservative Minority_et",tt = "cmn_et")),
           as.data.frame(cbind((subset(df_fin,  eth_lib_loc != 0 &  eth_lib_min != 0) %>% gather(subgroup, Segra, de_cl_or,dv_cl_or)),t="Liberal Minority_et",tt = "lmn_et"))
           )

for (i in sb) {
pl <-  ggplot(i, aes(x=circle_orange,y=Segra,shape = subgroup, color = RND)) + geom_point() + geom_line() +
  scale_shape_manual(values = c("square","circle"),labels = c("ethnic","Value"), guide = guide_legend(title = "Segregation", order = 1)) + 
    scale_color_manual(values = c("green","purple"),labels = c("high","low"), guide = guide_legend(title = "Randomness")) + 
 scale_x_discrete(limits = seq(10,90 ,by = 10)) +
  xlab("% Liberals Minority") +
  ylab("Spatial Clustering") +
  geom_hline(yintercept=1,color="red") +
  facet_wrap(~ fraction_blue, nrow = 1, labeller = labeller(fraction_blue = ethnicity.labs)) +
 ggtitle(i$t) +
  theme_bw() +
  theme(panel.spacing = unit(0.7, "lines"), legend.position = "bottom")

plot(pl)
nmn <- paste0(as.name(i$tt),".jpg")
ggsave(nmn, pl,  path = "images")
}
  


```






# Increase ethnic


```{r OK Ethnic preference liberals, fig.cap= "Same preferences ethnic and value, liberals", echo =  FALSE}

# equal size; liberals: value = ethnic


df1 <- read.csv("et_mj.csv", skip=6)
df2 <- read.csv("et_mj2.csv", skip=6)
df3 <- read.csv("et_mn.csv", skip=6)
df4 <- read.csv("et_mn2.csv", skip=6)

df <- rbind(df3,df4)
lg <- read.csv("lg_et_mj.csv", sep=";")[,1]

names(df) <- lg

excldf <- names(df) %in% c("run", "density","step")
df <- df[!excldf] 



df <- df %>% group_by(fraction_blue,circle_blue,circle_orange,dominant,et_mj_on,et_mn_on) %>% summarise_all(mean)

df <- df %>%  gather(key = subgroup, value = Segra, de_sq_bl,dv_sq_bl,de_cl_bl,dv_cl_bl,de_sq_or,dv_sq_or,de_cl_or,dv_cl_or)  %>% mutate(
`segregation` = fct_relevel(fct_collapse(subgroup,"Ethnic" = c("de_sq_bl","de_cl_bl","de_sq_or","de_cl_or"), "Value" = c("dv_sq_bl","dv_cl_bl","dv_sq_or","dv_cl_or")),"Ethnic"), 
 `ethnicity` = fct_relevel(fct_collapse(subgroup, "Majority" = c("de_sq_bl","dv_cl_bl","de_cl_bl","dv_sq_bl"), "Minority" = c("de_sq_or","de_cl_or","dv_sq_or","dv_cl_or")), "Majority"),
`orientation` = fct_relevel(fct_collapse(subgroup,"Conservatives" = c("de_sq_bl","dv_sq_bl","de_sq_or","dv_sq_or"), "Liberals" = c("de_cl_bl","dv_cl_bl","de_cl_or","dv_cl_or")), "Conservatives"), 
`type` = fct_relevel(fct_collapse(subgroup,"Conservative Majority" = c("de_sq_bl","dv_sq_bl"),
      "Liberals Majority" = c("de_cl_bl","dv_cl_bl"),
      "Conservative Minority" = c("de_sq_or","dv_sq_or"),
      "Liberals Minority" = c("de_cl_or","dv_cl_or")), "Conservative Majority"))

df %>% filter(et_mj_on == "false") %>% ggplot(aes(x= dominant,y = Segra, color = `segregation`, shape = `orientation`, linetype = et_mn_on)) + geom_point() + geom_line() +
  scale_color_manual(values = c("green","purple"), guide = guide_legend(title = "Outcome")) +
  scale_shape_manual(values = c("square","circle"), guide = guide_legend(title = "Orientation"))  +
 # scale_y_continuous(limits=c(0.45,1), breaks=seq(0.5,1,by=0.1)) +
  xlab("beta") +
  ylab("Outcome") +
  facet_wrap(~  `type` ) +
  theme_bw()+
  theme(legend.position = "bottom")





```

```{r determinism_area_X_ethnic_size, echo = FALSE}
lg <-  read.csv("lg_etlib.csv",sep=";")[,1]
etlb_bs <- read.csv("et_lib_fc_bothfalse.csv",sep=",",skip=6)
names(etlb_bs) <- lg
etlb_bs$ID <- "bsl"

etlb_mj <- read.csv("et_lib_fc_mj.csv",sep=",",skip=6)
names(etlb_mj) <- lg
etlb_mj$ID <- "mj_et"

etlb_mn <- read.csv("et_lib_fc_mn.csv",sep=",",skip=6)
names(etlb_mn) <- lg
etlb_mn$ID <- "mn_et"


etlb <- rbind(etlb_bs,etlb_mj,etlb_mn) %>% group_by(density,fraction_blue,circle_blue,circle_orange,et_mn_on,et_mj_on,dominant,ID) %>% summarise_all(mean) %>%  gather(key = subgroup, value = Segra, de_sq_bl,dv_sq_bl,de_cl_bl,dv_cl_bl,de_sq_or,dv_sq_or,de_cl_or,dv_cl_or)  %>% mutate(
`segregation` = fct_relevel(fct_collapse(subgroup,"Ethnic" = c("de_sq_bl","de_cl_bl","de_sq_or","de_cl_or"), "Value" = c("dv_sq_bl","dv_cl_bl","dv_sq_or","dv_cl_or")),"Ethnic"), 
 `ethnicity` = fct_relevel(fct_collapse(subgroup, "Majority" = c("de_sq_bl","dv_cl_bl","de_cl_bl","dv_sq_bl"), "Minority" = c("de_sq_or","de_cl_or","dv_sq_or","dv_cl_or")), "Majority"),
`orientation` = fct_relevel(fct_collapse(subgroup,"Conservatives" = c("de_sq_bl","dv_sq_bl","de_sq_or","dv_sq_or"), "Liberals" = c("de_cl_bl","dv_cl_bl","de_cl_or","dv_cl_or")), "Conservatives"), 
`type` = fct_relevel(fct_collapse(subgroup,"Conservative Majority" = c("de_sq_bl","dv_sq_bl"),
      "Liberals Majority" = c("de_cl_bl","dv_cl_bl"),
      "Conservative Minority" = c("de_sq_or","dv_sq_or"),
      "Liberals Minority" = c("de_cl_or","dv_cl_or")), "Conservative Majority"))

etlb_df <- etlb %>% filter(fraction_blue == 50 | fraction_blue == 80)


lmn <- ggplot(etlb_df[which(etlb_df$type  == "Liberals Minority"),],aes(x=dominant,y=Segra,  linetype = as.factor(ID) ,color= as.factor(`segregation`))) + geom_point(shape="square") + geom_line() +
  facet_wrap(~ fraction_blue, scales = "free_y") +
  theme_bw()




cmj
cmn

lmj
lmn

pic_lm <- ggpubr::ggarrange(lmj,lmn, nrow = 2,  common.legend = T, legend = "bottom")


pic_cm
pic_lm

```




We only look at the behavior of liberals, as conservatives have minimal consequence. Combining the two plots looked awful

```{r et_liberals, fig.cap="OK Effect of ethnic liberals majority vs minority on liberals", echo = FALSE}


etlib_maj <- df_sec %>% filter(fraction_blue == 50 | fraction_blue == 80)  %>% gather(key = subgroup, value = Clustetmj, de_cl_bl,dv_cl_bl,de_cl_or,dv_cl_or) %>% mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"Ethnic" = c("de_cl_bl","de_cl_or"), "Value" = c("dv_cl_bl","dv_cl_or") ),"Ethnic"),
              `ethnicity` = fct_relevel(fct_collapse(subgroup,"Liberals Majority" = c("de_cl_bl","dv_cl_bl"), "Liberals Minority" = c("de_cl_or","dv_cl_or")), "Liberals Majority")) 

libmaj <-  ggplot(data =  etlib_maj[which(etlib_maj$ID == "etlib_loc" & etlib_maj$eth_lib_min == 0 & etlib_maj$eth_con_loc == 20  & etlib_maj$eth_con_min == 20 & etlib_maj$val_con_loc ==0 & etlib_maj$val_con_min == 0),], aes(x= eth_lib_loc,y = Clustetmj,linetype= as.factor(fraction_blue), shape =`segregation`,color = `ethnicity`) ) +
  geom_point(size=2) + geom_line() +
  facet_wrap(~`ethnicity`, dir = "v") +
   scale_color_manual(values = c("blue","orange"), name = "Ethnicity") +
  scale_shape_manual(values = c("square","circle"), name = "Segregation") +
   scale_linetype_manual(values = c("solid","dashed"), labels = c("50%","80%"), name = "% Majority") +
  xlab("ß ethnic liberals majority") +
  ylab("Spatial Clustering") +
  labs(caption = "ß ethnic liberals minority = 0") + theme_bw() +
  guides(color = FALSE) +
  theme(plot.caption = element_text(hjust = 0.5))

libmin <-  ggplot(data = etlib_maj[which(etlib_maj$ID == "etlib_min" & etlib_maj$eth_lib_loc == 0 & etlib_maj$eth_con_loc == 20  & etlib_maj$eth_con_min == 20 & etlib_maj$val_con_loc ==0 & etlib_maj$val_con_min == 0),], aes(x= eth_lib_min,y = Clustetmj,linetype= as.factor(fraction_blue), shape =`segregation`,color = `ethnicity`) ) + 
  geom_point(size=2) + geom_line() + 
  facet_wrap(~`ethnicity`, dir = "v") +
   scale_color_manual(values = c("blue","orange"), name = "Ethnicity") + 
  scale_shape_manual(values = c("square","circle"), name = "Segregation") + 
   scale_linetype_manual(values = c("solid","dashed"), labels = c("50%","80%"), name = "% Majority") +
  xlab("ß ethnic liberals minority") +
  ylab("Spatial Clustering") +
  labs(caption = "ß ethnic liberals majority = 0") + theme_bw() +
  guides(color = FALSE) +
  theme(plot.caption = element_text(hjust = 0.5))

df_t <- df_sec %>% filter(fraction_blue == 80) %>% filter(val_lib_loc == 20 & eth_lib_loc == 20 & eth_con_loc == 20 & val_con_loc == 0 & val_con_min == 0 & eth_con_min == 5)

libmin <-  ggplot(data = etlib_maj[which(etlib_maj$ID == "etlib_min" & etlib_maj$eth_lib_loc == 7 & etlib_maj$eth_con_loc == 20  & etlib_maj$eth_con_min == 20 & etlib_maj$val_con_loc ==0 & etlib_maj$val_con_min == 0),], aes(x= eth_lib_min,y = Clustetmj,linetype= as.factor(fraction_blue), shape =`segregation`,color = `ethnicity`) ) + 
  geom_point(size=2) + geom_line() + 
  facet_wrap(~`ethnicity`, dir = "v") +
   scale_color_manual(values = c("blue","orange"), name = "Ethnicity") + 
  scale_shape_manual(values = c("square","circle"), name = "Segregation") + 
   scale_linetype_manual(values = c("solid","dashed"), labels = c("50%","80%"), name = "% Majority") +
  xlab("ß ethnic liberals minority") +
  ylab("Spatial Clustering") +
  labs(caption = "ß ethnic liberals majority = 0") + theme_bw() +
  guides(color = FALSE) +
  theme(plot.caption = element_text(hjust = 0.5))
 
 

eth_lib <-  ggpubr::ggarrange(libmaj,libmin, common.legend = TRUE, legend = "bottom")  

ggsave( "eth_lib.jpg" , eth_lib,  path = "images")

```



### Annex

```{r by-product ethnic cons, fig.cap="Effect of liberals majority vs minority on ethnic segregation conservatives", echo = FALSE}
# Not interesting, goes in the annex

# ethnic and value segregation for each group in the annex

##### 
# By-product value of conservatives by value preference liberals


# Majority

mech_cons <- mech %>% filter(fraction_blue == 50 | fraction_blue == 80) %>%  filter(val_lib_min==0 | val_lib_min==1 |val_lib_min==7) %>% gather(key=ethnics, value=Clust, de_sq_bl,de_sq_or)


cons_maj_et <- ggplot(data = mech_cons, aes(x=val_lib_loc,y=Clust,color=  `ethnics`,linetype= as.factor(fraction_blue))) + geom_point(size=1.5, shape = "square") + geom_line() + 
  facet_wrap(~val_lib_min,dir="v",labeller = labeller(val_lib_min = valueminority.labs)) +
    scale_y_continuous(breaks= seq(0,5,by=0.5)) +
  xlab("ß value liberal majority") + ylab("Spatial clustering") +
  geom_hline(yintercept=1,color="red") +
  scale_color_manual(values=c("blue","darkorange"),labels=c("Majority","Minority"),name="Ethnicity") +
    scale_linetype_manual(values=c("solid","dashed"),labels=c("50%","80%"),name="% Majority") +
   guides(color  = guide_legend(order = 1), linetype = guide_legend(order = 2)) +
  theme_bw() 


# Minority

mech_lib <- mech %>%  filter(fraction_blue == 50 | fraction_blue == 80) %>%  filter(val_lib_loc==0 | val_lib_loc==1 |val_lib_loc==7) %>% gather(key=ethnics, value=Cluste, de_sq_bl,de_sq_or)

cons_min_et <- ggplot(data = mech_lib, aes(x=val_lib_min,y=Cluste,color=  `ethnics`,linetype= as.factor(fraction_blue))) + geom_point(size=1.5, shape = "square") + geom_line() + 
  facet_wrap(~val_lib_loc,dir="v",labeller = labeller(val_lib_loc = valuemajority.labs)) +
  xlab("ß value liberal minority") + ylab("Spatial clustering") +
  scale_y_continuous(breaks= seq(0,5,by=0.5)) +
  geom_hline(yintercept=1,color="red") +
  scale_color_manual(values=c("blue","darkorange"),labels=c("Majority","Minority"),name="Ethnicity") +
    scale_linetype_manual(values=c("solid","dashed"),labels=c("50%","80%"),name="% Majority") +
   guides(color  = guide_legend(order = 1), linetype = guide_legend(order = 2)) +
 theme_bw()


ggplotly(cons_maj_et)
ggplotly(cons_min_et)

lib_cons_et <- ggpubr::ggarrange(cons_maj_et,cons_min_et, common.legend = TRUE, legend = "bottom")
lib_cons_et
#ggsave("lib_cons.jpg",plot=lib_cons)

ggpubr::annotate_figure(lib_cons_et,top = "Effect of liberals majority vs minority on ethnic segregation conservatives")

```



```{r et_liberals_con, fig.cap="OK Effect of ethnic liberals majority vs minority on liberals", echo = FALSE}

# etlib_maj <- df_etlib %>% filter(fraction_blue == 50 | fraction_blue == 80) %>% filter(eth_con_loc == 20 & eth_con_min == 20) %>% filter(val_con_loc == 0 & val_con_min == 0) %>% filter(eth_lib_min == 0)

etlib_maj <- df_sec %>% filter(fraction_blue == 50 | fraction_blue == 80)  %>% gather(key = subgroup, value = Clustetmj, de_sq_bl,dv_sq_bl,de_sq_or,dv_sq_or) %>% mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"Ethnic" = c("de_sq_bl","de_sq_or"), "Value" = c("dv_sq_bl","dv_sq_or") ),"Ethnic"),
              `ethnicity` = fct_relevel(fct_collapse(subgroup,"Conservatives Majority" = c("de_sq_bl","dv_sq_bl"), "Conservatives Minority" = c("de_sq_or","dv_sq_or")), "Conservatives Majority")) # %>% filter(eth_lib_min == 0)


# data_maj = etlib_maj[which(etlib_maj$ID == "etlib_loc" & etlib_maj$eth_lib_min == 0),]

libmaj <-  ggplot(data =  etlib_maj[which(etlib_maj$ID == "etlib_loc" & etlib_maj$eth_lib_min == 0 & etlib_maj$eth_con_loc == 20  & etlib_maj$eth_con_min == 20 & etlib_maj$val_con_loc ==0 & etlib_maj$val_con_min == 0),], aes(x= eth_lib_loc,y = Clustetmj,linetype= as.factor(fraction_blue), shape =`segregation`,color = `ethnicity`) ) +
  geom_point(size=2) + geom_line() +
  facet_wrap(~`ethnicity`, dir = "v") +
   scale_color_manual(values = c("blue","orange"), name = "Ethnicity") +
  scale_shape_manual(values = c("square","circle"), name = "Segregation") +
   scale_linetype_manual(values = c("solid","dashed"), labels = c("50%","80%"), name = "% Majority") +
  xlab("ß ethnic liberals majority") +
  ylab("Spatial Clustering") +
  labs(caption = "ß ethnic liberals minority = 0") + theme_bw() +
  guides(color = FALSE) +
  theme(plot.caption = element_text(hjust = 0.5))




libmin <-  ggplot(data = etlib_maj[which(etlib_maj$ID == "etlib_min" & etlib_maj$eth_lib_loc == 0 & etlib_maj$eth_con_loc == 20  & etlib_maj$eth_con_min == 20 & etlib_maj$val_con_loc ==0 & etlib_maj$val_con_min == 0),], aes(x= eth_lib_min,y = Clustetmj,linetype= as.factor(fraction_blue), shape =`segregation`,color = `ethnicity`) ) + 
  geom_point(size=2) + geom_line() + 
  facet_wrap(~`ethnicity`, dir = "v") +
   scale_color_manual(values = c("blue","orange"), name = "Ethnicity") + 
  scale_shape_manual(values = c("square","circle"), name = "Segregation") + 
   scale_linetype_manual(values = c("solid","dashed"), labels = c("50%","80%"), name = "% Majority") +
  xlab("ß ethnic liberals minority") +
  ylab("Spatial Clustering") +
  labs(caption = "ß ethnic liberals majority = 0") + theme_bw() +
  guides(color = FALSE) +
  theme(plot.caption = element_text(hjust = 0.5))


ggpubr::ggarrange(libmaj,libmin, common.legend = TRUE, legend = "bottom")  


```


### Back



```{r sec_test, fig.cap="Secondary preference high and low randomness", echo = FALSE}

# pref <- names(df_sec) %in% c("eth_con_loc", "eth_con_min","val_loc_lib")

# Value conservaties

df_sec <-  df_sec  %>% gather(key = subgroup, value = Clus, de_sq_bl,dv_sq_bl,de_cl_bl,dv_cl_bl,de_sq_or,dv_sq_or,de_cl_or,dv_cl_or)  %>% mutate(
          `segregation` = fct_relevel(fct_collapse(subgroup,"Ethnic" = c("de_sq_bl","de_cl_bl","de_sq_or","de_cl_or"), "Value" = c("dv_sq_bl","dv_cl_bl","dv_sq_or","dv_cl_or")),"Ethnic"), 
          `ethnicity` = fct_relevel(fct_collapse(subgroup," Majority" = c("de_sq_bl","dv_cl_bl","de_cl_bl","dv_sq_bl"), "Minority" = c("de_sq_or","de_cl_or","dv_sq_or","dv_cl_or")), "Majority"),
         `orientation` = fct_relevel(fct_collapse(subgroup,"Conservatives" = c("de_sq_bl","dv_sq_bl","de_sq_or","dv_sq_or"), "Liberals" = c("de_cl_bl","dv_cl_bl","de_cl_or","dv_cl_or")), "Conservatives")  )


df_sec_vlmjH<- df_sec  %>%  filter(fraction_blue == 80 & ID == "valuecon_loc" & val_con_min == 0 & RND == "high") %>% filter(val_con_loc == 0 |val_con_loc == 5) 
df_sec_vlmjL <- df_sec  %>%  filter(fraction_blue == 80 & ID == "valuecon_loc" & val_con_min == 0 & RND == "low") %>% filter(val_con_loc == 0 |val_con_loc == 20)


datas <- df_sec_vlmjH
df_sec_vlmjH_p <- ggplot(datas, aes(x = val_con_loc,y = Clus, shape = `orientation` , color = `ethnicity` , linetype = `segregation`)) + geom_point() + geom_line() +
  scale_x_discrete(limits= c(0,max(datas$val_con_loc)),breaks = c(0,max(datas$val_con_loc))) +
  scale_y_continuous(breaks = seq(0,max(datas$Clus),by=0.5)) +
  scale_shape_manual(values = c("square","circle"),labels = c("Conservatives","Liberals"), name= "Orientation")  +
 scale_color_manual(values=c("blue","orange"),labels = c("Majority","Minority"), name= "Ethnicity")  + scale_linetype_manual(values=c("solid","dashed"),labels = c("Ethnic","Value"), name= "Segregation \ntype") + 
  ylab("Spatial Clustering") +
  xlab("ß value Conservatives Majority") +
  ggtitle(if (datas$RND == "high") {"High Randomness (dominant ß = 5)"}else{"Low Randomness (dominant ß = 20)"}) +
  # ggtitle(if RND ="high"   "High Randomness (dominant ß = 5)") +
  theme_bw()


datas <- df_sec_vlmjL
df_sec_vlmjL_p <-  ggplot(datas, aes(x = val_con_loc,y = Clus, shape = `orientation` , color = `ethnicity` , linetype = `segregation`)) + geom_point() + geom_line() +
  scale_x_discrete(limits= c(0,max(datas$val_con_loc)),breaks = c(0,max(datas$val_con_loc))) +
  scale_y_continuous(breaks = seq(0,max(datas$Clus),by=0.5)) +
  scale_shape_manual(values = c("square","circle"),labels = c("Conservatives","Liberals"), name= "Orientation")  +
 scale_color_manual(values=c("blue","orange"),labels = c("Majority","Minority"), name= "Ethnicity")  + scale_linetype_manual(values=c("solid","dashed"),labels = c("Ethnic","Value"), name= "Segregation \ntype") + 
  ylab("Spatial Clustering") +
  xlab("ß value Conservatives Majority") +
  ggtitle(if (datas$RND == "high") {"High Randomness (dominant ß = 5)"}else{"Low Randomness (dominant ß = 20)"}) +
  # ggtitle(if RND ="high"   "High Randomness (dominant ß = 5)") +
  theme_bw()

df_sec_vlmnH<- df_sec  %>%  filter(fraction_blue == 80 & ID == "valuecon_min" & val_con_loc == 0 & RND == "high") %>% filter(val_con_min == 0 |val_con_min == 5) 
df_sec_vlmnL <- df_sec  %>%  filter(fraction_blue == 80 & ID == "valuecon_min" & val_con_loc == 0 & RND == "low") %>% filter(val_con_min == 0 |val_con_min == 20)

datas <- df_sec_vlmnH
df_sec_vlmnH_p <-  ggplot(datas, aes(x = val_con_min,y = Clus, shape = `orientation` , color = `ethnicity` , linetype = `segregation`)) + geom_point() + geom_line() +
  scale_x_discrete(limits= c(0,max(datas$val_con_min)),breaks = c(0,max(datas$val_con_min))) +
  scale_y_continuous(breaks = seq(0,max(datas$Clus),by=0.5)) +
  scale_shape_manual(values = c("square","circle"),labels = c("Conservatives","Liberals"), name= "Orientation")  +
 scale_color_manual(values=c("blue","orange"),labels = c("Majority","Minority"), name= "Ethnicity")  + scale_linetype_manual(values=c("solid","dashed"),labels = c("Ethnic","Value"), name= "Segregation \ntype") + 
  ylab("Spatial Clustering") +
  xlab("ß value Conservatives Minority") +
  ggtitle(if (datas$RND == "high") {"High Randomness (dominant ß = 5)"}else{"Low Randomness (dominant ß = 20)"}) +
  # ggtitle(if RND ="high"   "High Randomness (dominant ß = 5)") +
  theme_bw()


datas <- df_sec_vlmnL
df_sec_vlmnL_p <-  ggplot(datas, aes(x = val_con_min,y = Clus, shape = `orientation` , color = `ethnicity` , linetype = `segregation`)) + geom_point() + geom_line() +
  scale_x_discrete(limits= c(0,max(datas$val_con_min)),breaks = c(0,max(datas$val_con_min))) +
  scale_y_continuous(breaks = seq(0,max(datas$Clus),by=0.5)) +
  scale_shape_manual(values = c("square","circle"),labels = c("Conservatives","Liberals"), name= "Orientation")  +
 scale_color_manual(values=c("blue","orange"),labels = c("Majority","Minority"), name= "Ethnicity")  + scale_linetype_manual(values=c("solid","dashed"),labels = c("Ethnic","Value"), name= "Segregation \ntype") + 
  ylab("Spatial Clustering") +
  xlab("ß value Conservatives Minority") +
  ggtitle(if (datas$RND == "high") {"High Randomness (dominant ß = 5)"}else{"Low Randomness (dominant ß = 20)"}) +
  # ggtitle(if RND ="high"   "High Randomness (dominant ß = 5)") +
  theme_bw()


ggpubr::ggarrange(df_sec_vlmjH_p,df_sec_vlmjL_p,df_sec_vlmnH_p,df_sec_vlmnL_p, common.legend = TRUE, legend = "bottom")

# Ethnic liberals

 
df_sec <-  df_sec  %>% gather(key = subgroup, value = Clus, de_sq_bl,dv_sq_bl,de_cl_bl,dv_cl_bl,de_sq_or,dv_sq_or,de_cl_or,dv_cl_or)  %>% mutate(
          `segregation` = fct_relevel(fct_collapse(subgroup,"Ethnic" = c("de_sq_bl","de_cl_bl","de_sq_or","de_cl_or"), "Value" = c("dv_sq_bl","dv_cl_bl","dv_sq_or","dv_cl_or")),"Ethnic"), 
          `ethnicity` = fct_relevel(fct_collapse(subgroup," Majority" = c("de_sq_bl","dv_cl_bl","de_cl_bl","dv_sq_bl"), "Minority" = c("de_sq_or","de_cl_or","dv_sq_or","dv_cl_or")), "Majority"),
         `orientation` = fct_relevel(fct_collapse(subgroup,"Conservatives" = c("de_sq_bl","dv_sq_bl","de_sq_or","dv_sq_or"), "Liberals" = c("de_cl_bl","dv_cl_bl","de_cl_or","dv_cl_or")), "Conservatives")  )


df_sec_etmjH<- df_sec  %>%  filter(fraction_blue == 80 & ID == "etlib_loc" & eth_lib_min == 0 & RND == "high") %>% filter(eth_lib_loc == 0 |eth_lib_loc == 5) 
df_sec_etmjL <- df_sec  %>%  filter(fraction_blue == 80 & ID == "etlib_loc" & eth_lib_min == 0 & RND == "low") %>% filter(eth_lib_loc == 0 |eth_lib_loc == 20)


datas <- df_sec_etmjH
df_sec_etmjH_p <- ggplot(datas, aes(x = eth_lib_loc,y = Clus, shape = `orientation` , color = `ethnicity` , linetype = `segregation`)) + geom_point() + geom_line() +
  scale_x_discrete(limits= c(0,max(datas$eth_lib_loc)),breaks = c(0,max(datas$eth_lib_loc))) +
  scale_y_continuous(breaks = seq(0,max(datas$Clus),by=0.5)) +
  scale_shape_manual(values = c("square","circle"),labels = c("Conservatives","Liberals"), name= "Orientation")  +
 scale_color_manual(values=c("blue","orange"),labels = c("Majority","Minority"), name= "Ethnicity")  + scale_linetype_manual(values=c("solid","dashed"),labels = c("Ethnic","Value"), name= "Segregation \ntype") + 
  ylab("Spatial Clustering") +
  xlab("ß Ethnic Liberals Majority") +
  ggtitle(if (datas$RND == "high") {"High Randomness (dominant ß = 5)"}else{"Low Randomness (dominant ß = 20)"}) +
  # ggtitle(if RND ="high"   "High Randomness (dominant ß = 5)") +
  theme_bw()


datas <- df_sec_etmjL
df_sec_etmjL_p <-  ggplot(datas, aes(x = eth_lib_loc,y = Clus, shape = `orientation` , color = `ethnicity` , linetype = `segregation`)) + geom_point() + geom_line() +
  scale_x_discrete(limits= c(0,max(datas$eth_lib_loc)),breaks = c(0,max(datas$eth_lib_loc))) +
  scale_y_continuous(breaks = seq(0,max(datas$Clus),by=0.5)) +
  scale_shape_manual(values = c("square","circle"),labels = c("Conservatives","Liberals"), name= "Orientation")  +
 scale_color_manual(values=c("blue","orange"),labels = c("Majority","Minority"), name= "Ethnicity")  + scale_linetype_manual(values=c("solid","dashed"),labels = c("Ethnic","Value"), name= "Segregation \ntype") + 
  ylab("Spatial Clustering") +
  xlab("ß Ethnic Liberals Majority") +
  ggtitle(if (datas$RND == "high") {"High Randomness (dominant ß = 5)"}else{"Low Randomness (dominant ß = 20)"}) +
  # ggtitle(if RND ="high"   "High Randomness (dominant ß = 5)") +
  theme_bw()

df_sec_etmnH<- df_sec  %>%  filter(fraction_blue == 80 & ID == "etlib_min" & eth_lib_loc == 0 & RND == "high") %>% filter(eth_lib_min == 0 |eth_lib_min == 5) 
df_sec_etmnL <- df_sec  %>%  filter(fraction_blue == 80 & ID == "etlib_min" & eth_lib_loc == 0 & RND == "low") %>% filter(eth_lib_min == 0 |eth_lib_min == 20)

datas <- df_sec_etmnH
df_sec_etmnH_p <-  ggplot(datas, aes(x = eth_lib_min,y = Clus, shape = `orientation` , color = `ethnicity` , linetype = `segregation`)) + geom_point() + geom_line() +
  scale_x_discrete(limits= c(0,max(datas$eth_lib_min)),breaks = c(0,max(datas$eth_lib_min))) +
  scale_y_continuous(breaks = seq(0,max(datas$Clus),by=0.5)) +
  scale_shape_manual(values = c("square","circle"),labels = c("Conservatives","Liberals"), name= "Orientation")  +
 scale_color_manual(values=c("blue","orange"),labels = c("Majority","Minority"), name= "Ethnicity")  + scale_linetype_manual(values=c("solid","dashed"),labels = c("Ethnic","Value"), name= "Segregation \ntype") + 
  ylab("Spatial Clustering") +
  xlab("ß Ethnic Liberals Minority") +
  ggtitle(if (datas$RND == "high") {"High Randomness (dominant ß = 5)"}else{"Low Randomness (dominant ß = 20)"}) +
  # ggtitle(if RND ="high"   "High Randomness (dominant ß = 5)") +
  theme_bw()


datas <- df_sec_etmnL
df_sec_etmnL_p <-  ggplot(datas, aes(x = eth_lib_min,y = Clus, shape = `orientation` , color = `ethnicity` , linetype = `segregation`)) + geom_point() + geom_line() +
  scale_x_discrete(limits= c(0,max(datas$eth_lib_min)),breaks = c(0,max(datas$eth_lib_min))) +
  scale_y_continuous(breaks = seq(0,max(datas$Clus),by=0.5)) +
  scale_shape_manual(values = c("square","circle"),labels = c("Conservatives","Liberals"), name= "Orientation")  +
 scale_color_manual(values=c("blue","orange"),labels = c("Majority","Minority"), name= "Ethnicity")  + scale_linetype_manual(values=c("solid","dashed"),labels = c("Ethnic","Value"), name= "Segregation \ntype") + 
  ylab("Spatial Clustering") +
  xlab("ß Ethnic Liberals Minority") +
  ggtitle(if (datas$RND == "high") {"High Randomness (dominant ß = 5)"}else{"Low Randomness (dominant ß = 20)"}) +
  # ggtitle(if RND ="high"   "High Randomness (dominant ß = 5)") +
  theme_bw()


ggpubr::ggarrange(df_sec_etmjH_p,df_sec_etmjL_p,df_sec_etmnH_p,df_sec_etmnL_p, common.legend = TRUE, legend = "bottom")
```



```{r et_lib_cons, fig.cap="NO Effect of ethnic liberals on conservatives", echo = FALSE}

# etlib_maj <- df_etlib %>% filter(fraction_blue == 50 | fraction_blue == 80) %>% filter(eth_con_loc == 20 & eth_con_min == 20) %>% filter(val_con_loc == 0 & val_con_min == 0) %>% filter(eth_lib_min == 0)


etlib_cons <- df_sec %>% filter(fraction_blue == 50 | fraction_blue == 80, val_con_loc ==0, val_con_min == 0 )  %>% gather(key = subgroup, value = Clustetmj, de_sq_bl,dv_sq_bl,de_sq_or,dv_sq_or) %>% mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"Ethnic" = c("de_sq_bl","de_sq_or"), "Value" = c("dv_sq_bl","dv_sq_or") ),"Ethnic"),
              `ethnicity` = fct_relevel(fct_collapse(subgroup,"Conservatives Majority" = c("de_sq_bl","dv_sq_bl"), "Conservatives Minority" = c("de_sq_or","dv_sq_or")), "Conservatives Majority")) # %>% filter(eth_lib_min == 0)

# data_maj = etlib_maj[which(etlib_maj$ID == "etlib_loc" & etlib_maj$eth_lib_min == 0),]

conmaj <-  ggplot(data =  etlib_cons[which(etlib_cons$ID == "etlib_loc" & etlib_cons$eth_lib_min == 0 & etlib_cons$eth_con_loc == 20 & etlib_cons$eth_con_min == 20),], aes(x= eth_lib_loc,y = Clustetmj,linetype= as.factor(fraction_blue), shape =`segregation`,color = `ethnicity`) ) +
  geom_point(size=2) + geom_line() +
  facet_wrap(~`ethnicity`, dir = "v") +
   scale_color_manual(values = c("blue","orange"), name = "Ethnicity") +
  scale_shape_manual(values = c("square","circle"), name = "Segregation") +
   scale_linetype_manual(values = c("solid","dashed"), labels = c("50%","80%"), name = "% Majority") +
  xlab("ß ethnic liberals majority") +
  ylab("Spatial Clustering") +
  labs(caption = "ß ethnic liberals minority = 0") + theme_bw() +
  guides(color = FALSE) +
  theme(plot.caption = element_text(hjust = 0.5))

conmin <-  ggplot(data = etlib_cons[which(etlib_cons$ID == "etlib_min" & etlib_cons$eth_lib_loc == 0 & etlib_cons$eth_con_loc == 20 &  etlib_cons$eth_con_min == 20),], aes(x= eth_lib_min,y = Clustetmj,linetype= as.factor(fraction_blue), shape =`segregation`,color = `ethnicity`) ) + 
  geom_point(size=2) + geom_line() + 
  facet_wrap(~`ethnicity`, dir = "v") +
   scale_color_manual(values = c("blue","orange"), name = "Ethnicity") + 
  scale_shape_manual(values = c("square","circle"), name = "Segregation") + 
   scale_linetype_manual(values = c("solid","dashed"), labels = c("50%","80%"), name = "% Majority") +
  xlab("ß ethnic liberals minority") +
  ylab("Spatial Clustering") +
  labs(caption = "ß ethnic liberals majority = 0") + theme_bw() +
  guides(color = FALSE) +
  theme(plot.caption = element_text(hjust = 0.5))
 

ggpubr::ggarrange(conmaj,conmin, common.legend = TRUE, legend = "bottom")  




```



