---
title: "JMS"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.lp="fig:"  ,warning = FALSE)
 
# install.packages("tinytex", repos = "https://cloud.r-project.org" )


library(knitr)
library(ggplot2)
library(reshape)
library(reshape2)
library(forcats)
library(tidyr)
library(dplyr)
library(gtable)
library(kableExtra)
library(magick)
library(webshot)
library(xtable)
library(gridExtra)
library(ggrepel)
library(viridis)
options(xtable.floating = FALSE)
options(xtable.timestamp = "")
webshot::install_phantomjs()



setwd("C:/Users/rocpa/OneDrive/Desktop/AF2/exp12_2020/")

# Back work, used to combine datasets from diffent runs. To IGNORE OR DELETE

# etlib_min1 <- read.csv("mj_etlib_min.csv",skip = 6)
# etlib_min2 <- read.csv("mj_etlib_min2.csv",skip = 6)
# etlib_min <- rbind(etlib_min1,etlib_min2)
# names(etlib_min) <- pull(read.csv("legend_sec_etlib.csv"))
# etlib_min <- cbind(ID = "etlib_min",etlib_min)


basic <- read.csv("df_basic.csv",sep =",")
value_basic <- read.csv("df_valuebasic.csv",sep = ",")
asym_dom <- read.csv("df_asym_dom.csv",sep = ",")
dislib <- read.csv("df_dislib.csv", sep = ",")
sa_asym <- read.csv("df_sa_asym.csv",sep =",")
etlib <- read.csv("df_etlib.csv",sep =",")

circle_orange.labs <- c("20% liberal minority", "50% liberal minority", "80% liberal minority")
names(circle_orange.labs) <- c("20","50","80")

segregation.labs  <- c("ethnic segregation","value segregation")
names(segregation.labs) <- c("ethnics","values")

```

```{r heatmap, include=TRUE, fig.cap="Comparison dominant vs secondary", echo=FALSE}



excl <- names(basic) %in% c("run", "ID","density","step")
basic_sa <- basic[!excl]  %>% group_by(dominant,secondary,circle_orange,circle_blue,fraction_blue) %>% summarise_all(c("mean"= mean,"sd"= sd)) 


data_f <- basic_sa %>% filter(dominant >= secondary)   %>% gather(key= subgroup, value = Segra, et_sq_bl_mean, vl_sq_bl_mean, et_cl_bl_mean, vl_cl_bl_mean, et_sq_or_mean, vl_sq_or_mean, et_cl_or_mean, vl_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("et_sq_bl_mean","et_cl_bl_mean","et_sq_or_mean","et_cl_or_mean"), "values" = c("vl_sq_bl_mean","vl_cl_bl_mean","vl_sq_or_mean","vl_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("et_sq_bl_mean","vl_sq_bl_mean","et_sq_or_mean","vl_sq_or_mean"), "liberal" = c("et_cl_bl_mean","vl_cl_bl_mean","et_cl_or_mean","vl_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("et_sq_bl_mean","vl_sq_bl_mean","et_cl_bl_mean","vl_cl_bl_mean"),"minority" = c("et_sq_or_mean","vl_sq_or_mean","et_cl_or_mean","vl_cl_or_mean")), "local"))
  
  
  ggplot(data = data_f, aes(x = secondary , y = dominant , fill = Segra)) + geom_tile() + 
 facet_grid( `orientation` ~  `segregation`, labeller = labeller(`segregation` = segregation.labs)) +
  xlab("ß secondary") + ylab("ß dominant") +
scale_x_discrete(limits=seq(0, 20 ,by = 1)) +
  scale_y_discrete(limits=seq(0,20 ,by = 1)) + 
 # geom_text(aes(label=round(Segra,2)), size=3) +
    scale_fill_gradient(low = "grey", high = "brown", limits=c(min(data_f$Segra),1), breaks=round(seq(min(data_f$Segra),1,by=0.1),2),  name = "Segregation") +
    # scale_fill_distiller(palette = "BlRd", limits=c(min(data_f$Segra),1), breaks=round(seq(min(data_f$Segra),1,by=0.05),2),  name = "Segregation") +
    theme_bw()  +   theme(legend.position = "bottom", legend.title = element_text(size = 15,vjust = 0.8), legend.text = element_text(size = 15),  legend.key.width  = unit(1, "inch"), legend.key.height  = unit(0.3, "inch"), panel.grid.minor.x = element_blank(), plot.title=element_text(hjust = 0.5),  legend.margin=margin(0,0,0,0), axis.title.x = (element_text(size = 18)), axis.title.y = (element_text(size = 18)), axis.text.x =  (element_text(size = 13)),axis.text.y =  (element_text(size = 13)),strip.text.x = element_text(size = 15), strip.text.y = element_text(size = 15))




ggsave("images/heatmapbase.jpg",plot = last_plot(),
  device = NULL,
  path = NULL,
  scale = 1,
  width = 11,
  height = 11,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)

```

```{r basefigure, fig.width=30, fig.cap="Same parameter for ethnic and value homophily for all agents", echo=FALSE}

# database filter
excl <- names(basic) %in% c("run", "ID","density","step")
basic_sa <- basic[!excl] %>% filter(dominant == secondary) %>% group_by(dominant,secondary,circle_orange,circle_blue,fraction_blue) %>% summarise_all(c("mean"= mean,"sd"= sd)) 

# graph

data_f <- basic_sa %>% gather(key= subgroup, value = Segra, et_sq_bl_mean, vl_sq_bl_mean, et_cl_bl_mean, vl_cl_bl_mean, et_sq_or_mean, vl_sq_or_mean, et_cl_or_mean, vl_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("et_sq_bl_mean","et_cl_bl_mean","et_sq_or_mean","et_cl_or_mean"), "values" = c("vl_sq_bl_mean","vl_cl_bl_mean","vl_sq_or_mean","vl_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("et_sq_bl_mean","vl_sq_bl_mean","et_sq_or_mean","vl_sq_or_mean"), "liberal" = c("et_cl_bl_mean","vl_cl_bl_mean","et_cl_or_mean","vl_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("et_sq_bl_mean","vl_sq_bl_mean","et_cl_bl_mean","vl_cl_bl_mean"),"minority" = c("et_sq_or_mean","vl_sq_or_mean","et_cl_or_mean","vl_cl_or_mean")), "local"))

ggplot(data = data_f, aes(x = dominant, y = Segra,  linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1))) + scale_y_continuous(limits=c(0,1), breaks=seq(0,1,by=0.10)) +
  scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
  scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab("ß dominant = ß secondary") + ylab("Exposure") + 
  theme_bw() +  theme( axis.title.x = (element_text(size = 15)), axis.title.y = (element_text(size = 15)), axis.text.x =  (element_text(size = 15)),axis.text.y =  (element_text(size = 15)), legend.title = element_text(size = 13) ,legend.text = element_text(size = 13), plot.title=element_text(hjust = 0.5)) + theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
  
ggsave("images/one_beta.jpg",plot = last_plot(),
  device = NULL,path = NULL, 
  scale = 1,
  width = 10,
  height = 4,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = FALSE)

# robustness table

table_rb <- xtable(basic_sa[,c("dominant","et_sq_bl_mean","et_sq_bl_sd","et_cl_bl_mean","et_cl_bl_sd","et_sq_or_mean","et_sq_or_sd","et_cl_or_mean","et_cl_or_sd","vl_sq_bl_mean","vl_sq_bl_sd","vl_cl_bl_mean","vl_cl_bl_sd","vl_sq_or_mean","vl_sq_or_sd","vl_cl_or_mean","vl_cl_or_sd")], digits = 3)
align(table_rb) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"

addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <-  c("\\multicolumn{17}{|c|}{Baseline condition}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Exposure} & \\multicolumn{8}{|c|}{Value Exposure}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ dom = $\\beta$ sec & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
" & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")


print(table_rb,type = "latex", file = "latex/basic_rb.tex", include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")

```

```{r secondary_0, fig.width=30, fig.cap="secondary preference set to 0", echo=FALSE}

# database filter
excl <- names(basic) %in% c("run", "ID","density","step")
basic_sa_sec0 <- basic[!excl] %>% filter(secondary == 0) %>% group_by(dominant,circle_orange,circle_blue,fraction_blue,secondary) %>% summarise_all(c("mean"= mean,"sd"= sd))

# graph

data_f <- basic_sa_sec0 %>% gather(key= subgroup, value = Segra, et_sq_bl_mean, vl_sq_bl_mean, et_cl_bl_mean, vl_cl_bl_mean, et_sq_or_mean, vl_sq_or_mean, et_cl_or_mean, vl_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("et_sq_bl_mean","et_cl_bl_mean","et_sq_or_mean","et_cl_or_mean"), "values" = c("vl_sq_bl_mean","vl_cl_bl_mean","vl_sq_or_mean","vl_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("et_sq_bl_mean","vl_sq_bl_mean","et_sq_or_mean","vl_sq_or_mean"), "liberal" = c("et_cl_bl_mean","vl_cl_bl_mean","et_cl_or_mean","vl_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("et_sq_bl_mean","vl_sq_bl_mean","et_cl_bl_mean","vl_cl_bl_mean"),"minority" = c("et_sq_or_mean","vl_sq_or_mean","et_cl_or_mean","vl_cl_or_mean")), "local"))

ggplot(data = data_f, aes(x = dominant, y = Segra, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1))) + scale_y_continuous(limits=c(0,1), breaks=seq(0,1,by=0.10)) +
   scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
  scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab("ß dominant") + ylab("Exposure") + 
  theme_bw() +  theme( axis.title.x = (element_text(size = 15)), axis.title.y = (element_text(size = 15)), axis.text.x =  (element_text(size = 15)),axis.text.y =  (element_text(size = 15)), legend.title = element_text(size = 13) ,legend.text = element_text(size = 13), plot.title=element_text(hjust = 0.5)) + theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
  
ggsave("images/sec_0.jpg",plot = last_plot(),
  device = NULL,path = NULL, 
  scale = 1,
  width = 10,
  height = 4,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = FALSE)

# robustness table

table_rb <- xtable(basic_sa_sec0[,c("dominant","et_sq_bl_mean","et_sq_bl_sd","et_cl_bl_mean","et_cl_bl_sd","et_sq_or_mean","et_sq_or_sd","et_cl_or_mean","et_cl_or_sd","vl_sq_bl_mean","vl_sq_bl_sd","vl_cl_bl_mean","vl_cl_bl_sd","vl_sq_or_mean","vl_sq_or_sd","vl_cl_or_mean","vl_cl_or_sd")], digits = 3)
align(table_rb) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"

addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <-  c("\\multicolumn{17}{|c|}{Secondary preference = 0}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Exposure} & \\multicolumn{8}{|c|}{Value Exposure}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ sec = 0 & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
" & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")


print(table_rb,type = "latex", file = "latex/basic_rb_sec0.tex", include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")

```

```{r sensval, fig.width=30, fig.cap="Test mechanism: increase liberal and conservative, all other 0", echo=FALSE}

# database filter
excl <- names(value_basic) %in% c("run","density","step")
dom_lib <- value_basic[!excl] %>% filter(ID == "dom_crl") %>%   #,  secondary_circle == 0 & dominant_square == 0 & secondary_square == 0) %>% 
  group_by(ID, dominant_circle,secondary_circle,dominant_square,secondary_square,fraction_blue,circle_blue,circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 

# graph

data_f <- dom_lib %>% gather(key= subgroup, value = Segra, et_sq_bl_mean, vl_sq_bl_mean, et_cl_bl_mean, vl_cl_bl_mean, et_sq_or_mean, vl_sq_or_mean, et_cl_or_mean, vl_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("et_sq_bl_mean","et_cl_bl_mean","et_sq_or_mean","et_cl_or_mean"), "values" = c("vl_sq_bl_mean","vl_cl_bl_mean","vl_sq_or_mean","vl_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("et_sq_bl_mean","vl_sq_bl_mean","et_sq_or_mean","vl_sq_or_mean"), "liberal" = c("et_cl_bl_mean","vl_cl_bl_mean","et_cl_or_mean","vl_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("et_sq_bl_mean","vl_sq_bl_mean","et_cl_bl_mean","vl_cl_bl_mean"),"minority" = c("et_sq_or_mean","vl_sq_or_mean","et_cl_or_mean","vl_cl_or_mean")), "local"))

 dom_libpic <- ggplot(data = data_f, aes(x = dominant_circle, y = Segra, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1))) + scale_y_continuous(limits=c(0,1), breaks=seq(0,1,by=0.10)) +
#geom_hline(yintercept = 0.50, color = "red") +
 scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
  scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab("ß value liberal") + ylab("Exposure") + 
  theme_bw() +  theme( axis.title.x = (element_text(size = 15)), axis.title.y = (element_text(size = 15)), axis.text.x =  (element_text(size = 13)),axis.text.y =  (element_text(size = 15)), legend.title = element_text(size = 13) ,legend.text = element_text(size = 13), plot.title=element_text(hjust = 0.5)) + theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
  
# ggsave("images/dom_lib.jpg",plot = last_plot(),
#   device = NULL,path = NULL, 
#   scale = 1,
#   width = 10,
#   height = 4,
#   units = c("in", "cm", "mm"),
#   dpi = 300,
#   limitsize = FALSE)


# sensitivity to conservative
 
excl <- names(value_basic) %in% c("run","density","step")
dom_con <- value_basic[!excl] %>% filter(ID == "dom_sqr") %>%
   group_by(ID,dominant_square, secondary_square,dominant_circle,secondary_circle,fraction_blue,circle_blue,circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 


# graph

data_f <- dom_con %>% gather(key= subgroup, value = Segra, et_sq_bl_mean, vl_sq_bl_mean, et_cl_bl_mean, vl_cl_bl_mean, et_sq_or_mean, vl_sq_or_mean, et_cl_or_mean, vl_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("et_sq_bl_mean","et_cl_bl_mean","et_sq_or_mean","et_cl_or_mean"), "values" = c("vl_sq_bl_mean","vl_cl_bl_mean","vl_sq_or_mean","vl_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("et_sq_bl_mean","vl_sq_bl_mean","et_sq_or_mean","vl_sq_or_mean"), "liberal" = c("et_cl_bl_mean","vl_cl_bl_mean","et_cl_or_mean","vl_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("et_sq_bl_mean","vl_sq_bl_mean","et_cl_bl_mean","vl_cl_bl_mean"),"minority" = c("et_sq_or_mean","vl_sq_or_mean","et_cl_or_mean","vl_cl_or_mean")), "local"))

dom_conpic <- ggplot(data = data_f, aes(x = dominant_square, y = Segra, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1))) + scale_y_continuous(limits=c(0,1), breaks=seq(0,1,by=0.10)) +
  scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
  scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab("ß ethnic conservative") + ylab("Exposure") + 
  theme_bw() +  theme( axis.title.x = (element_text(size = 15)), axis.title.y = (element_text(size = 15)), axis.text.x =  (element_text(size = 13)),axis.text.y =  (element_text(size = 15)), legend.title = element_text(size = 13) ,legend.text = element_text(size = 13), plot.title=element_text(hjust = 0.5)) + theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
  
# ggsave("images/dom_con.jpg",plot = last_plot(),
#   device = NULL,path = NULL, 
#   scale = 1,
#   width = 10,
#   height = 4,
#   units = c("in", "cm", "mm"),
#   dpi = 300,
#   limitsize = FALSE)
# 


ggpubr::ggarrange(dom_libpic,dom_conpic, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

ggsave("images/comb_val.jpg",plot = last_plot(),
  device = NULL,path = NULL, 
  scale = 1,
 width = 8,
  height = 6,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = FALSE)



# robustness table

row_lib <-  c("\\multicolumn{17}{|c|}{Baseline: sensitivity to value liberal}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Exposure} & \\multicolumn{8}{|c|}{Value Exposure}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
# note
"$\\beta$ dom & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"liberal & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")

row_con <- c("\\multicolumn{17}{|c|}{Baseline: sensitivity to ethnic conservative}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Exposure} & \\multicolumn{8}{|c|}{Value Exposure}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
# note
"$\\beta$ dom & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
 & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
" conservative & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")


table_lib <- xtable(dom_lib[,c("dominant_circle","et_sq_bl_mean","et_sq_bl_sd","et_cl_bl_mean","et_cl_bl_sd","et_sq_or_mean","et_sq_or_sd","et_cl_or_mean","et_cl_or_sd","vl_sq_bl_mean","vl_sq_bl_sd","vl_cl_bl_mean","vl_cl_bl_sd","vl_sq_or_mean","vl_sq_or_sd","vl_cl_or_mean","vl_cl_or_sd")], digits = 3)
align(table_lib) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"

addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <- row_lib


print(table_lib,type = "latex", file = "latex/dom_lib_rb.tex", include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")




table_con <- xtable(dom_con[,c("dominant_square","et_sq_bl_mean","et_sq_bl_sd","et_cl_bl_mean","et_cl_bl_sd","et_sq_or_mean","et_sq_or_sd","et_cl_or_mean","et_cl_or_sd","vl_sq_bl_mean","vl_sq_bl_sd","vl_cl_bl_mean","vl_cl_bl_sd","vl_sq_or_mean","vl_sq_or_sd","vl_cl_or_mean","vl_cl_or_sd")], digits = 3)
align(table_con) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"

addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <-  row_con


print(table_con,type = "latex", file = "latex/dom_con_rb.tex", include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")


```


```{r sens_secondary, fig.width=30, fig.cap="Test mechanism: increase secondary preference, all determinism high", echo=FALSE}

# database filter
excl <- names(value_basic) %in% c("run","density","step")
sec_crl <- value_basic[!excl] %>% filter(ID == "sec_crl") %>%   #,  secondary_circle == 0 & dominant_square == 0 & secondary_square == 0)
  group_by(ID,secondary_circle, dominant_circle,dominant_square,secondary_square,fraction_blue,circle_blue,circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 

# graph

data_f <- sec_crl %>% gather(key= subgroup, value = Segra, et_sq_bl_mean, vl_sq_bl_mean, et_cl_bl_mean, vl_cl_bl_mean, et_sq_or_mean, vl_sq_or_mean, et_cl_or_mean, vl_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("et_sq_bl_mean","et_cl_bl_mean","et_sq_or_mean","et_cl_or_mean"), "values" = c("vl_sq_bl_mean","vl_cl_bl_mean","vl_sq_or_mean","vl_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("et_sq_bl_mean","vl_sq_bl_mean","et_sq_or_mean","vl_sq_or_mean"), "liberal" = c("et_cl_bl_mean","vl_cl_bl_mean","et_cl_or_mean","vl_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("et_sq_bl_mean","vl_sq_bl_mean","et_cl_bl_mean","vl_cl_bl_mean"),"minority" = c("et_sq_or_mean","vl_sq_or_mean","et_cl_or_mean","vl_cl_or_mean")), "local"))

sec_crl_pic <- ggplot(data = data_f, aes(x = secondary_circle, y = Segra, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1))) + scale_y_continuous(limits=c(0,1), breaks=seq(0,1,by=0.10)) +
#geom_hline(yintercept = 0.50, color = "red") +
 scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
  scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab("ß ethnic liberal") + ylab("Exposure") + 
  theme_bw() +  theme( axis.title.x = (element_text(size = 15)), axis.title.y = (element_text(size = 15)), axis.text.x =  (element_text(size = 13)),axis.text.y =  (element_text(size = 15)), legend.title = element_text(size = 13) ,legend.text = element_text(size = 13), plot.title=element_text(hjust = 0.5)) + theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
  
# ggsave("images/dom_lib.jpg",plot = last_plot(),
#   device = NULL,path = NULL, 
#   scale = 1,
#   width = 10,
#   height = 4,
#   units = c("in", "cm", "mm"),
#   dpi = 300,
#   limitsize = FALSE)


# sensitivity to conservative
 
excl <- names(value_basic) %in% c("run","density","step")
sec_sqr <- value_basic[!excl] %>% filter(ID == "sec_sqr") %>%
   group_by(ID,secondary_square, dominant_square,dominant_circle,secondary_circle,fraction_blue,circle_blue,circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 


# graph

data_f <- sec_sqr %>% gather(key= subgroup, value = Segra, et_sq_bl_mean, vl_sq_bl_mean, et_cl_bl_mean, vl_cl_bl_mean, et_sq_or_mean, vl_sq_or_mean, et_cl_or_mean, vl_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("et_sq_bl_mean","et_cl_bl_mean","et_sq_or_mean","et_cl_or_mean"), "values" = c("vl_sq_bl_mean","vl_cl_bl_mean","vl_sq_or_mean","vl_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("et_sq_bl_mean","vl_sq_bl_mean","et_sq_or_mean","vl_sq_or_mean"), "liberal" = c("et_cl_bl_mean","vl_cl_bl_mean","et_cl_or_mean","vl_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("et_sq_bl_mean","vl_sq_bl_mean","et_cl_bl_mean","vl_cl_bl_mean"),"minority" = c("et_sq_or_mean","vl_sq_or_mean","et_cl_or_mean","vl_cl_or_mean")), "local"))

sec_sqr_pic <- ggplot(data = data_f, aes(x = secondary_square, y = Segra, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1))) + scale_y_continuous(limits=c(0,1), breaks=seq(0,1,by=0.10)) +
  scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
  scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab("ß value conservative") + ylab("Exposure") + 
  theme_bw() +  theme( axis.title.x = (element_text(size = 15)), axis.title.y = (element_text(size = 15)), axis.text.x =  (element_text(size = 13)),axis.text.y =  (element_text(size = 15)), legend.title = element_text(size = 13) ,legend.text = element_text(size = 13), plot.title=element_text(hjust = 0.5)) + theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
  
# ggsave("images/dom_con.jpg",plot = last_plot(),
#   device = NULL,path = NULL, 
#   scale = 1,
#   width = 10,
#   height = 4,
#   units = c("in", "cm", "mm"),
#   dpi = 300,
#   limitsize = FALSE)
# 


ggpubr::ggarrange(sec_crl_pic,sec_sqr_pic, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

ggsave("images/comb_sec_bln.jpg",plot = last_plot(),
  device = NULL,path = NULL, 
  scale = 1,
 width = 8,
  height = 6,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = FALSE)



# robustness table

row_lib <-  c("\\multicolumn{17}{|c|}{Baseline: increase ethnic liberal}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Exposure} & \\multicolumn{8}{|c|}{Value Exposure}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
# note
"$\\beta$ ethnic & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"liberal & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")

row_con <- c("\\multicolumn{17}{|c|}{Baseline: increase value conservative}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Exposure} & \\multicolumn{8}{|c|}{Value Exposure}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
# note
"$\\beta$ value & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
 & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
" conservative & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")


table_lib <- xtable(sec_crl[,c("secondary_circle","et_sq_bl_mean","et_sq_bl_sd","et_cl_bl_mean","et_cl_bl_sd","et_sq_or_mean","et_sq_or_sd","et_cl_or_mean","et_cl_or_sd","vl_sq_bl_mean","vl_sq_bl_sd","vl_cl_bl_mean","vl_cl_bl_sd","vl_sq_or_mean","vl_sq_or_sd","vl_cl_or_mean","vl_cl_or_sd")], digits = 3)
align(table_lib) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"

addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <- row_lib


print(table_lib,type = "latex", file = "latex/sec_crl_rb.tex", include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")




table_con <- xtable(sec_sqr[,c("secondary_square","et_sq_bl_mean","et_sq_bl_sd","et_cl_bl_mean","et_cl_bl_sd","et_sq_or_mean","et_sq_or_sd","et_cl_or_mean","et_cl_or_sd","vl_sq_bl_mean","vl_sq_bl_sd","vl_cl_bl_mean","vl_cl_bl_sd","vl_sq_or_mean","vl_sq_or_sd","vl_cl_or_mean","vl_cl_or_sd")], digits = 3)
align(table_con) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"

addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <-  row_con


print(table_con,type = "latex", file = "latex/sec_sqr_rb.tex", include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")


```

```{r asym, fig.width=30, fig.cap="Baseline asymmetric conditions", echo=FALSE}


# database filter
excl <- names(asym_dom) %in% c("run", "ID","density","step")
dataset_sa <- asym_dom[!excl] %>% group_by(dominant,circle_orange,circle_blue,fraction_blue,secondary) %>% summarise_all(c("mean"= mean,"sd"= sd)) 

xlab_t <- "ß dominant"

row_exp <- c("\\multicolumn{17}{|c|}{Ethnic asymmetric condition: Exposure}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Exposure} & \\multicolumn{8}{|c|}{Value Exposure}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ sec = 0 & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
" & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")

row_prox <- c("\\multicolumn{17}{|c|}{Ethnic Asymmetric condition: Spatial Proximity}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Proximity} & \\multicolumn{8}{|c|}{Value Proximity}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ sec = 0 & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
" & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")



tablerb_expname <- "latex/asym_rb_exp.tex"
tablerb_proxname <- "latex/asym_rb_prox.tex"

plotname <- "images/asym_dom.jpg"



# graph

data_exp <- dataset_sa %>% gather(key= subgroup, value = Expo, et_sq_bl_mean, vl_sq_bl_mean, et_cl_bl_mean, vl_cl_bl_mean, et_sq_or_mean, vl_sq_or_mean, et_cl_or_mean, vl_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("et_sq_bl_mean","et_cl_bl_mean","et_sq_or_mean","et_cl_or_mean"), "values" = c("vl_sq_bl_mean","vl_cl_bl_mean","vl_sq_or_mean","vl_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("et_sq_bl_mean","vl_sq_bl_mean","et_sq_or_mean","vl_sq_or_mean"), "liberal" = c("et_cl_bl_mean","vl_cl_bl_mean","et_cl_or_mean","vl_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("et_sq_bl_mean","vl_sq_bl_mean","et_cl_bl_mean","vl_cl_bl_mean"),"minority" = c("et_sq_or_mean","vl_sq_or_mean","et_cl_or_mean","vl_cl_or_mean")), "local"))

fig_exp <- ggplot(data = data_exp, aes(x = dominant, y = Expo, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1))) + scale_y_continuous(limits=c(0,1), breaks=seq(0,1,by=0.10)) +
  geom_vline(xintercept = 20, color = "red") +
  scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
  scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab("") + ylab("Exposure") + 
  theme_bw() +  theme( axis.title.x  = element_blank(), axis.title.y = (element_text(size = 15)), axis.text.x  = (element_text(size = 10)) ,axis.text.y =  (element_text(size = 15)), legend.title = element_text(size = 13) ,legend.text = element_text(size = 13), plot.title=element_text(hjust = 0.5)) + theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
 
tablerb_exp <- xtable(dataset_sa[,c("dominant","et_sq_bl_mean","et_sq_bl_sd","et_cl_bl_mean","et_cl_bl_sd","et_sq_or_mean","et_sq_or_sd","et_cl_or_mean","et_cl_or_sd","vl_sq_bl_mean","vl_sq_bl_sd","vl_cl_bl_mean","vl_cl_bl_sd","vl_sq_or_mean","vl_sq_or_sd","vl_cl_or_mean","vl_cl_or_sd")], digits = 3)
align(tablerb_exp) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"

addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <-  row_exp

print(tablerb_exp,type = "latex", file = tablerb_expname, include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")


## Spatial proximity baseline asymmetric

# graph

data_prox <- dataset_sa %>% gather(key= subgroup, value = Prox, de_sq_bl_mean, dv_sq_bl_mean, de_cl_bl_mean, dv_cl_bl_mean, de_sq_or_mean, dv_sq_or_mean, de_cl_or_mean, dv_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("de_sq_bl_mean","de_cl_bl_mean","de_sq_or_mean","de_cl_or_mean"), "values" = c("dv_sq_bl_mean","dv_cl_bl_mean","dv_sq_or_mean","dv_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("de_sq_bl_mean","dv_sq_bl_mean","de_sq_or_mean","dv_sq_or_mean"), "liberal" = c("de_cl_bl_mean","dv_cl_bl_mean","de_cl_or_mean","dv_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("de_sq_bl_mean","dv_sq_bl_mean","de_cl_bl_mean","dv_cl_bl_mean"),"minority" = c("de_sq_or_mean","dv_sq_or_mean","de_cl_or_mean","dv_cl_or_mean")), "local"))

fig_prox <- ggplot(data = data_prox, aes(x = dominant, y = Prox, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1))) + scale_y_continuous(limits=c(min(data_prox$Prox),max(data_prox$Prox)), breaks=seq(0,max(data_prox$Prox),by=0.50)) +
  geom_vline(xintercept = 20, color = "red") +
  scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
  scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab(xlab_t) + ylab("Spatial Proximity") + 
  theme_bw() +  theme( axis.title.x = (element_text(size = 15)), axis.title.y = (element_text(size = 15)), axis.text.x =  (element_text(size = 15)),axis.text.y =  (element_text(size = 15)), legend.title = element_text(size = 13) ,legend.text = element_text(size = 13), plot.title=element_text(hjust = 0.5)) + theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
 
# robustness table

tablerb_prox <- xtable(dataset_sa[,c("dominant","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
align(tablerb_prox) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"

addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <-  row_prox
print(tablerb_prox,type = "latex", file = tablerb_proxname , include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")


# combined image

ggpubr::ggarrange(fig_exp,fig_prox, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

ggsave(plotname,plot = last_plot(),
  device = NULL,path = NULL, 
  scale = 1,
  width = 8,
  height = 6,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = FALSE)


```

```{r dislib, fig.width=30, fig.cap="Effect distribution liberal minority, asymmetric based condition", echo=FALSE}

# CHECK LATEX! Re-edited

# database filter
excl <- names(dislib) %in% c("run", "ID","density","step","eth_lib_loc","eth_lib_min","val_con_loc","val_con_min")
dataset_sa <- dislib[!excl] %>% group_by(fraction_blue,circle_blue,eth_con_loc,eth_con_min,val_lib_loc,val_lib_min,circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 

xlab_t <- "% liberal minority"

row_exp <- c("\\multicolumn{17}{|c|}{Ethnic asymmetric condition: Exposure}  \\\\\\hline\n",
   "$\\beta$ dom = 20 &  \\multicolumn{8}{|c|}{Ethnic Exposure} & \\multicolumn{8}{|c|}{Value Exposure}   \\\\\\n",
     "$\\beta$ sec = 0 &  \\multicolumn{8}{|c|}{} & \\multicolumn{8}{|c|}{}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\%$ liberal & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"minority  & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")

row_prox <-  c("\\multicolumn{17}{|c|}{Ethnic asymmetric condition: Spatial Proximity}  \\\\\\hline\n",
   "$\\beta$ dom = 20 &  \\multicolumn{8}{|c|}{Ethnic Exposure} & \\multicolumn{8}{|c|}{Value Exposure}   \\\\\\n",
     "$\\beta$ sec = 0 &  \\multicolumn{8}{|c|}{} & \\multicolumn{8}{|c|}{}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\%$ liberal & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"minority  & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")




tablerb_expname <- "latex/dislib_rb_exp.tex"
tablerb_proxname <- "latex/dislib_rb_prox.tex"

plotname <- "images/comb_dislib.jpg"



# graph

dataset_sa <- subset(dataset_sa, circle_orange >= 10 & circle_orange <= 90)
data_exp <- dataset_sa %>% gather(key= subgroup, value = Expo, et_sq_bl_mean, vl_sq_bl_mean, et_cl_bl_mean, vl_cl_bl_mean, et_sq_or_mean, vl_sq_or_mean, et_cl_or_mean, vl_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("et_sq_bl_mean","et_cl_bl_mean","et_sq_or_mean","et_cl_or_mean"), "values" = c("vl_sq_bl_mean","vl_cl_bl_mean","vl_sq_or_mean","vl_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("et_sq_bl_mean","vl_sq_bl_mean","et_sq_or_mean","vl_sq_or_mean"), "liberal" = c("et_cl_bl_mean","vl_cl_bl_mean","et_cl_or_mean","vl_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("et_sq_bl_mean","vl_sq_bl_mean","et_cl_bl_mean","vl_cl_bl_mean"),"minority" = c("et_sq_or_mean","vl_sq_or_mean","et_cl_or_mean","vl_cl_or_mean")), "local"))

fig_exp <- ggplot(data = data_exp, aes(x = circle_orange, y = Expo, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(10,90 ,by = 10))) + scale_y_continuous(limits=c(0,1), breaks=seq(0,1,by=0.10)) +
   geom_vline(xintercept = 50, color = "red") +
 scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
  scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab("") + ylab("Exposure") + 
  theme_bw() +  theme( axis.title.x  = element_blank(), axis.title.y = (element_text(size = 15)), axis.text.x  = (element_text(size = 10)) ,axis.text.y =  (element_text(size = 15)), legend.title = element_text(size = 13) ,legend.text = element_text(size = 13), plot.title=element_text(hjust = 0.5)) + theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
 
tablerb_exp <- xtable(dataset_sa[,c("circle_orange","et_sq_bl_mean","et_sq_bl_sd","et_cl_bl_mean","et_cl_bl_sd","et_sq_or_mean","et_sq_or_sd","et_cl_or_mean","et_cl_or_sd","vl_sq_bl_mean","vl_sq_bl_sd","vl_cl_bl_mean","vl_cl_bl_sd","vl_sq_or_mean","vl_sq_or_sd","vl_cl_or_mean","vl_cl_or_sd")], digits = 3)
align(tablerb_exp) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"

addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <-  row_exp

print(tablerb_exp,type = "latex", file = tablerb_expname, include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")


## Spatial proximity baseline asymmetric

# graph

data_prox <- dataset_sa %>% gather(key= subgroup, value = Prox, de_sq_bl_mean, dv_sq_bl_mean, de_cl_bl_mean, dv_cl_bl_mean, de_sq_or_mean, dv_sq_or_mean, de_cl_or_mean, dv_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("de_sq_bl_mean","de_cl_bl_mean","de_sq_or_mean","de_cl_or_mean"), "values" = c("dv_sq_bl_mean","dv_cl_bl_mean","dv_sq_or_mean","dv_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("de_sq_bl_mean","dv_sq_bl_mean","de_sq_or_mean","dv_sq_or_mean"), "liberal" = c("de_cl_bl_mean","dv_cl_bl_mean","de_cl_or_mean","dv_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("de_sq_bl_mean","dv_sq_bl_mean","de_cl_bl_mean","dv_cl_bl_mean"),"minority" = c("de_sq_or_mean","dv_sq_or_mean","de_cl_or_mean","dv_cl_or_mean")), "local"))

fig_prox <- ggplot(data = data_prox, aes(x = circle_orange, y = Prox, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(10,90 ,by = 10))) + scale_y_continuous(limits=c(min(data_prox$Prox),max(data_prox$Prox)), breaks = seq(0,max(data_prox$Prox), by = 0.5)) +
   geom_vline(xintercept = 50, color = "red") +
 scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
  scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab(xlab_t) + ylab("Spatial Proximity") + 
theme_bw() +  theme( axis.title.x = (element_text(size = 15)), axis.title.y = (element_text(size = 15)), axis.text.x =  (element_text(size = 15)),axis.text.y =  (element_text(size = 15)), legend.title = element_text(size = 13) ,legend.text = element_text(size = 13), plot.title=element_text(hjust = 0.5)) + theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
 
# robustness table

tablerb_prox <- xtable(dataset_sa[,c("circle_orange","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
align(tablerb_prox) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"

addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <-  row_prox
print(tablerb_prox,type = "latex", file = tablerb_proxname , include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")


# combined image

ggpubr::ggarrange(fig_exp,fig_prox, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

ggsave(plotname,plot = last_plot(),
  device = NULL,path = NULL, 
  scale = 1,
  width = 8,
  height = 6,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = FALSE)


```

```{r sa_dom_50prox, fig.width=30, fig.cap="Sensitivity proximity ethnic conservative local, baseline asymmetric conditions", echo=FALSE}

# database filter
excl <- names(sa_asym) %in% c("run", "ID","density","step","eth_lib_loc","val_con_loc","eth_lib_min","val_con_min")
dataset_sa <- sa_asym[!excl] %>% filter(val_lib_loc  == 20,eth_con_min == 20, val_lib_min == 20)  %>% 
 filter(circle_orange == 50) %>%
  group_by(eth_con_loc,fraction_blue,circle_blue, circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 

xlab_t <- "ß ethnic conservative local"



# graph

data_prox <- dataset_sa %>% gather(key= subgroup, value = Prox, de_sq_bl_mean, dv_sq_bl_mean, de_cl_bl_mean, dv_cl_bl_mean, de_sq_or_mean, dv_sq_or_mean, de_cl_or_mean, dv_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("de_sq_bl_mean","de_cl_bl_mean","de_sq_or_mean","de_cl_or_mean"), "values" = c("dv_sq_bl_mean","dv_cl_bl_mean","dv_sq_or_mean","dv_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("de_sq_bl_mean","dv_sq_bl_mean","de_sq_or_mean","dv_sq_or_mean"), "liberal" = c("de_cl_bl_mean","dv_cl_bl_mean","de_cl_or_mean","dv_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("de_sq_bl_mean","dv_sq_bl_mean","de_cl_bl_mean","dv_cl_bl_mean"),"minority" = c("de_sq_or_mean","dv_sq_or_mean","de_cl_or_mean","dv_cl_or_mean")), "local"))

prox_eth_con_loc <- ggplot(data = data_prox, aes(x = eth_con_loc, y = Prox, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1)))  + scale_y_continuous(limits=c(min(data_prox$Prox),5), breaks=seq(0,5,by=0.50)) +
  #    facet_wrap(~ circle_orange, labeller = labeller(circle_orange = circle_orange.labs)) +
    geom_vline(xintercept = 20, color = "red") +

  scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
  scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab(xlab_t) + ylab("Spatial Proximity") + 
  theme_bw() +  theme( axis.title.x = (element_text(size = 15)), axis.title.y = (element_text(size = 15)), axis.text.x =  (element_text(size = 12)),axis.text.y =  (element_text(size = 15)), legend.title = element_text(size = 13) ,legend.text = element_text(size = 13),plot.title=element_text(hjust = 0.5)) + theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))




# database filter
excl <- names(sa_asym) %in% c("run", "ID","density","step","eth_lib_loc","val_con_loc","eth_lib_min","val_con_min")
dataset_sa <- sa_asym[!excl] %>% filter(eth_con_loc   == 20,eth_con_min == 20, val_lib_min == 20)  %>% 
 filter(circle_orange == 50) %>%
  group_by(val_lib_loc,fraction_blue,circle_blue, circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 

xlab_t <- "ß value liberal local"



# graph

data_prox <- dataset_sa %>% gather(key= subgroup, value = Prox, de_sq_bl_mean, dv_sq_bl_mean, de_cl_bl_mean, dv_cl_bl_mean, de_sq_or_mean, dv_sq_or_mean, de_cl_or_mean, dv_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("de_sq_bl_mean","de_cl_bl_mean","de_sq_or_mean","de_cl_or_mean"), "values" = c("dv_sq_bl_mean","dv_cl_bl_mean","dv_sq_or_mean","dv_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("de_sq_bl_mean","dv_sq_bl_mean","de_sq_or_mean","dv_sq_or_mean"), "liberal" = c("de_cl_bl_mean","dv_cl_bl_mean","de_cl_or_mean","dv_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("de_sq_bl_mean","dv_sq_bl_mean","de_cl_bl_mean","dv_cl_bl_mean"),"minority" = c("de_sq_or_mean","dv_sq_or_mean","de_cl_or_mean","dv_cl_or_mean")), "local"))

prox_val_lib_loc <-  ggplot(data = data_prox, aes(x = val_lib_loc, y = Prox, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1)))  + scale_y_continuous(limits=c(min(data_prox$Prox),5), breaks=seq(0,5,by=0.50)) +
  #    facet_wrap(~ circle_orange, labeller = labeller(circle_orange = circle_orange.labs)) +
    geom_vline(xintercept = 20, color = "red") +

  scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
  scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab(xlab_t) + ylab("Spatial Proximity") + 
  theme_bw() +  theme( axis.title.x = (element_text(size = 15)), axis.title.y = (element_text(size = 15)), axis.text.x =  (element_text(size = 12)),axis.text.y =  (element_text(size = 15)), legend.title = element_text(size = 13) ,legend.text = element_text(size = 13),plot.title=element_text(hjust = 0.5)) + theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))


# ggsave("images/val_lib_loc50.jpg",plot = fig_prox,
#   device = NULL,path = NULL, 
#   scale = 1,
#   width = 8,
#   height = 6,
#   units = c("in", "cm", "mm"),
#   dpi = 300,
#   limitsize = FALSE)


# database filter
excl <- names(sa_asym) %in% c("run", "ID","density","step","eth_lib_loc","val_con_loc","eth_lib_min","val_con_min")
dataset_sa <- sa_asym[!excl] %>% filter(eth_con_loc   == 20, val_lib_loc  == 20, val_lib_min == 20)  %>% 
 filter(circle_orange == 50) %>%
  group_by(eth_con_min,fraction_blue,circle_blue, circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 

xlab_t <- "ß ethnic conservative minority"



# graph

data_prox <- dataset_sa %>% gather(key= subgroup, value = Prox, de_sq_bl_mean, dv_sq_bl_mean, de_cl_bl_mean, dv_cl_bl_mean, de_sq_or_mean, dv_sq_or_mean, de_cl_or_mean, dv_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("de_sq_bl_mean","de_cl_bl_mean","de_sq_or_mean","de_cl_or_mean"), "values" = c("dv_sq_bl_mean","dv_cl_bl_mean","dv_sq_or_mean","dv_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("de_sq_bl_mean","dv_sq_bl_mean","de_sq_or_mean","dv_sq_or_mean"), "liberal" = c("de_cl_bl_mean","dv_cl_bl_mean","de_cl_or_mean","dv_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("de_sq_bl_mean","dv_sq_bl_mean","de_cl_bl_mean","dv_cl_bl_mean"),"minority" = c("de_sq_or_mean","dv_sq_or_mean","de_cl_or_mean","dv_cl_or_mean")), "local"))

prox_eth_con_min <- ggplot(data = data_prox, aes(x = eth_con_min, y = Prox, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1)))  + scale_y_continuous(limits=c(min(data_prox$Prox),5), breaks=seq(0,5,by=0.50)) +
  #    facet_wrap(~ circle_orange, labeller = labeller(circle_orange = circle_orange.labs)) +
    geom_vline(xintercept = 20, color = "red") +

  scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
  scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab(xlab_t) + ylab("Spatial Proximity") + 
  theme_bw() +  theme( axis.title.x = (element_text(size = 15)), axis.title.y = (element_text(size = 15)), axis.text.x =  (element_text(size = 12)),axis.text.y =  (element_text(size = 15)), legend.title = element_text(size = 13) ,legend.text = element_text(size = 13),plot.title=element_text(hjust = 0.5)) + theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))

# ggsave("images/eth_con_min50.jpg",plot = fig_prox,
#   device = NULL,path = NULL, 
#   scale = 1,
#   width = 8,
#   height = 6,
#   units = c("in", "cm", "mm"),
#   dpi = 300,
#   limitsize = FALSE)


# database filter
excl <- names(sa_asym) %in% c("run", "ID","density","step","eth_lib_loc","val_con_loc","eth_lib_min","val_con_min")
dataset_sa <- sa_asym[!excl] %>% filter(eth_con_loc   == 20, val_lib_loc  == 20, eth_con_min  == 20)  %>% 
 filter(circle_orange == 50) %>%
  group_by(val_lib_min,fraction_blue,circle_blue, circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 

xlab_t <- "ß value liberal minority"



# graph

data_prox <- dataset_sa %>% gather(key= subgroup, value = Prox, de_sq_bl_mean, dv_sq_bl_mean, de_cl_bl_mean, dv_cl_bl_mean, de_sq_or_mean, dv_sq_or_mean, de_cl_or_mean, dv_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("de_sq_bl_mean","de_cl_bl_mean","de_sq_or_mean","de_cl_or_mean"), "values" = c("dv_sq_bl_mean","dv_cl_bl_mean","dv_sq_or_mean","dv_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("de_sq_bl_mean","dv_sq_bl_mean","de_sq_or_mean","dv_sq_or_mean"), "liberal" = c("de_cl_bl_mean","dv_cl_bl_mean","de_cl_or_mean","dv_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("de_sq_bl_mean","dv_sq_bl_mean","de_cl_bl_mean","dv_cl_bl_mean"),"minority" = c("de_sq_or_mean","dv_sq_or_mean","de_cl_or_mean","dv_cl_or_mean")), "local"))

prox_val_lib_min <-  ggplot(data = data_prox, aes(x = val_lib_min, y = Prox, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1)))  + scale_y_continuous(limits=c(min(data_prox$Prox),5), breaks=seq(0,5,by=0.50)) +
  #    facet_wrap(~ circle_orange, labeller = labeller(circle_orange = circle_orange.labs)) +
    geom_vline(xintercept = 20, color = "red") +

  scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
  scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab(xlab_t) + ylab("Spatial Proximity") + 
  theme_bw() +  theme( axis.title.x = (element_text(size = 15)), axis.title.y = (element_text(size = 15)), axis.text.x =  (element_text(size = 12)),axis.text.y =  (element_text(size = 15)), legend.title = element_text(size = 13) ,legend.text = element_text(size = 13),plot.title=element_text(hjust = 0.5)) + theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))

ggpubr::ggarrange(prox_eth_con_loc,prox_val_lib_loc,prox_eth_con_min,prox_val_lib_min, nrow = 2, ncol = 2, common.legend = TRUE, legend = "bottom")


ggsave("images/sa_asym_bt.jpg",plot = last_plot(),
  device = NULL,path = NULL,
  scale = 1,
  width = 11,
  height = 8,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = FALSE)

```

```{r sa_dom_50exp, fig.width=30, fig.cap="exposure Sensitivity ethnic conservative local, baseline asymmetric conditions", echo=FALSE}
## NOT INCLUDED IN THE PAPER
# database filter
excl <- names(sa_asym) %in% c("run", "ID","density","step","eth_lib_loc","val_con_loc","eth_lib_min","val_con_min")
dataset_sa <- sa_asym[!excl] %>% filter(val_lib_loc  == 20,eth_con_min == 20, val_lib_min == 20)  %>% 
 filter(circle_orange == 50) %>%
  group_by(eth_con_loc,fraction_blue,circle_blue, circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 

xlab_t <- "ß ethnic conservative local"



# graph

data_exp <- dataset_sa %>% gather(key= subgroup, value = Expo, et_sq_bl_mean, vl_sq_bl_mean, et_cl_bl_mean, vl_cl_bl_mean, et_sq_or_mean, vl_sq_or_mean, et_cl_or_mean, vl_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("et_sq_bl_mean","et_cl_bl_mean","et_sq_or_mean","et_cl_or_mean"), "values" = c("vl_sq_bl_mean","vl_cl_bl_mean","vl_sq_or_mean","vl_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("et_sq_bl_mean","vl_sq_bl_mean","et_sq_or_mean","vl_sq_or_mean"), "liberal" = c("et_cl_bl_mean","vl_cl_bl_mean","et_cl_or_mean","vl_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("et_sq_bl_mean","vl_sq_bl_mean","et_cl_bl_mean","vl_cl_bl_mean"),"minority" = c("et_sq_or_mean","vl_sq_or_mean","et_cl_or_mean","vl_cl_or_mean")), "local"))

exp_eth_con_loc <- ggplot(data = data_exp, aes(x = eth_con_loc, y = Expo, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1)))  + scale_y_continuous(limits=c(0,1), breaks=seq(0,1,by=0.10)) +
  #    facet_wrap(~ circle_orange, labeller = labeller(circle_orange = circle_orange.labs)) +
    geom_vline(xintercept = 20, color = "red") +

  scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
  scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab(xlab_t) + ylab("Exposure") + 
  theme_bw() +  theme( axis.title.x = (element_text(size = 15)), axis.title.y = (element_text(size = 15)), axis.text.x =  (element_text(size = 12)),axis.text.y =  (element_text(size = 15)), legend.title = element_text(size = 13) ,legend.text = element_text(size = 13),plot.title=element_text(hjust = 0.5)) + theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
# ggsave("images/eth_con_loc50.jpg",plot = fig_expo,
#   device = NULL,path = NULL, 
#   scale = 1,
#   width = 8,
#   height = 6,
#   units = c("in", "cm", "mm"),
#   dpi = 300,
#   limitsize = FALSE)


# database filter
excl <- names(sa_asym) %in% c("run", "ID","density","step","eth_lib_loc","val_con_loc","eth_lib_min","val_con_min")
dataset_sa <- sa_asym[!excl] %>% filter(eth_con_loc   == 20,eth_con_min == 20, val_lib_min == 20)  %>% 
 filter(circle_orange == 50) %>%
  group_by(val_lib_loc,fraction_blue,circle_blue, circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 

xlab_t <- "ß value liberal local"



# graph

data_exp <- dataset_sa %>% gather(key= subgroup, value = Expo, et_sq_bl_mean, vl_sq_bl_mean, et_cl_bl_mean, vl_cl_bl_mean, et_sq_or_mean, vl_sq_or_mean, et_cl_or_mean, vl_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("et_sq_bl_mean","et_cl_bl_mean","et_sq_or_mean","et_cl_or_mean"), "values" = c("vl_sq_bl_mean","vl_cl_bl_mean","vl_sq_or_mean","vl_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("et_sq_bl_mean","vl_sq_bl_mean","et_sq_or_mean","vl_sq_or_mean"), "liberal" = c("et_cl_bl_mean","vl_cl_bl_mean","et_cl_or_mean","vl_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("et_sq_bl_mean","vl_sq_bl_mean","et_cl_bl_mean","vl_cl_bl_mean"),"minority" = c("et_sq_or_mean","vl_sq_or_mean","et_cl_or_mean","vl_cl_or_mean")), "local"))

exp_val_lib_loc <- ggplot(data = data_exp, aes(x = val_lib_loc, y = Expo, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1)))  + scale_y_continuous(limits=c(0,1), breaks=seq(0,1,by=0.10)) +
  #    facet_wrap(~ circle_orange, labeller = labeller(circle_orange = circle_orange.labs)) +
    geom_vline(xintercept = 20, color = "red") +

  scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
  scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab(xlab_t) + ylab("Exposure") + 
  theme_bw() +  theme( axis.title.x = (element_text(size = 15)), axis.title.y = (element_text(size = 15)), axis.text.x =  (element_text(size = 12)),axis.text.y =  (element_text(size = 15)), legend.title = element_text(size = 13) ,legend.text = element_text(size = 13),plot.title=element_text(hjust = 0.5)) + theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))

# ggsave("images/val_lib_loc50.jpg",plot = fig_expo,
#   device = NULL,path = NULL, 
#   scale = 1,
#   width = 8,
#   height = 6,
#   units = c("in", "cm", "mm"),
#   dpi = 300,
#   limitsize = FALSE)


# database filter
excl <- names(sa_asym) %in% c("run", "ID","density","step","eth_lib_loc","val_con_loc","eth_lib_min","val_con_min")
dataset_sa <- sa_asym[!excl] %>% filter(eth_con_loc   == 20, val_lib_loc  == 20, val_lib_min == 20)  %>% 
 filter(circle_orange == 50) %>%
  group_by(eth_con_min,fraction_blue,circle_blue, circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 


###

xlab_t <- "ß ethnic conservative minority"

# graph

data_exp <- dataset_sa %>% gather(key= subgroup, value = Expo, et_sq_bl_mean, vl_sq_bl_mean, et_cl_bl_mean, vl_cl_bl_mean, et_sq_or_mean, vl_sq_or_mean, et_cl_or_mean, vl_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("et_sq_bl_mean","et_cl_bl_mean","et_sq_or_mean","et_cl_or_mean"), "values" = c("vl_sq_bl_mean","vl_cl_bl_mean","vl_sq_or_mean","vl_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("et_sq_bl_mean","vl_sq_bl_mean","et_sq_or_mean","vl_sq_or_mean"), "liberal" = c("et_cl_bl_mean","vl_cl_bl_mean","et_cl_or_mean","vl_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("et_sq_bl_mean","vl_sq_bl_mean","et_cl_bl_mean","vl_cl_bl_mean"),"minority" = c("et_sq_or_mean","vl_sq_or_mean","et_cl_or_mean","vl_cl_or_mean")), "local"))

exp_eth_con_min <-  ggplot(data = data_exp, aes(x = eth_con_min, y = Expo, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1)))  + scale_y_continuous(limits=c(0,1), breaks=seq(0,1,by=0.10)) +
  #    facet_wrap(~ circle_orange, labeller = labeller(circle_orange = circle_orange.labs)) +
    geom_vline(xintercept = 20, color = "red") +

  scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
  scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab(xlab_t) + ylab("Exposure") + 
  theme_bw() +  theme( axis.title.x = (element_text(size = 15)), axis.title.y = (element_text(size = 15)), axis.text.x =  (element_text(size = 12)),axis.text.y =  (element_text(size = 15)), legend.title = element_text(size = 13) ,legend.text = element_text(size = 13),plot.title=element_text(hjust = 0.5)) + theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))



# database filter
excl <- names(sa_asym) %in% c("run", "ID","density","step","eth_lib_loc","val_con_loc","eth_lib_min","val_con_min")
dataset_sa <- sa_asym[!excl] %>% filter(eth_con_loc   == 20, val_lib_loc  == 20, eth_con_min  == 20)  %>% 
 filter(circle_orange == 50) %>%
  group_by(val_lib_min,fraction_blue,circle_blue, circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 

###
xlab_t <- "ß value liberal minority"

# graph

data_exp <- dataset_sa %>% gather(key= subgroup, value = Expo, et_sq_bl_mean, vl_sq_bl_mean, et_cl_bl_mean, vl_cl_bl_mean, et_sq_or_mean, vl_sq_or_mean, et_cl_or_mean, vl_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("et_sq_bl_mean","et_cl_bl_mean","et_sq_or_mean","et_cl_or_mean"), "values" = c("vl_sq_bl_mean","vl_cl_bl_mean","vl_sq_or_mean","vl_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("et_sq_bl_mean","vl_sq_bl_mean","et_sq_or_mean","vl_sq_or_mean"), "liberal" = c("et_cl_bl_mean","vl_cl_bl_mean","et_cl_or_mean","vl_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("et_sq_bl_mean","vl_sq_bl_mean","et_cl_bl_mean","vl_cl_bl_mean"),"minority" = c("et_sq_or_mean","vl_sq_or_mean","et_cl_or_mean","vl_cl_or_mean")), "local"))

exp_val_lib_min <- ggplot(data = data_exp, aes(x = val_lib_min, y = Expo, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1)))  + scale_y_continuous(limits=c(0,1), breaks=seq(0,1,by=0.10)) +
  #    facet_wrap(~ circle_orange, labeller = labeller(circle_orange = circle_orange.labs)) +
    geom_vline(xintercept = 20, color = "red") +

  scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
  scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab(xlab_t) + ylab("Exposure") + 
  theme_bw() +  theme( axis.title.x = (element_text(size = 15)), axis.title.y = (element_text(size = 15)), axis.text.x =  (element_text(size = 12)),axis.text.y =  (element_text(size = 15)), legend.title = element_text(size = 13) ,legend.text = element_text(size = 13),plot.title=element_text(hjust = 0.5)) + theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))

ggpubr::ggarrange(exp_eth_con_loc,exp_val_lib_loc,exp_eth_con_min,exp_val_lib_min, nrow = 2, ncol = 2, common.legend = TRUE, legend = "right")


ggsave("images/exp_sa_asym_bt.jpg",plot = last_plot(),
  device = NULL,path = NULL,
  scale = 1,
  width = 11,
  height = 8,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = FALSE)

```

```{r sa_vllblc,  fig.cap="Sensitivity proximity value liberal locals, distribution liberals", echo=FALSE}

# database filter
excl <- names(sa_asym) %in% c("run", "ID","density","step","eth_lib_loc","val_con_loc","eth_lib_min","val_con_min")
dataset_sa <- sa_asym[!excl] %>% filter(eth_con_loc  == 20,eth_con_min   == 20,val_lib_min == 20)  %>% 
group_by(val_lib_loc ,fraction_blue,circle_blue, circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 

plotname <- "images/vllblc.jpg"
xlab_t <- "ß value liberal local"

xvalues <- c(dataset_sa$de_sq_bl_mean,dataset_sa$de_cl_bl_mean,dataset_sa$de_sq_or_mean,dataset_sa$de_cl_or_mean,
       dataset_sa$dv_sq_bl_mean,dataset_sa$dv_cl_bl_mean,dataset_sa$dv_sq_or_mean,dataset_sa$dv_cl_or_mean)

 expo_pic <-   ggplot(data = dataset_sa) + 
  geom_point(aes(x = dataset_sa$de_sq_bl_mean, y = dataset_sa$et_sq_bl_mean),color = "black", fill = "blue", shape = 22, size = 5) +
  geom_point(aes(x = dataset_sa$de_cl_bl_mean, y = dataset_sa$et_cl_bl_mean),color = "black",fill = "blue", shape = 21, size = 5) +
  geom_point(aes(x = dataset_sa$de_sq_or_mean, y = dataset_sa$et_sq_or_mean),color = "black", fill = "orange", shape = 22, size = 5) +
  geom_point(aes(x = dataset_sa$de_cl_or_mean, y = dataset_sa$et_cl_or_mean),color = "black", fill = "orange", shape = 21, size = 5) +

  geom_point(aes(x = dataset_sa$dv_sq_bl_mean, y = dataset_sa$vl_sq_bl_mean),color = "black", fill = "blue", shape = 8, size = 5.1) + 
   geom_point(aes(x = dataset_sa$dv_sq_bl_mean, y = dataset_sa$vl_sq_bl_mean),color = "black", fill = "blue", shape = 22, size = 5) + 
  
   geom_point(aes(x = dataset_sa$dv_cl_bl_mean, y = dataset_sa$vl_cl_bl_mean),color = "black",fill = "blue", shape = 8, size = 5.1) + 
  geom_point(aes(x = dataset_sa$dv_cl_bl_mean, y = dataset_sa$vl_cl_bl_mean),color = "black",fill = "blue", shape = 21, size = 5) + 
  
    geom_point(aes(x = dataset_sa$dv_sq_or_mean, y = dataset_sa$vl_sq_or_mean),color = "black", fill = "orange", shape = 8, size = 5.1) +
  geom_point(aes(x = dataset_sa$dv_sq_or_mean, y = dataset_sa$vl_sq_or_mean),color = "black", fill = "orange", shape = 22, size = 5) +
  
  geom_point(aes(x = dataset_sa$dv_cl_or_mean, y = dataset_sa$vl_cl_or_mean),color = "black", fill = "orange", shape = 8, size = 5.1) +
geom_point(aes(x = dataset_sa$dv_cl_or_mean, y = dataset_sa$vl_cl_or_mean),color = "black", fill = "orange", shape = 21, size = 5) +
  
 scale_x_continuous(limits = c(min(xvalues),max(xvalues)), breaks = seq(0,max(xvalues), by = 0.5)) + 
  scale_y_continuous(breaks= seq(0,1,by=0.1)) + 
  geom_vline(xintercept = 1, color = "red") +
  xlab("Spatial proximity") + ylab("Exposure") +
  theme_bw() + theme( 
    axis.title.x = (element_text(size = 13)), axis.title.y = (element_text(size = 15)),
    axis.text.x =  (element_text(size = 12)), axis.text.y =  (element_text(size = 15)), 
    legend.title = element_text(size = 13),legend.position = "bottom", legend.text = element_text(size = 13),
    plot.title=element_text(hjust = 0.5), plot.caption = element_text(hjust= 0.5, size = 11), plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
 

data_prox <- dataset_sa  %>% gather(key= subgroup, value = Prox, de_sq_bl_mean, dv_sq_bl_mean, de_cl_bl_mean, dv_cl_bl_mean, de_sq_or_mean, dv_sq_or_mean, de_cl_or_mean, dv_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("de_sq_bl_mean","de_cl_bl_mean","de_sq_or_mean","de_cl_or_mean"), "values" = c("dv_sq_bl_mean","dv_cl_bl_mean","dv_sq_or_mean","dv_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("de_sq_bl_mean","dv_sq_bl_mean","de_sq_or_mean","dv_sq_or_mean"), "liberal" = c("de_cl_bl_mean","dv_cl_bl_mean","de_cl_or_mean","dv_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("de_sq_bl_mean","dv_sq_bl_mean","de_cl_bl_mean","dv_cl_bl_mean"),"minority" = c("de_sq_or_mean","dv_sq_or_mean","de_cl_or_mean","dv_cl_or_mean")), "local"))


  
prox_pic <- ggplot(data = data_prox, aes(x = val_lib_loc, y = Prox, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1))) + scale_y_continuous(limits=c(min(data_prox$Prox),max(data_prox$Prox)), breaks=seq(0,max(data_prox$Prox),by=0.50)) +
 facet_wrap(~ circle_orange, dir = "v", labeller = labeller(circle_orange = circle_orange.labs)) +
    geom_vline(xintercept = 20, color = "red") +  geom_hline(yintercept = 1, color = "red") +
  scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
   scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab(xlab_t) + ylab("Spatial Proximity") + 
  theme_bw() +  theme( 
    axis.title.x = (element_text(size = 13)), axis.title.y = (element_text(size = 15)),
    axis.text.x =  (element_text(size = 12)), axis.text.y =  (element_text(size = 15)), 
    strip.text = element_text(size=13),
    legend.title = element_text(size = 13),legend.position = "bottom", legend.text = element_text(size = 14),
    plot.title=element_text(hjust = 0.5), plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 

#, plot.caption = element_text(hjust= 0.5, size = 11)
ggpubr::ggarrange(prox_pic, expo_pic, common.legend = TRUE, legend = "bottom", widths = c(1.3,1))

ggsave(plotname,plot = last_plot(),
  device = NULL,path = NULL,
  scale = 1,
  width = 12,
  height = 9,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = FALSE)

```

```{r sa_vllblc_table,  fig.cap="TABLE Sensitivity proximity value liberal locals, distribution liberals", echo=FALSE}

# database filter

excl <- names(sa_asym) %in% c("run", "ID","density","step","eth_lib_loc","val_con_loc","eth_lib_min","val_con_min")
dataset_sa <- sa_asym[!excl] %>% filter(eth_con_loc  == 20,eth_con_min   == 20,val_lib_min == 20)  %>% 
group_by(val_lib_loc ,fraction_blue,circle_blue, circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 


df_vllblc50 <- dataset_sa %>%  filter(circle_orange == 50)
tablerb_prox50 <- xtable(df_vllblc50[,c("val_lib_loc","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
align(tablerb_prox50) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"
addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <-  c("\\multicolumn{17}{|c|}{Ethnic Asymmetry, $50 \\%$ Liberal Migrants: Spatial Proximity}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Proximity} & \\multicolumn{8}{|c|}{Value Proximity}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ value & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"liberal local & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")
print(tablerb_prox50,type = "latex", file = "latex/vllblc50.tex"  , include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")


df_vllblc20 <- dataset_sa %>%  filter(circle_orange == 20)
tablerb_prox20 <- xtable(df_vllblc20[,c("val_lib_loc","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
align(tablerb_prox20) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"
addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <- c("\\multicolumn{17}{|c|}{Ethnic Asymmetry, $20 \\%$ Liberal Migrants: Spatial Proximity}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Proximity} & \\multicolumn{8}{|c|}{Value Proximity}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ value & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"liberal local & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")
print(tablerb_prox20,type = "latex", file = "latex/vllblc20.tex" , include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")

df_vllblc80 <- dataset_sa %>%  filter(circle_orange == 80)
tablerb_prox80 <- xtable(df_vllblc80[,c("val_lib_loc","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
align(tablerb_prox80) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"
addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <- c("\\multicolumn{17}{|c|}{Ethnic Asymmetry, $80 \\%$ Liberal Migrants: Spatial Proximity}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Proximity} & \\multicolumn{8}{|c|}{Value Proximity}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ value & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"liberal local & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")
print(tablerb_prox80,type = "latex", file = "latex/vllblc80.tex" , include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")

```

```{r sa_vllbmn,  fig.cap="Sensitivity proximity value liberal minority, distribution liberals", echo=FALSE}

# database filter
excl <- names(sa_asym) %in% c("run", "ID","density","step","eth_lib_loc","val_con_loc","eth_lib_min","val_con_min")
dataset_sa <- sa_asym[!excl] %>% filter(eth_con_loc  == 20,val_lib_loc == 20,eth_con_min  == 20)  %>% 
group_by(val_lib_min ,fraction_blue,circle_blue, circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 


plotname <- "images/vllbmn.jpg"
xlab_t <- "ß value liberal minority"

xvalues <- c(dataset_sa$de_sq_bl_mean,dataset_sa$de_cl_bl_mean,dataset_sa$de_sq_or_mean,dataset_sa$de_cl_or_mean,
       dataset_sa$dv_sq_bl_mean,dataset_sa$dv_cl_bl_mean,dataset_sa$dv_sq_or_mean,dataset_sa$dv_cl_or_mean)

 expo_pic <-   ggplot(data = dataset_sa) + 
  geom_point(aes(x = dataset_sa$de_sq_bl_mean, y = dataset_sa$et_sq_bl_mean),color = "black", fill = "blue", shape = 22, size = 5) +
  geom_point(aes(x = dataset_sa$de_cl_bl_mean, y = dataset_sa$et_cl_bl_mean),color = "black",fill = "blue", shape = 21, size = 5) +
  geom_point(aes(x = dataset_sa$de_sq_or_mean, y = dataset_sa$et_sq_or_mean),color = "black", fill = "orange", shape = 22, size = 5) +
  geom_point(aes(x = dataset_sa$de_cl_or_mean, y = dataset_sa$et_cl_or_mean),color = "black", fill = "orange", shape = 21, size = 5) +

  geom_point(aes(x = dataset_sa$dv_sq_bl_mean, y = dataset_sa$vl_sq_bl_mean),color = "black", fill = "blue", shape = 8, size = 5.1) + 
   geom_point(aes(x = dataset_sa$dv_sq_bl_mean, y = dataset_sa$vl_sq_bl_mean),color = "black", fill = "blue", shape = 22, size = 5) + 
  
   geom_point(aes(x = dataset_sa$dv_cl_bl_mean, y = dataset_sa$vl_cl_bl_mean),color = "black",fill = "blue", shape = 8, size = 5.1) + 
  geom_point(aes(x = dataset_sa$dv_cl_bl_mean, y = dataset_sa$vl_cl_bl_mean),color = "black",fill = "blue", shape = 21, size = 5) + 
  
    geom_point(aes(x = dataset_sa$dv_sq_or_mean, y = dataset_sa$vl_sq_or_mean),color = "black", fill = "orange", shape = 8, size = 5.1) +
  geom_point(aes(x = dataset_sa$dv_sq_or_mean, y = dataset_sa$vl_sq_or_mean),color = "black", fill = "orange", shape = 22, size = 5) +
  
  geom_point(aes(x = dataset_sa$dv_cl_or_mean, y = dataset_sa$vl_cl_or_mean),color = "black", fill = "orange", shape = 8, size = 5.1) +
geom_point(aes(x = dataset_sa$dv_cl_or_mean, y = dataset_sa$vl_cl_or_mean),color = "black", fill = "orange", shape = 21, size = 5) +
  
 scale_x_continuous(limits = c(min(xvalues),max(xvalues)), breaks = seq(0,max(xvalues), by = 0.5)) + 
  scale_y_continuous(breaks= seq(0,1,by=0.1)) + 
  geom_vline(xintercept = 1, color = "red") +
  xlab("Spatial proximity") + ylab("Exposure") +
  theme_bw() + theme( 
    axis.title.x = (element_text(size = 13)), axis.title.y = (element_text(size = 15)),
    axis.text.x =  (element_text(size = 12)), axis.text.y =  (element_text(size = 15)), 
    legend.title = element_text(size = 13),legend.position = "bottom", legend.text = element_text(size = 13),
    plot.title=element_text(hjust = 0.5), plot.caption = element_text(hjust= 0.5, size = 11), plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
 

data_prox <- dataset_sa  %>% gather(key= subgroup, value = Prox, de_sq_bl_mean, dv_sq_bl_mean, de_cl_bl_mean, dv_cl_bl_mean, de_sq_or_mean, dv_sq_or_mean, de_cl_or_mean, dv_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("de_sq_bl_mean","de_cl_bl_mean","de_sq_or_mean","de_cl_or_mean"), "values" = c("dv_sq_bl_mean","dv_cl_bl_mean","dv_sq_or_mean","dv_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("de_sq_bl_mean","dv_sq_bl_mean","de_sq_or_mean","dv_sq_or_mean"), "liberal" = c("de_cl_bl_mean","dv_cl_bl_mean","de_cl_or_mean","dv_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("de_sq_bl_mean","dv_sq_bl_mean","de_cl_bl_mean","dv_cl_bl_mean"),"minority" = c("de_sq_or_mean","dv_sq_or_mean","de_cl_or_mean","dv_cl_or_mean")), "local"))


  
prox_pic <- ggplot(data = data_prox, aes(x = val_lib_min, y = Prox, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1))) + scale_y_continuous(limits=c(min(data_prox$Prox),max(data_prox$Prox)), breaks=seq(0,max(data_prox$Prox),by=0.50)) +
 facet_wrap(~ circle_orange, dir = "v", labeller = labeller(circle_orange = circle_orange.labs)) +
    geom_vline(xintercept = 20, color = "red") +  geom_hline(yintercept = 1, color = "red") +
  scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
   scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab(xlab_t) + ylab("Spatial Proximity") + 
  theme_bw() +  theme( 
    axis.title.x = (element_text(size = 13)), axis.title.y = (element_text(size = 15)),
    axis.text.x =  (element_text(size = 12)), axis.text.y =  (element_text(size = 15)), 
    strip.text = element_text(size=13),
    legend.title = element_text(size = 13),legend.position = "bottom", legend.text = element_text(size = 14),
    plot.title=element_text(hjust = 0.5), plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 

#, plot.caption = element_text(hjust= 0.5, size = 11)
ggpubr::ggarrange(prox_pic, expo_pic, common.legend = TRUE, legend = "bottom", widths = c(1.3,1))

ggsave(plotname,plot = last_plot(),
  device = NULL,path = NULL,
  scale = 1,
  width = 12,
  height = 9,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = FALSE)

```

```{r sa_vllbmn_table,  fig.cap="TABLE Sensitivity proximity value liberal minority, distribution liberals", echo=FALSE}

# database filter

excl <- names(sa_asym) %in% c("run", "ID","density","step","eth_lib_loc","val_con_loc","eth_lib_min","val_con_min")
dataset_sa <- sa_asym[!excl] %>% filter(eth_con_loc  == 20,eth_con_min   == 20,val_lib_loc == 20)  %>% 
group_by(val_lib_min ,fraction_blue,circle_blue, circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 


df_vllbmn50 <- dataset_sa %>%  filter(circle_orange == 50)
tablerb_mn50 <- xtable(df_vllbmn50[,c("val_lib_min","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
align(tablerb_mn50) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"
addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <-  c("\\multicolumn{17}{|c|}{Ethnic Asymmetry, $50 \\%$ Liberal Migrants: Spatial Proximity}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Proximity} & \\multicolumn{8}{|c|}{Value Proximity}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ value & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"liberal minority & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")
print(tablerb_mn50,type = "latex", file = "latex/vllbmn50.tex"  , include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")


df_vllbmn20 <- dataset_sa %>%  filter(circle_orange == 20)
tablerb_mn20 <- xtable(df_vllbmn20[,c("val_lib_min","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
align(tablerb_mn20) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"
addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <- c("\\multicolumn{17}{|c|}{Ethnic Asymmetry, $20 \\%$ Liberal Migrants: Spatial Proximity}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Proximity} & \\multicolumn{8}{|c|}{Value Proximity}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ value & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"liberal minority & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")
print(tablerb_mn20,type = "latex", file = "latex/vllbmn20.tex" , include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")

df_vllbmn80 <- dataset_sa %>%  filter(circle_orange == 80)
tablerb_mn80 <- xtable(df_vllbmn80[,c("val_lib_min","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
align(tablerb_mn80) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"
addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <- c("\\multicolumn{17}{|c|}{Ethnic Asymmetry, $80 \\%$ Liberal Migrants: Spatial Proximity}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Proximity} & \\multicolumn{8}{|c|}{Value Proximity}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ value & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"liberal minority & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")
print(tablerb_mn80,type = "latex", file = "latex/vllbmn80.tex" , include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")

```

```{r sa_etcnlc,  fig.cap="Sensitivity proximity ethnic conservative local, distribution liberals", echo=FALSE}

# database filter
excl <- names(sa_asym) %in% c("run", "ID","density","step","eth_lib_loc","val_con_loc","eth_lib_min","val_con_min")
dataset_sa <- sa_asym[!excl] %>% filter(val_lib_loc   == 20,eth_con_min   == 20, val_lib_min == 20)  %>% 
group_by(eth_con_loc ,fraction_blue,circle_blue, circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 


plotname <- "images/etcnlc.jpg"
xlab_t <- "ß ethnic conservative local"

xvalues <- c(dataset_sa$de_sq_bl_mean,dataset_sa$de_cl_bl_mean,dataset_sa$de_sq_or_mean,dataset_sa$de_cl_or_mean,
       dataset_sa$dv_sq_bl_mean,dataset_sa$dv_cl_bl_mean,dataset_sa$dv_sq_or_mean,dataset_sa$dv_cl_or_mean)

 expo_pic <-   ggplot(data = dataset_sa) + 
  geom_point(aes(x = dataset_sa$de_sq_bl_mean, y = dataset_sa$et_sq_bl_mean),color = "black", fill = "blue", shape = 22, size = 5) +
  geom_point(aes(x = dataset_sa$de_cl_bl_mean, y = dataset_sa$et_cl_bl_mean),color = "black",fill = "blue", shape = 21, size = 5) +
  geom_point(aes(x = dataset_sa$de_sq_or_mean, y = dataset_sa$et_sq_or_mean),color = "black", fill = "orange", shape = 22, size = 5) +
  geom_point(aes(x = dataset_sa$de_cl_or_mean, y = dataset_sa$et_cl_or_mean),color = "black", fill = "orange", shape = 21, size = 5) +

  geom_point(aes(x = dataset_sa$dv_sq_bl_mean, y = dataset_sa$vl_sq_bl_mean),color = "black", fill = "blue", shape = 8, size = 5.1) + 
   geom_point(aes(x = dataset_sa$dv_sq_bl_mean, y = dataset_sa$vl_sq_bl_mean),color = "black", fill = "blue", shape = 22, size = 5) + 
  
   geom_point(aes(x = dataset_sa$dv_cl_bl_mean, y = dataset_sa$vl_cl_bl_mean),color = "black",fill = "blue", shape = 8, size = 5.1) + 
  geom_point(aes(x = dataset_sa$dv_cl_bl_mean, y = dataset_sa$vl_cl_bl_mean),color = "black",fill = "blue", shape = 21, size = 5) + 
  
    geom_point(aes(x = dataset_sa$dv_sq_or_mean, y = dataset_sa$vl_sq_or_mean),color = "black", fill = "orange", shape = 8, size = 5.1) +
  geom_point(aes(x = dataset_sa$dv_sq_or_mean, y = dataset_sa$vl_sq_or_mean),color = "black", fill = "orange", shape = 22, size = 5) +
  
  geom_point(aes(x = dataset_sa$dv_cl_or_mean, y = dataset_sa$vl_cl_or_mean),color = "black", fill = "orange", shape = 8, size = 5.1) +
geom_point(aes(x = dataset_sa$dv_cl_or_mean, y = dataset_sa$vl_cl_or_mean),color = "black", fill = "orange", shape = 21, size = 5) +
  
 scale_x_continuous(limits = c(min(xvalues),max(xvalues)), breaks = seq(0,max(xvalues), by = 0.5)) + 
  scale_y_continuous(breaks= seq(0,1,by=0.1)) + 
  geom_vline(xintercept = 1, color = "red") +
  xlab("Spatial proximity") + ylab("Exposure") +
  theme_bw() + theme( 
    axis.title.x = (element_text(size = 13)), axis.title.y = (element_text(size = 15)),
    axis.text.x =  (element_text(size = 12)), axis.text.y =  (element_text(size = 15)), 
    legend.title = element_text(size = 13),legend.position = "bottom", legend.text = element_text(size = 13),
    plot.title=element_text(hjust = 0.5), plot.caption = element_text(hjust= 0.5, size = 11), plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
 

data_prox <- dataset_sa  %>% gather(key= subgroup, value = Prox, de_sq_bl_mean, dv_sq_bl_mean, de_cl_bl_mean, dv_cl_bl_mean, de_sq_or_mean, dv_sq_or_mean, de_cl_or_mean, dv_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("de_sq_bl_mean","de_cl_bl_mean","de_sq_or_mean","de_cl_or_mean"), "values" = c("dv_sq_bl_mean","dv_cl_bl_mean","dv_sq_or_mean","dv_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("de_sq_bl_mean","dv_sq_bl_mean","de_sq_or_mean","dv_sq_or_mean"), "liberal" = c("de_cl_bl_mean","dv_cl_bl_mean","de_cl_or_mean","dv_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("de_sq_bl_mean","dv_sq_bl_mean","de_cl_bl_mean","dv_cl_bl_mean"),"minority" = c("de_sq_or_mean","dv_sq_or_mean","de_cl_or_mean","dv_cl_or_mean")), "local"))


  
prox_pic <- ggplot(data = data_prox, aes(x = eth_con_loc, y = Prox, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1))) + scale_y_continuous(limits=c(min(data_prox$Prox),max(data_prox$Prox)), breaks=seq(0,max(data_prox$Prox),by=0.50)) +
 facet_wrap(~ circle_orange, dir = "v", labeller = labeller(circle_orange = circle_orange.labs)) +
    geom_vline(xintercept = 20, color = "red") +  geom_hline(yintercept = 1, color = "red") +
  scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
   scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab(xlab_t) + ylab("Spatial Proximity") + 
  theme_bw() +  theme( 
    axis.title.x = (element_text(size = 13)), axis.title.y = (element_text(size = 15)),
    axis.text.x =  (element_text(size = 12)), axis.text.y =  (element_text(size = 15)), 
    strip.text = element_text(size=13),
    legend.title = element_text(size = 13),legend.position = "bottom", legend.text = element_text(size = 14),
    plot.title=element_text(hjust = 0.5), plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 

#, plot.caption = element_text(hjust= 0.5, size = 11)
ggpubr::ggarrange(prox_pic, expo_pic, common.legend = TRUE, legend = "bottom", widths = c(1.3,1))

ggsave(plotname,plot = last_plot(),
  device = NULL,path = NULL,
  scale = 1,
  width = 12,
  height = 9,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = FALSE)
```

```{r sa_etcnlc_table,  fig.cap="TABLE Sensitivity proximity ethnic conservative local, distribution liberals", echo=FALSE}

# database filter

excl <- names(sa_asym) %in% c("run", "ID","density","step","eth_lib_loc","val_con_loc","eth_lib_min","val_con_min")
dataset_sa <- sa_asym[!excl] %>% filter(val_lib_min == 20,  val_lib_loc == 20, eth_con_min == 20)  %>% 
group_by(eth_con_loc ,fraction_blue,circle_blue, circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 


df_etcnlc50 <- dataset_sa %>%  filter(circle_orange == 50)
etcnlc50 <- xtable(df_etcnlc50[,c("eth_con_loc","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
align(etcnlc50) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"
addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <-  c("\\multicolumn{17}{|c|}{Ethnic Asymmetry, $50 \\%$ Liberal Migrants: Spatial Proximity}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Proximity} & \\multicolumn{8}{|c|}{Value Proximity}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ ethnic & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"conservative local & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")
print(etcnlc50,type = "latex", file = "latex/etcnlc50.tex"  , include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")


df_etcnlc20 <- dataset_sa %>%  filter(circle_orange == 20)
etcnlc20 <- xtable(df_etcnlc20[,c("eth_con_loc","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
align(etcnlc20) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"
addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <- c("\\multicolumn{17}{|c|}{Ethnic Asymmetry, $20 \\%$ Liberal Migrants: Spatial Proximity}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Proximity} & \\multicolumn{8}{|c|}{Value Proximity}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ ethnic & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"conservative local & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")
print(etcnlc20,type = "latex", file = "latex/etcnlc20.tex" , include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")

df_etcnlc80 <- dataset_sa %>%  filter(circle_orange == 80)
etcnlc80 <- xtable(df_etcnlc80[,c("eth_con_loc","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
align(etcnlc80) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"
addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <- c("\\multicolumn{17}{|c|}{Ethnic Asymmetry, $80 \\%$ Liberal Migrants: Spatial Proximity}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Proximity} & \\multicolumn{8}{|c|}{Value Proximity}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ ethnic & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"conservative local & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")
print(etcnlc80,type = "latex", file = "latex/etcnlc80.tex" , include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")

```

```{r sa_etcnmn,  fig.cap="Sensitivity proximity ethnic conservative minority, distribution liberals", echo=FALSE}

# database filter
excl <- names(sa_asym) %in% c("run", "ID","density","step","eth_lib_loc","val_con_loc","eth_lib_min","val_con_min")
dataset_sa <- sa_asym[!excl] %>% filter(eth_con_loc  == 20,val_lib_loc == 20,val_lib_min == 20)  %>% 
group_by(eth_con_min ,fraction_blue,circle_blue, circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 


plotname <- "images/etcnmn.jpg"
xlab_t <- "ß ethnic conservative minority"

xvalues <- c(dataset_sa$de_sq_bl_mean,dataset_sa$de_cl_bl_mean,dataset_sa$de_sq_or_mean,dataset_sa$de_cl_or_mean,
       dataset_sa$dv_sq_bl_mean,dataset_sa$dv_cl_bl_mean,dataset_sa$dv_sq_or_mean,dataset_sa$dv_cl_or_mean)

 expo_pic <-   ggplot(data = dataset_sa) + 
  geom_point(aes(x = dataset_sa$de_sq_bl_mean, y = dataset_sa$et_sq_bl_mean),color = "black", fill = "blue", shape = 22, size = 5) +
  geom_point(aes(x = dataset_sa$de_cl_bl_mean, y = dataset_sa$et_cl_bl_mean),color = "black",fill = "blue", shape = 21, size = 5) +
  geom_point(aes(x = dataset_sa$de_sq_or_mean, y = dataset_sa$et_sq_or_mean),color = "black", fill = "orange", shape = 22, size = 5) +
  geom_point(aes(x = dataset_sa$de_cl_or_mean, y = dataset_sa$et_cl_or_mean),color = "black", fill = "orange", shape = 21, size = 5) +

  geom_point(aes(x = dataset_sa$dv_sq_bl_mean, y = dataset_sa$vl_sq_bl_mean),color = "black", fill = "blue", shape = 8, size = 5.1) + 
   geom_point(aes(x = dataset_sa$dv_sq_bl_mean, y = dataset_sa$vl_sq_bl_mean),color = "black", fill = "blue", shape = 22, size = 5) + 
  
   geom_point(aes(x = dataset_sa$dv_cl_bl_mean, y = dataset_sa$vl_cl_bl_mean),color = "black",fill = "blue", shape = 8, size = 5.1) + 
  geom_point(aes(x = dataset_sa$dv_cl_bl_mean, y = dataset_sa$vl_cl_bl_mean),color = "black",fill = "blue", shape = 21, size = 5) + 
  
    geom_point(aes(x = dataset_sa$dv_sq_or_mean, y = dataset_sa$vl_sq_or_mean),color = "black", fill = "orange", shape = 8, size = 5.1) +
  geom_point(aes(x = dataset_sa$dv_sq_or_mean, y = dataset_sa$vl_sq_or_mean),color = "black", fill = "orange", shape = 22, size = 5) +
  
  geom_point(aes(x = dataset_sa$dv_cl_or_mean, y = dataset_sa$vl_cl_or_mean),color = "black", fill = "orange", shape = 8, size = 5.1) +
geom_point(aes(x = dataset_sa$dv_cl_or_mean, y = dataset_sa$vl_cl_or_mean),color = "black", fill = "orange", shape = 21, size = 5) +
  
 scale_x_continuous(limits = c(min(xvalues),max(xvalues)), breaks = seq(0,max(xvalues), by = 0.5)) + 
  scale_y_continuous(breaks= seq(0,1,by=0.1)) + 
  geom_vline(xintercept = 1, color = "red") +
  xlab("Spatial proximity") + ylab("Exposure") +
  theme_bw() + theme( 
    axis.title.x = (element_text(size = 13)), axis.title.y = (element_text(size = 15)),
    axis.text.x =  (element_text(size = 12)), axis.text.y =  (element_text(size = 15)), 
    legend.title = element_text(size = 13),legend.position = "bottom", legend.text = element_text(size = 13),
    plot.title=element_text(hjust = 0.5), plot.caption = element_text(hjust= 0.5, size = 11), plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
 

data_prox <- dataset_sa  %>% gather(key= subgroup, value = Prox, de_sq_bl_mean, dv_sq_bl_mean, de_cl_bl_mean, dv_cl_bl_mean, de_sq_or_mean, dv_sq_or_mean, de_cl_or_mean, dv_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("de_sq_bl_mean","de_cl_bl_mean","de_sq_or_mean","de_cl_or_mean"), "values" = c("dv_sq_bl_mean","dv_cl_bl_mean","dv_sq_or_mean","dv_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("de_sq_bl_mean","dv_sq_bl_mean","de_sq_or_mean","dv_sq_or_mean"), "liberal" = c("de_cl_bl_mean","dv_cl_bl_mean","de_cl_or_mean","dv_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("de_sq_bl_mean","dv_sq_bl_mean","de_cl_bl_mean","dv_cl_bl_mean"),"minority" = c("de_sq_or_mean","dv_sq_or_mean","de_cl_or_mean","dv_cl_or_mean")), "local"))


  
prox_pic <- ggplot(data = data_prox, aes(x = eth_con_min, y = Prox, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1))) + scale_y_continuous(limits=c(min(data_prox$Prox),max(data_prox$Prox)), breaks=seq(0,max(data_prox$Prox),by=0.50)) +
 facet_wrap(~ circle_orange, dir = "v", labeller = labeller(circle_orange = circle_orange.labs)) +
    geom_vline(xintercept = 20, color = "red") +  geom_hline(yintercept = 1, color = "red") +
  scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
   scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab(xlab_t) + ylab("Spatial Proximity") + 
  theme_bw() +  theme( 
    axis.title.x = (element_text(size = 13)), axis.title.y = (element_text(size = 15)),
    axis.text.x =  (element_text(size = 12)), axis.text.y =  (element_text(size = 15)), 
    strip.text = element_text(size=13),
    legend.title = element_text(size = 13),legend.position = "bottom", legend.text = element_text(size = 14),
    plot.title=element_text(hjust = 0.5), plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 

#, plot.caption = element_text(hjust= 0.5, size = 11)
ggpubr::ggarrange(prox_pic, expo_pic, common.legend = TRUE, legend = "bottom", widths = c(1.3,1))

ggsave(plotname,plot = last_plot(),
  device = NULL,path = NULL,
  scale = 1,
  width = 12,
  height = 9,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = FALSE)
```

```{r sa_etcnmn_table,  fig.cap="TABLE Sensitivity proximity ethnic conservative minority, distribution liberals", echo=FALSE}

# database filter

excl <- names(sa_asym) %in% c("run", "ID","density","step","eth_lib_loc","val_con_loc","eth_lib_min","val_con_min")
dataset_sa <- sa_asym[!excl] %>% filter(val_lib_min == 20,  val_lib_loc == 20, eth_con_loc == 20)  %>% 
group_by(eth_con_min ,fraction_blue,circle_blue, circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 


df_etcnmn50 <- dataset_sa %>%  filter(circle_orange == 50)
etcnmn50 <- xtable(df_etcnmn50[,c("eth_con_min","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
align(etcnmn50) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"
addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <-  c("\\multicolumn{17}{|c|}{Ethnic Asymmetry, $50 \\%$ Liberal Migrants: Spatial Proximity}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Proximity} & \\multicolumn{8}{|c|}{Value Proximity}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ ethnic & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"conservative minority & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")
print(etcnmn50,type = "latex", file = "latex/etcnmn50.tex"  , include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")


df_etcnmn20 <- dataset_sa %>%  filter(circle_orange == 20)
etcnmn20 <- xtable(df_etcnmn20[,c("eth_con_min","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
align(etcnmn20) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"
addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <- c("\\multicolumn{17}{|c|}{Ethnic Asymmetry, $20 \\%$ Liberal Migrants: Spatial Proximity}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Proximity} & \\multicolumn{8}{|c|}{Value Proximity}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ ethnic & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"conservative minority & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")
print(etcnmn20,type = "latex", file = "latex/etcnmn20.tex" , include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")

df_etcnmn80 <- dataset_sa %>%  filter(circle_orange == 80)
etcnmn80 <- xtable(df_etcnmn80[,c("eth_con_min","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
align(etcnmn80) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"
addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <- c("\\multicolumn{17}{|c|}{Ethnic Asymmetry, $80 \\%$ Liberal Migrants: Spatial Proximity}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Proximity} & \\multicolumn{8}{|c|}{Value Proximity}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ ethnic & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"conservative minority & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")
print(etcnmn80,type = "latex", file = "latex/etcnmn80.tex" , include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")

# test_all <- rbind(etcnmn20,etcnmn50,etcnmn80)
# print(test_all, type = "latex", file = "latex/test_all.tex",include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")

```

```{r et_lib_loc,  fig.cap="Sensitivity proximity ETHNIC liberal majority", echo=FALSE}

# database filter
excl <- names(etlib) %in% c("run", "ID","density","step","eth_con_loc","eth_con_min","val_lib_loc","val_lib_min","val_con_loc","val_con_min")
etlib_df <- etlib[!excl] %>% filter(eth_lib_min  == 0)  %>% 
group_by(eth_lib_loc,fraction_blue,circle_blue, circle_orange,eth_lib_min) %>% summarise_all(c("mean"= mean,"sd"= sd)) 


plotname <- "images/et_libloc.jpg"
xlab_t <- "ß ethnic liberal local"

xvalues <- c(etlib_df$de_sq_bl_mean,etlib_df$de_cl_bl_mean,etlib_df$de_sq_or_mean,etlib_df$de_cl_or_mean,
       etlib_df$dv_sq_bl_mean,etlib_df$dv_cl_bl_mean,etlib_df$dv_sq_or_mean,etlib_df$dv_cl_or_mean)

 expo_pic <-   ggplot(data = etlib_df) + 
  geom_point(aes(x = etlib_df$de_sq_bl_mean, y = etlib_df$et_sq_bl_mean),color = "black", fill = "blue", shape = 22, size = 5) +
  geom_point(aes(x = etlib_df$de_cl_bl_mean, y = etlib_df$et_cl_bl_mean),color = "black",fill = "blue", shape = 21, size = 5) +
  geom_point(aes(x = etlib_df$de_sq_or_mean, y = etlib_df$et_sq_or_mean),color = "black", fill = "orange", shape = 22, size = 5) +
  geom_point(aes(x = etlib_df$de_cl_or_mean, y = etlib_df$et_cl_or_mean),color = "black", fill = "orange", shape = 21, size = 5) +

  geom_point(aes(x = etlib_df$dv_sq_bl_mean, y = etlib_df$vl_sq_bl_mean),color = "black", fill = "blue", shape = 8, size = 5.1) + 
   geom_point(aes(x = etlib_df$dv_sq_bl_mean, y = etlib_df$vl_sq_bl_mean),color = "black", fill = "blue", shape = 22, size = 5) + 
  
   geom_point(aes(x = etlib_df$dv_cl_bl_mean, y = etlib_df$vl_cl_bl_mean),color = "black",fill = "blue", shape = 8, size = 5.1) + 
  geom_point(aes(x = etlib_df$dv_cl_bl_mean, y = etlib_df$vl_cl_bl_mean),color = "black",fill = "blue", shape = 21, size = 5) + 
  
    geom_point(aes(x = etlib_df$dv_sq_or_mean, y = etlib_df$vl_sq_or_mean),color = "black", fill = "orange", shape = 8, size = 5.1) +
  geom_point(aes(x = etlib_df$dv_sq_or_mean, y = etlib_df$vl_sq_or_mean),color = "black", fill = "orange", shape = 22, size = 5) +
  
  geom_point(aes(x = etlib_df$dv_cl_or_mean, y = etlib_df$vl_cl_or_mean),color = "black", fill = "orange", shape = 8, size = 5.1) +
geom_point(aes(x = etlib_df$dv_cl_or_mean, y = etlib_df$vl_cl_or_mean),color = "black", fill = "orange", shape = 21, size = 5) +
  
 scale_x_continuous(limits = c(min(xvalues),max(xvalues)), breaks = seq(0,max(xvalues), by = 0.5)) + 
  scale_y_continuous(breaks= seq(0,1,by=0.1)) + 
  geom_vline(xintercept = 1, color = "red") +
  xlab("Spatial proximity") + ylab("Exposure") +
  theme_bw() + theme( 
    axis.title.x = (element_text(size = 13)), axis.title.y = (element_text(size = 15)),
    axis.text.x =  (element_text(size = 12)), axis.text.y =  (element_text(size = 15)), 
    legend.title = element_text(size = 13),legend.position = "bottom", legend.text = element_text(size = 13),
    plot.title=element_text(hjust = 0.5), plot.caption = element_text(hjust= 0.5, size = 11), plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
 

data_prox <- etlib_df  %>% gather(key= subgroup, value = Prox, de_sq_bl_mean, dv_sq_bl_mean, de_cl_bl_mean, dv_cl_bl_mean, de_sq_or_mean, dv_sq_or_mean, de_cl_or_mean, dv_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("de_sq_bl_mean","de_cl_bl_mean","de_sq_or_mean","de_cl_or_mean"), "values" = c("dv_sq_bl_mean","dv_cl_bl_mean","dv_sq_or_mean","dv_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("de_sq_bl_mean","dv_sq_bl_mean","de_sq_or_mean","dv_sq_or_mean"), "liberal" = c("de_cl_bl_mean","dv_cl_bl_mean","de_cl_or_mean","dv_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("de_sq_bl_mean","dv_sq_bl_mean","de_cl_bl_mean","dv_cl_bl_mean"),"minority" = c("de_sq_or_mean","dv_sq_or_mean","de_cl_or_mean","dv_cl_or_mean")), "local"))


  
prox_pic <- ggplot(data = data_prox, aes(x = eth_lib_loc, y = Prox, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1))) + scale_y_continuous(limits=c(min(data_prox$Prox),max(data_prox$Prox)), breaks=seq(0,max(data_prox$Prox),by=0.50)) +
 facet_wrap(~ circle_orange, dir = "v", labeller = labeller(circle_orange = circle_orange.labs)) +
    geom_vline(xintercept = 20, color = "red") +  geom_hline(yintercept = 1, color = "red") +
  scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
   scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab(xlab_t) + ylab("Spatial Proximity") + 
  theme_bw() +  theme( 
    axis.title.x = (element_text(size = 13)), axis.title.y = (element_text(size = 15)),
    axis.text.x =  (element_text(size = 12)), axis.text.y =  (element_text(size = 15)), 
    strip.text = element_text(size=13),
    legend.title = element_text(size = 13),legend.position = "bottom", legend.text = element_text(size = 14),
    plot.title=element_text(hjust = 0.5), plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 

#, plot.caption = element_text(hjust= 0.5, size = 11)
ggpubr::ggarrange(prox_pic, expo_pic, common.legend = TRUE, legend = "bottom", widths = c(1.3,1))

ggsave(plotname,plot = last_plot(),
  device = NULL,path = NULL,
  scale = 1,
  width = 12,
  height = 9,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = FALSE)

```

```{r et_lib_loc_table,  fig.cap="TABLE Sensitivity proximity ETHNIC liberal majority", echo=FALSE}

# database filter

excl <- names(etlib) %in% c("run", "ID","density","step","eth_con_loc","eth_con_min","val_lib_loc","val_lib_min","val_con_loc","val_con_min")
etlib_df <- etlib[!excl] %>% filter(eth_lib_min  == 0)  %>% 
group_by(eth_lib_loc,fraction_blue,circle_blue, circle_orange,eth_lib_min) %>% summarise_all(c("mean"= mean,"sd"= sd)) 



df_etlib_loc50 <- etlib_df %>%  filter(circle_orange == 50)
etlib_loc50 <- xtable(df_etlib_loc50[,c("eth_lib_loc","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
align(etlib_loc50) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"
addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <-  c("\\multicolumn{17}{|c|}{Ethnic Asymmetry, $50 \\%$ Liberal Migrants: Spatial Proximity}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Proximity} & \\multicolumn{8}{|c|}{Value Proximity}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ ethnic & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"liberal local & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")
print(etlib_loc50,type = "latex", file = "latex/etlib_loc50.tex"  , include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")


df_etlib_loc20 <- etlib_df %>%  filter(circle_orange == 20)
etlib_loc20 <- xtable(df_etlib_loc20[,c("eth_lib_loc","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
align(etlib_loc20) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"
addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <- c("\\multicolumn{17}{|c|}{Ethnic Asymmetry, $20 \\%$ Liberal Migrants: Spatial Proximity}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Proximity} & \\multicolumn{8}{|c|}{Value Proximity}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ ethnic & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"liberal local & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")
print(etlib_loc20,type = "latex", file = "latex/etlib_loc20.tex" , include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")

df_etlib_loc80 <- etlib_df %>%  filter(circle_orange == 80)
etlib_loc80 <- xtable(df_etlib_loc80[,c("eth_lib_loc","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
align(etlib_loc80) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"
addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <- c("\\multicolumn{17}{|c|}{Ethnic Asymmetry, $80 \\%$ Liberal Migrants: Spatial Proximity}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Proximity} & \\multicolumn{8}{|c|}{Value Proximity}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ ethnic & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"liberal local & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")
print(etcnmn80,type = "latex", file = "latex/etlib_loc80.tex" , include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")

```

```{r et_lib_min,  fig.cap="Sensitivity proximity ETHNIC liberal minority", echo=FALSE}

# database filter
excl <- names(etlib) %in% c("run", "ID","density","step","eth_con_loc","eth_con_min","val_lib_loc","val_lib_min","val_con_loc","val_con_min")
etlib_df <- etlib[!excl] %>% filter(eth_lib_loc  == 0)  %>% 
group_by(eth_lib_min,fraction_blue,circle_blue, circle_orange,eth_lib_loc) %>% summarise_all(c("mean"= mean,"sd"= sd)) 


plotname <- "images/et_libmin.jpg"
xlab_t <- "ß ethnic liberal minority"

xvalues <- c(etlib_df$de_sq_bl_mean,etlib_df$de_cl_bl_mean,etlib_df$de_sq_or_mean,etlib_df$de_cl_or_mean,
       etlib_df$dv_sq_bl_mean,etlib_df$dv_cl_bl_mean,etlib_df$dv_sq_or_mean,etlib_df$dv_cl_or_mean)

 expo_pic <-   ggplot(data = etlib_df) + 
  geom_point(aes(x = etlib_df$de_sq_bl_mean, y = etlib_df$et_sq_bl_mean),color = "black", fill = "blue", shape = 22, size = 5) +
  geom_point(aes(x = etlib_df$de_cl_bl_mean, y = etlib_df$et_cl_bl_mean),color = "black",fill = "blue", shape = 21, size = 5) +
  geom_point(aes(x = etlib_df$de_sq_or_mean, y = etlib_df$et_sq_or_mean),color = "black", fill = "orange", shape = 22, size = 5) +
  geom_point(aes(x = etlib_df$de_cl_or_mean, y = etlib_df$et_cl_or_mean),color = "black", fill = "orange", shape = 21, size = 5) +

  geom_point(aes(x = etlib_df$dv_sq_bl_mean, y = etlib_df$vl_sq_bl_mean),color = "black", fill = "blue", shape = 8, size = 5.1) + 
   geom_point(aes(x = etlib_df$dv_sq_bl_mean, y = etlib_df$vl_sq_bl_mean),color = "black", fill = "blue", shape = 22, size = 5) + 
  
   geom_point(aes(x = etlib_df$dv_cl_bl_mean, y = etlib_df$vl_cl_bl_mean),color = "black",fill = "blue", shape = 8, size = 5.1) + 
  geom_point(aes(x = etlib_df$dv_cl_bl_mean, y = etlib_df$vl_cl_bl_mean),color = "black",fill = "blue", shape = 21, size = 5) + 
  
    geom_point(aes(x = etlib_df$dv_sq_or_mean, y = etlib_df$vl_sq_or_mean),color = "black", fill = "orange", shape = 8, size = 5.1) +
  geom_point(aes(x = etlib_df$dv_sq_or_mean, y = etlib_df$vl_sq_or_mean),color = "black", fill = "orange", shape = 22, size = 5) +
  
  geom_point(aes(x = etlib_df$dv_cl_or_mean, y = etlib_df$vl_cl_or_mean),color = "black", fill = "orange", shape = 8, size = 5.1) +
geom_point(aes(x = etlib_df$dv_cl_or_mean, y = etlib_df$vl_cl_or_mean),color = "black", fill = "orange", shape = 21, size = 5) +
  
 scale_x_continuous(limits = c(min(xvalues),max(xvalues)), breaks = seq(0,max(xvalues), by = 0.5)) + 
  scale_y_continuous(breaks= seq(0,1,by=0.1)) + 
  geom_vline(xintercept = 1, color = "red") +
  xlab("Spatial proximity") + ylab("Exposure") +
  theme_bw() + theme( 
    axis.title.x = (element_text(size = 13)), axis.title.y = (element_text(size = 15)),
    axis.text.x =  (element_text(size = 12)), axis.text.y =  (element_text(size = 15)), 
    legend.title = element_text(size = 13),legend.position = "bottom", legend.text = element_text(size = 13),
    plot.title=element_text(hjust = 0.5), plot.caption = element_text(hjust= 0.5, size = 11), plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
 

data_prox <- etlib_df  %>% gather(key= subgroup, value = Prox, de_sq_bl_mean, dv_sq_bl_mean, de_cl_bl_mean, dv_cl_bl_mean, de_sq_or_mean, dv_sq_or_mean, de_cl_or_mean, dv_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("de_sq_bl_mean","de_cl_bl_mean","de_sq_or_mean","de_cl_or_mean"), "values" = c("dv_sq_bl_mean","dv_cl_bl_mean","dv_sq_or_mean","dv_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("de_sq_bl_mean","dv_sq_bl_mean","de_sq_or_mean","dv_sq_or_mean"), "liberal" = c("de_cl_bl_mean","dv_cl_bl_mean","de_cl_or_mean","dv_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("de_sq_bl_mean","dv_sq_bl_mean","de_cl_bl_mean","dv_cl_bl_mean"),"minority" = c("de_sq_or_mean","dv_sq_or_mean","de_cl_or_mean","dv_cl_or_mean")), "local"))


  
prox_pic <- ggplot(data = data_prox, aes(x = eth_lib_min, y = Prox, linetype = `segregation` , fill = `ethnia`,  shape = `orientation`)) + geom_line(aes(color = `ethnia`))  +  geom_point(color = "black", size = 4) + 
 scale_x_discrete(limits=c(seq(0,20 ,by = 1))) + scale_y_continuous(limits=c(min(data_prox$Prox),max(data_prox$Prox)), breaks=seq(0,max(data_prox$Prox),by=0.50)) +
 facet_wrap(~ circle_orange, dir = "v", labeller = labeller(circle_orange = circle_orange.labs)) +
    geom_vline(xintercept = 20, color = "red") +  geom_hline(yintercept = 1, color = "red") +
  scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_fill_manual(values = c("blue","darkorange")) + 
   scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c(22,21), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  guides(fill = FALSE) +
  xlab(xlab_t) + ylab("Spatial Proximity") + 
  theme_bw() +  theme( 
    axis.title.x = (element_text(size = 13)), axis.title.y = (element_text(size = 15)),
    axis.text.x =  (element_text(size = 12)), axis.text.y =  (element_text(size = 15)), 
    strip.text = element_text(size=13),
    legend.title = element_text(size = 13),legend.position = "bottom", legend.text = element_text(size = 14),
    plot.title=element_text(hjust = 0.5), plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 

#, plot.caption = element_text(hjust= 0.5, size = 11)
ggpubr::ggarrange(prox_pic, expo_pic, common.legend = TRUE, legend = "bottom", widths = c(1.3,1))

ggsave(plotname,plot = last_plot(),
  device = NULL,path = NULL,
  scale = 1,
  width = 12,
  height = 9,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = FALSE)

```

```{r et_lib_min_table,  fig.cap="TABLE Sensitivity proximity ETHNIC liberal minority", echo=FALSE}

# database filter

excl <- names(etlib) %in% c("run", "ID","density","step","eth_con_loc","eth_con_min","val_lib_loc","val_lib_min","val_con_loc","val_con_min")
etlib_df <- etlib[!excl] %>% filter(eth_lib_loc  == 0)  %>% 
group_by(eth_lib_min,fraction_blue,circle_blue, circle_orange,eth_lib_min) %>% summarise_all(c("mean"= mean,"sd"= sd)) 



df_etlib_min50 <- etlib_df %>%  filter(circle_orange == 50)
etlib_min50 <- xtable(df_etlib_min50[,c("eth_lib_min","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
align(etlib_min50) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"
addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <-  c("\\multicolumn{17}{|c|}{Ethnic Asymmetry, $50 \\%$ Liberal Migrants: Spatial Proximity}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Proximity} & \\multicolumn{8}{|c|}{Value Proximity}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ ethnic & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"liberal minority & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")
print(etlib_loc50,type = "latex", file = "latex/etlib_min50.tex"  , include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")


df_etlib_min20 <- etlib_df %>%  filter(circle_orange == 20)
etlib_min20 <- xtable(df_etlib_min20[,c("eth_lib_min","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
align(etlib_min20) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"
addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <- c("\\multicolumn{17}{|c|}{Ethnic Asymmetry, $20 \\%$ Liberal Migrants: Spatial Proximity}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Proximity} & \\multicolumn{8}{|c|}{Value Proximity}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ ethnic & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"liberal minority & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")
print(etlib_loc20,type = "latex", file = "latex/etlib_min20.tex" , include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")

df_etlib_min80 <- etlib_df %>%  filter(circle_orange == 80)
etlib_min80 <- xtable(df_etlib_min80[,c("eth_lib_min","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
align(etlib_min80) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"
addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <- c("\\multicolumn{17}{|c|}{Ethnic Asymmetry, $80 \\%$ Liberal Migrants: Spatial Proximity}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Proximity} & \\multicolumn{8}{|c|}{Value Proximity}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ ethnic & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
"liberal minority & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")
print(etcnmn80,type = "latex", file = "latex/etlib_min80.tex" , include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")

```



<!--

```{r sa_etcnlc50, fig.width=30, fig.cap="Sensitivity ethnic conservative local, baseline asymmetric conditions", echo=FALSE}

# database filter
excl <- names(sa_asym) %in% c("run", "ID","density","step","eth_lib_loc","val_con_loc","eth_lib_min","val_con_min")
dataset_sa <- sa_asym[!excl] %>% filter(val_lib_loc  == 20,eth_con_min == 20, val_lib_min == 20)  %>% 
 filter(circle_orange == 50) %>%
  group_by(eth_con_loc,fraction_blue,circle_blue, circle_orange) %>% summarise_all(c("mean"= mean,"sd"= sd)) 

xlab_t <- "ß ethnic conservative local"

 circle_orange.labs <- c("20% liberal minority", "50% liberal minority", "80% liberal minority")
names(circle_orange.labs) <- c("20","50","80")

plotname <- "images/etcnlc50.jpg"

# row_exp <- c("\\multicolumn{17}{|c|}{Ethnic asymmetric condition: Exposure, 50% liberal minority}  \\\\\\hline\n",
#    "Preference &  \\multicolumn{8}{|c|}{Ethnic Exposure} & \\multicolumn{8}{|c|}{Value Exposure}   \\\\\\hline\n",
#   "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
# "$\\beta$ dom = 20 & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
# & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
# & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
# " & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")
# 
# row_prox <- c("\\multicolumn{17}{|c|}{Ethnic Asymmetric condition: Spatial Proximity, 50% liberal minority}  \\\\\\hline\n",
#    "Preference &  \\multicolumn{8}{|c|}{Ethnic Proximity} & \\multicolumn{8}{|c|}{Value Proximity}   \\\\\\hline\n",
#   "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
# "$\\beta$ dom = 20 & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
# & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
# & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
# " & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")
# 


# tablerb_expname <- "latex/etcnlc50_rb_exp.tex"
# tablerb_proxname <- "latex/etcnlc50_prox.tex"





# graph

data_exp <- dataset_sa %>% gather(key= subgroup, value = Expo, et_sq_bl_mean, vl_sq_bl_mean, et_cl_bl_mean, vl_cl_bl_mean, et_sq_or_mean, vl_sq_or_mean, et_cl_or_mean, vl_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("et_sq_bl_mean","et_cl_bl_mean","et_sq_or_mean","et_cl_or_mean"), "values" = c("vl_sq_bl_mean","vl_cl_bl_mean","vl_sq_or_mean","vl_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("et_sq_bl_mean","vl_sq_bl_mean","et_sq_or_mean","vl_sq_or_mean"), "liberal" = c("et_cl_bl_mean","vl_cl_bl_mean","et_cl_or_mean","vl_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("et_sq_bl_mean","vl_sq_bl_mean","et_cl_bl_mean","vl_cl_bl_mean"),"minority" = c("et_sq_or_mean","vl_sq_or_mean","et_cl_or_mean","vl_cl_or_mean")), "local"))

fig_exp <- ggplot(data = data_exp, aes(x = eth_con_loc, y = Expo, linetype = `segregation` , color = `ethnia`, shape = `orientation`)) + geom_line()  +  geom_point(size = 3) +
 scale_x_discrete(limits=c(seq(0,20 ,by = 1))) + scale_y_continuous(limits=c(0,1), breaks=seq(0,1,by=0.10)) +
#  facet_wrap(~ circle_orange, labeller = labeller(circle_orange = circle_orange.labs)) +
  scale_linetype_manual(values=c("solid","dotted"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c("square","circle"), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  xlab("") + ylab("Exposure") + 
  theme_bw() +  theme( axis.title.x  = element_blank(), axis.title.y = (element_text(size = 15)), axis.text.x  = (element_text(size = 10)) ,axis.text.y =  (element_text(size = 15)), legend.title = element_text(size = 13) ,legend.text = element_text(size = 13), plot.title=element_text(hjust = 0.5)) + theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
 
# tablerb_exp <- xtable(dataset_sa[,c("dominant","et_sq_bl_mean","et_sq_bl_sd","et_cl_bl_mean","et_cl_bl_sd","et_sq_or_mean","et_sq_or_sd","et_cl_or_mean","et_cl_or_sd","vl_sq_bl_mean","vl_sq_bl_sd","vl_cl_bl_mean","vl_cl_bl_sd","vl_sq_or_mean","vl_sq_or_sd","vl_cl_or_mean","vl_cl_or_sd")], digits = 3)
# align(tablerb_exp) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"
# 
# addtorow <- list()
# addtorow$pos <- list(0, 0,0,0,0)
# addtorow$command <-  row_exp
# 
# print(tablerb_exp,type = "latex", file = tablerb_expname, include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")


## Spatial proximity baseline asymmetric

# graph

data_prox <- dataset_sa %>% gather(key= subgroup, value = Prox, de_sq_bl_mean, dv_sq_bl_mean, de_cl_bl_mean, dv_cl_bl_mean, de_sq_or_mean, dv_sq_or_mean, de_cl_or_mean, dv_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("de_sq_bl_mean","de_cl_bl_mean","de_sq_or_mean","de_cl_or_mean"), "values" = c("dv_sq_bl_mean","dv_cl_bl_mean","dv_sq_or_mean","dv_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("de_sq_bl_mean","dv_sq_bl_mean","de_sq_or_mean","dv_sq_or_mean"), "liberal" = c("de_cl_bl_mean","dv_cl_bl_mean","de_cl_or_mean","dv_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("de_sq_bl_mean","dv_sq_bl_mean","de_cl_bl_mean","dv_cl_bl_mean"),"minority" = c("de_sq_or_mean","dv_sq_or_mean","de_cl_or_mean","dv_cl_or_mean")), "local"))

fig_prox <- ggplot(data = data_prox, aes(x = eth_con_loc, y = Prox, linetype = `segregation` , color = `ethnia`, shape = `orientation`)) + geom_line()  +  geom_point(size = 3) +
 scale_x_discrete(limits=c(seq(0,20 ,by = 1))) + scale_y_continuous(limits=c(min(data_prox$Prox),max(data_prox$Prox)), breaks=seq(0,max(data_prox$Prox),by=0.50)) +
#☻    facet_wrap(~ circle_orange, labeller = labeller(circle_orange = circle_orange.labs)) +
  scale_linetype_manual(values=c("solid","dotted"), labels = c("ethnic","value"), guide = guide_legend(title = "Segregation", order = 1)) +
  scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
  scale_shape_manual(values = c("square","circle"), guide = guide_legend(title="Value" ,override.aes = list(size = 3), order = 3)) +
  xlab(xlab_t) + ylab("Spatial Proximity") + 
  theme_bw() +  theme( axis.title.x = (element_text(size = 15)), axis.title.y = (element_text(size = 15)), axis.text.x =  (element_text(size = 15)),axis.text.y =  (element_text(size = 15)), legend.title = element_text(size = 13) ,legend.text = element_text(size = 13),plot.title=element_text(hjust = 0.5)) + theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
 
# robustness table

# tablerb_prox <- xtable(dataset_sa[,c("dominant","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
# align(tablerb_prox) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"
# 
# addtorow <- list()
# addtorow$pos <- list(0, 0,0,0,0)
# addtorow$command <-  row_prox
# print(tablerb_prox,type = "latex", file = tablerb_proxname , include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")


# combined image

ggpubr::ggarrange(fig_exp,fig_prox, nrow = 2, ncol = 1, common.legend = TRUE, legend = "right")

ggsave(plotname,plot = fig_prox,
  device = NULL,path = NULL, 
  scale = 1,
  width = 8,
  height = 6,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = FALSE)


```

```{r CODE INDEX FACET  WRAP, fig.width=30, fig.cap="Baseline asymmetric conditions", echo=FALSE}

# database filter
excl <- names(asym_dom) %in% c("run", "ID","density","step")
asym_dom_sa <- asym_dom[!excl] %>% group_by(dominant,circle_orange,circle_blue,fraction_blue,secondary) %>% summarise_all(c("mean"= mean,"sd"= sd)) 

# graph
# LEAVE! Combined indexes
data_s <- asym_dom_sa  %>% gather(key= subgroup, value = Segra, de_sq_bl_mean, dv_sq_bl_mean, de_cl_bl_mean, dv_cl_bl_mean, de_sq_or_mean, dv_sq_or_mean, de_cl_or_mean, dv_cl_or_mean,
       et_sq_bl_mean, vl_sq_bl_mean, et_cl_bl_mean, vl_cl_bl_mean, et_sq_or_mean, vl_sq_or_mean, et_cl_or_mean, vl_cl_or_mean) %>% mutate(
  `dimensions` = fct_relevel(fct_collapse(subgroup,"ethnic" = c("de_sq_bl_mean","de_cl_bl_mean","de_sq_or_mean","de_cl_or_mean", "et_sq_bl_mean","et_cl_bl_mean","et_sq_or_mean","et_cl_or_mean"), "values" = c("dv_sq_bl_mean","dv_cl_bl_mean","dv_sq_or_mean","dv_cl_or_mean",
   "vl_sq_bl_mean","vl_cl_bl_mean","vl_sq_or_mean","vl_cl_or_mean")),"ethnic"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("de_sq_bl_mean","dv_sq_bl_mean","de_sq_or_mean","dv_sq_or_mean",  "et_sq_bl_mean","vl_sq_bl_mean","et_sq_or_mean","vl_sq_or_mean" ), "liberal" = c("de_cl_bl_mean","dv_cl_bl_mean","de_cl_or_mean","dv_cl_or_mean",
                         "et_cl_bl_mean", "vl_cl_bl_mean", "et_cl_or_mean","vl_cl_or_mean")),"conservative" ),
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("de_sq_bl_mean","dv_sq_bl_mean","de_cl_bl_mean","dv_cl_bl_mean",
                                    "et_sq_bl_mean","vl_sq_bl_mean","et_cl_bl_mean", "vl_cl_bl_mean" ),"minority" = c("de_sq_or_mean","dv_sq_or_mean","de_cl_or_mean","dv_cl_or_mean","et_sq_or_mean", "vl_sq_or_mean", "et_cl_or_mean", "vl_cl_or_mean")), "local"),
  `index` = fct_relevel(fct_collapse(subgroup,  "exposure" = c("et_sq_bl_mean","vl_sq_bl_mean","et_cl_bl_mean", "vl_cl_bl_mean","et_sq_or_mean", "vl_sq_or_mean", "et_cl_or_mean", "vl_cl_or_mean" ), "proximity" = c("de_sq_bl_mean","dv_sq_bl_mean","de_cl_bl_mean","dv_cl_bl_mean","de_sq_or_mean","dv_sq_or_mean","de_cl_or_mean","dv_cl_or_mean")),"exposure"))


data_f <- asym_dom_sa %>% gather(key= subgroup, value = Segra, de_sq_bl_mean, dv_sq_bl_mean, de_cl_bl_mean, dv_cl_bl_mean, de_sq_or_mean, dv_sq_or_mean, de_cl_or_mean, dv_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("de_sq_bl_mean","de_cl_bl_mean","de_sq_or_mean","de_cl_or_mean"), "values" = c("dv_sq_bl_mean","dv_cl_bl_mean","dv_sq_or_mean","dv_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("de_sq_bl_mean","dv_sq_bl_mean","de_sq_or_mean","dv_sq_or_mean"), "liberal" = c("de_cl_bl_mean","dv_cl_bl_mean","de_cl_or_mean","dv_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("de_sq_bl_mean","dv_sq_bl_mean","de_cl_bl_mean","dv_cl_bl_mean"),"minority" = c("de_sq_or_mean","dv_sq_or_mean","de_cl_or_mean","dv_cl_or_mean")), "local"))

data_e <- asym_dom_sa %>% gather(key= subgroup, value = Segra, et_sq_bl_mean, vl_sq_bl_mean, et_cl_bl_mean, vl_cl_bl_mean, et_sq_or_mean, vl_sq_or_mean, et_cl_or_mean, vl_cl_or_mean) %>% mutate(
  `segregation` = fct_relevel(fct_collapse(subgroup,"ethnics" = c("et_sq_bl_mean","et_cl_bl_mean","et_sq_or_mean","et_cl_or_mean"), "values" = c("vl_sq_bl_mean","vl_cl_bl_mean","vl_sq_or_mean","vl_cl_or_mean")),"ethnics"),
 `orientation` = fct_relevel(fct_collapse(subgroup, "conservative" = c("et_sq_bl_mean","vl_sq_bl_mean","et_sq_or_mean","vl_sq_or_mean"), "liberal" = c("et_cl_bl_mean","vl_cl_bl_mean","et_cl_or_mean","vl_cl_or_mean")),"conservative" ), 
 `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("et_sq_bl_mean","vl_sq_bl_mean","et_cl_bl_mean","vl_cl_bl_mean"),"minority" = c("et_sq_or_mean","vl_sq_or_mean","et_cl_or_mean","vl_cl_or_mean")), "local"))

ggplot(data = data_f, aes(x = dominant, y = Segra, color = `ethnia` , linetype = `segregation`, shape = `orientation`)) +   geom_point(size = 3) + geom_line() + 
# scale_color_gradient(low="green", high="red")
 scale_x_discrete(limits=c(seq(0,20 ,by = 1))) + 
 scale_y_continuous(breaks=seq(0,max(data_f$Segra),by=0.25)) +
  scale_linetype_manual(values=c("solid","dashed"), labels = c("ethnic","value"), guide = guide_legend(title = "Dimension", order = 1)) +
scale_color_manual(values = c("blue","darkorange"), guide = guide_legend(title="Ethnicity", order = 2)) + 
 scale_shape_manual(values = c("square","circle"), guide = guide_legend(title="Orientation" ,override.aes = list(size = 3), order = 3)) +
  xlab("ß dominant") + ylab("Index") + 
# facet_wrap(~ `index`, dir = "v", scales = "free_y") + 
  geom_blank() +
  theme_bw() +  theme( axis.title.x = (element_text(size = 15)), axis.title.y = (element_text(size = 15)), axis.text.x =  (element_text(size = 15)),axis.text.y =  (element_text(size = 15)), legend.title = element_text(size = 13) ,legend.text = element_text(size = 13), plot.title=element_text(hjust = 0.5)) + theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 


ggsave("images/prox_asym_dom.jpg",plot = last_plot(),
  device = NULL,path = NULL, 
  scale = 1,
  width = 10,
  height = 4,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = FALSE)

# robustness table

table_rb <- xtable(asym_dom_sa[,c("dominant","de_sq_bl_mean","de_sq_bl_sd","de_cl_bl_mean","de_cl_bl_sd","de_sq_or_mean","de_sq_or_sd","de_cl_or_mean","de_cl_or_sd","dv_sq_bl_mean","dv_sq_bl_sd","dv_cl_bl_mean","dv_cl_bl_sd","dv_sq_or_mean","dv_sq_or_sd","dv_cl_or_mean","dv_cl_or_sd")], digits = 3)
align(table_rb) <- "c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|"

addtorow <- list()
addtorow$pos <- list(0, 0,0,0,0)
addtorow$command <-  c("\\multicolumn{17}{|c|}{Ethnic Asymmetric condition: Spatial Proximity}  \\\\\\hline\n",
   "Preference &  \\multicolumn{8}{|c|}{Ethnic Exposure} & \\multicolumn{8}{|c|}{Value Exposure}   \\\\\\hline\n",
  "& \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  & \\multicolumn{4}{|c|}{Local} & \\multicolumn{4}{|c|}{Minority}  \\\\\n",
"$\\beta$ sec = 0 & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} & \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal} 
& \\multicolumn{2}{|c|}{Conservative} & \\multicolumn{2}{|c|}{Liberal}\\\\\n",
" & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD & Mean & SD\\\\\n")


print(table_rb,type = "latex", file = "prox_asym_rb.tex", include.rownames=FALSE, add.to.row = addtorow, include.colnames = FALSE, latex.environments = "center")



A = data.frame(x = rnorm(10),y=rnorm(10))
B = data.frame(x = rnorm(10),y=rnorm(10))
ggplot(A,aes(x,y)) +geom_point() +geom_point(data=B,colour='red') + xlim(0, 10) 

```

```{r onebeta, fig.pos="H",  fig.width=10, fig.cap="Same parameter for ethnic and value homophily for all agents", echo=FALSE}

base_eq %>% filter(dominant == secondary_square & dominant == secondary_circle & secondary_circle == secondary_square)  %>%  gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>% mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic\nsegregation" = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value\nsegregation" = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic segregation"), `group` = fct_relevel(fct_collapse(subgroup, "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min"), "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative")), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "local" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "minority" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"local" )) %>% 
  
  
  ggplot( aes(x = dominant, y = Segra, color = `ethnia`, shape = `group`, linetype = `segregation`  )) + geom_line() + geom_point() +     
  scale_x_discrete(limits=c(seq(0,20 ,by = 1))) +
scale_y_continuous(limits=c(0,1), breaks=seq(0,1,by=0.25)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
  geom_hline(yintercept = 0.5, color = "red", linetype = 2) +
  scale_color_manual(values = c("blue","orange"), guide = guide_legend(title="",override.aes = list(size = 2))) +
  scale_linetype_manual(values = c("solid","dashed"), guide = guide_legend(title="",override.aes = list(size = 1))) +
  scale_shape_manual(values = c("circle","square"), guide = guide_legend(title="",override.aes = list(size = 3))) + xlab("ß dominant = ß secondary") + ylab("Segregation") +   
  theme_bw() +  theme( legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 19),axis.title.x = (element_text(size = 20)), axis.title.y = (element_text(size = 20)), axis.text.x =  (element_text(size = 18)),axis.text.y =  (element_text(size = 18)),
                      plot.title=element_text(hjust = 0.5),  legend.margin=margin(2,2,2,2)) +
  theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))

ggsave("one_beta.jpg",plot = last_plot(),
  device = NULL,
  path = NULL,
  scale = 1,
  width = 11,
  height = 5,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = FALSE)

```

```{r heatmap,fig.pos="H",  include=TRUE,fig.height=11, fig.width=11, fig.cap="Comparison dominant vs secondary", echo=FALSE}

base_eq  %>% filter(secondary_circle == secondary_square) %>% gather(key = subgroup, value = Segra, eth_sqr,val_sqr,eth_crl,val_crl) %>% mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic segregation" = c("eth_sqr","eth_crl"),"value segregation" = c("val_sqr","val_crl")), "ethnic segregation"),  `group` = fct_relevel(fct_collapse(subgroup,"liberal" = c("eth_crl","val_crl"), "conservative" = c("eth_sqr","val_sqr")),"liberal")) %>% 
  
  
  ggplot( aes(x = secondary_circle , y = dominant , fill = Segra)) + geom_tile() + 
 facet_grid( group ~  segregation) +
  xlab("Secondary Beta") + ylab("Dominant Beta") +
scale_x_discrete(limits=seq(0, 20 ,by = 1)) +
  scale_y_discrete(limits=seq(0,20 ,by = 1)) + 
  geom_text(aes(label=round(Segra,2)), size=3) +
   scale_fill_distiller(palette = "RdBu", limits=c(0,1), breaks=c(0,0.2,0.5,0.8,1), name = "Segregation") + 
    theme_bw() +  
  theme(legend.position = "bottom", legend.title = element_text(size = 12,vjust = 0.8), legend.text = element_text(size = 15),  legend.key.width  = unit(1, "inch"), 
                        legend.key.height  = unit(0.3, "inch"), panel.grid.minor.x = element_blank(), plot.title=element_text(hjust = 0.5),  legend.margin=margin(0,0,0,0),
                        axis.title.x = (element_text(size = 18)), axis.title.y = (element_text(size = 18)), axis.text.x =  (element_text(size = 13)),axis.text.y =  (element_text(size = 13)),strip.text.x = element_text(size = 15),
                        strip.text.y = element_text(size = 15))


ggsave("heatmapbase.jpg",plot = last_plot(),
  device = NULL,
  path = NULL,
  scale = 1,
  width = NA,
  height = NA,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)

```


```{r secondary_zero,fig.pos="H",  include=TRUE, fig.width=11,  fig.cap="Secondary preference set to 0. Here only circle minority, patterns are the same", echo=FALSE}

  base_eq  %>% filter(secondary_circle == 0 & secondary_square == 0) %>% gather(key = subgroup, value = Segra, eth_sqr,val_sqr,eth_crl,val_crl) %>% mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic segregation" = c("eth_sqr","eth_crl"),"value segregation" = c("val_sqr","val_crl")), "ethnic segregation"),  `group` = fct_relevel(fct_collapse(subgroup,"liberal" = c("eth_crl","val_crl"), "conservative" = c("eth_sqr","val_sqr")),"liberal")) %>%
  
  ggplot( aes(x = dominant, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size=3) + scale_x_discrete(limits=seq(0,20 ,by = 1)) +
 scale_y_continuous(breaks=seq(0,1,by = 0.1)) +
  scale_y_continuous(limits=c(0,1), breaks=seq(0,1,by=0.25)) +
        geom_vline(xintercept = c(1,5,10,20), color = "red") +
  geom_hline(yintercept = 0.5, color = "red", linetype = 2) +
    scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title="")) +
  scale_linetype_manual(values = c("solid","dashed"), guide = guide_legend(title="")) +
  scale_shape_manual(values = c("circle","square"), guide = guide_legend(title="")) + xlab("ß dominant") + ylab("Segregation") +   
 theme_bw() +  theme(
   legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 18), axis.title.x = (element_text(size = 20)), axis.title.y = (element_text(size = 20)), axis.text.x =  (element_text(size = 18)),axis.text.y =  (element_text(size = 18)),
                      plot.title=element_text(hjust = 0.5),  legend.margin=margin(0,0,0,0),
                     plot.caption = element_text(hjust= 0.5, size = 12)) +
  labs( caption = "Secondary ß for all agents = 0") +
  theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
   

ggsave("secondary_zero.jpg",plot = last_plot(),
  device = NULL,
  path = NULL,
  scale = 1,
  width = 11,
  height = 5,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = FALSE)

 
```

```{r bas_dom_crl, pos="H",  include=TRUE, fig.width=10,  fig.cap="Sensitivity dominant liberal",    echo=FALSE}

basic_dom <- read.csv("basic/equal_dom_sens.csv", sep = ",", skip = 6)
names(basic_dom) <- pull(read.csv("basic/legend_bas_sens.csv"))


  basic_dom  %>% filter(secondary_circle == 0, secondary_square == 0, dominant_square == 0) %>% gather(key = subgroup, value = Segra, eth_sqr,val_sqr,eth_crl,val_crl) %>% mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic segregation" = c("eth_sqr","eth_crl"),"value segregation" = c("val_sqr","val_crl")), "ethnic segregation"),  `group` = fct_relevel(fct_collapse(subgroup,"liberal" = c("eth_crl","val_crl"), "conservative" = c("eth_sqr","val_sqr")),"liberal")) %>%
  
  ggplot( aes(x = dominant_circle, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size=3) + scale_x_discrete(limits=seq(0,20 ,by = 1)) +
scale_y_continuous(limits=c(0,1), breaks=seq(0,1,by=0.25)) +
      geom_hline(yintercept = 0.5, color = "red", linetype = 2) +

  scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title="")) +
  scale_linetype_manual(values = c("solid","dashed"), guide = guide_legend(title="")) +
  scale_shape_manual(values = c("circle","square"), guide = guide_legend(title=""))   +
    xlab("ß value liberal") + ylab("Segregation") +   
      geom_vline(xintercept = c(1,5,10,20), color = "red") +
 theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 18), axis.title.x = (element_text(size = 20)), axis.title.y = (element_text(size = 20)), axis.text.x =  (element_text(size = 18)),axis.text.y =  (element_text(size = 18)),
                      plot.title=element_text(hjust = 0.5),  legend.margin=margin(0,0,0,0),
                     plot.caption = element_text(hjust= 0.5, size = 12)) +
labs( caption = "ß ethnic liberal = 0\n ß value and ethnic conservative = 0") +
  theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))


ggsave("bas_dom_crl.jpg",plot = last_plot(),
  device = NULL,
  path = NULL,
  scale = 1,
  width = 11,
  height = 7,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = FALSE)

 
```

```{r bas_dom_sqr, pos="H",  include=TRUE, fig.width=10,  fig.cap="Sensitivity dominant conservative", echo=FALSE}

basic_dom <- read.csv("basic/equal_dom_sens.csv", sep = ",", skip = 6)
names(basic_dom) <- pull(read.csv("basic/legend_bas_sens.csv"))


  basic_dom  %>% filter(secondary_circle == 0, secondary_square == 0, dominant_circle == 0) %>% gather(key = subgroup, value = Segra, eth_sqr,val_sqr,eth_crl,val_crl) %>% mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic segregation" = c("eth_sqr","eth_crl"),"value segregation" = c("val_sqr","val_crl")), "ethnic segregation"),  `group` = fct_relevel(fct_collapse(subgroup,"liberal" = c("eth_crl","val_crl"), "conservative" = c("eth_sqr","val_sqr")),"liberal")) %>%
  
  ggplot( aes(x = dominant_square, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size=3) + scale_x_discrete(limits=seq(0,20 ,by = 1)) +
scale_y_continuous(limits=c(0,1), breaks=seq(0,1,by=0.25)) +
  scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title="")) +
  scale_linetype_manual(values = c("solid","dashed"), guide = guide_legend(title="")) +
  scale_shape_manual(values = c("circle","square"), guide = guide_legend(title="")) +
      geom_vline(xintercept = c(1,5,10,20), color = "red") +
      geom_hline(yintercept = 0.5, color = "red", linetype = 2) +
    xlab("ß ethnic conservative") + ylab("Segregation") +   

 theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 18), axis.title.x = (element_text(size = 20)), axis.title.y = (element_text(size = 20)), axis.text.x =  (element_text(size = 18)),axis.text.y =  (element_text(size = 18)),
                      plot.title=element_text(hjust = 0.5),  legend.margin=margin(0,0,0,0),
                     plot.caption = element_text(hjust= 0.5, size = 12)) +
  labs( caption = "ß value conservative = 0\n ß value and ethnic liberal = 0") +
  theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))


ggsave("bas_dom_sqr.jpg",plot = last_plot(),
  device = NULL,
  path = NULL,
  scale = 1,
  width = 11,
  height = 7,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)




 
```


```{r random_circle, pos="H",  include=TRUE, fig.width=10,  fig.cap="Sensitivity secondary circle", echo=FALSE}

basic_rand <- read.csv("basic/equal_rand_sens.csv", sep = ",", skip = 6)
names(basic_rand) <- pull(read.csv("basic/legend_bas_sens.csv"))


  basic_rand  %>% filter(secondary_square == 0) %>% gather(key = subgroup, value = Segra, eth_sqr,val_sqr,eth_crl,val_crl) %>% mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic segregation" = c("eth_sqr","eth_crl"),"value segregation" = c("val_sqr","val_crl")), "ethnic segregation"),  `group` = fct_relevel(fct_collapse(subgroup,"liberal" = c("eth_crl","val_crl"), "conservative" = c("eth_sqr","val_sqr")),"liberal")) %>%
  
  ggplot( aes(x = secondary_circle, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size=3) + scale_x_discrete(limits=seq(0,20 ,by = 1)) +
scale_y_continuous(limits=c(0,1), breaks=seq(0,1,by=0.25)) +
  scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title="")) +
  scale_linetype_manual(values = c("solid","dashed"), guide = guide_legend(title="")) +
  scale_shape_manual(values = c("circle","square"), guide = guide_legend(title="")) + 
      geom_vline(xintercept = c(1,5,10,20), color = "red") +
      geom_hline(yintercept = 0.5, color = "red", linetype = 2) +
    xlab("ß ethnic liberal") + ylab("Segregation") +   
 theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 18), axis.title.x = (element_text(size = 20)), axis.title.y = (element_text(size = 20)), axis.text.x =  (element_text(size = 18)),axis.text.y =  (element_text(size = 18)),
                      plot.title=element_text(hjust = 0.5),  legend.margin=margin(0,0,0,0),
                     plot.caption = element_text(hjust= 0.5, size = 12)) +
  labs( caption = "ß value liberal = 20; ß ethnic conservative = 20\n ß value conservative = 0") +
  theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))



ggsave("bas_sec_crl.jpg",plot = last_plot(),
  device = NULL,
  path = NULL,
  scale = 1,
  width = 11,
  height = 6,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)




 
```



```{r random_square, pos="H",  include=TRUE, fig.width=10,  fig.cap="Sensitivity secondary circle", echo=FALSE}

basic_rand <- read.csv("basic/equal_rand_sens.csv", sep = ",", skip = 6)
names(basic_rand) <- pull(read.csv("basic/legend_bas_sens.csv"))


  basic_rand  %>% filter(secondary_circle == 0) %>% gather(key = subgroup, value = Segra, eth_sqr,val_sqr,eth_crl,val_crl) %>% mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic segregation" = c("eth_sqr","eth_crl"),"value segregation" = c("val_sqr","val_crl")), "ethnic segregation"),  `group` = fct_relevel(fct_collapse(subgroup,"liberal" = c("eth_crl","val_crl"), "conservative" = c("eth_sqr","val_sqr")),"liberal")) %>%
  
  ggplot( aes(x = secondary_square, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size=3) + scale_x_discrete(limits=seq(0,20 ,by = 1)) +
scale_y_continuous(limits=c(0,1), breaks=seq(0,1,by=0.25)) +
  scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title="")) +
  scale_linetype_manual(values = c("solid","dashed"), guide = guide_legend(title="")) +
  scale_shape_manual(values = c("circle","square"), guide = guide_legend(title="")) + xlab("ß value conservative") + ylab("Segregation") +   
      geom_vline(xintercept = c(1,5,10,20), color = "red") +
       geom_hline(yintercept = 0.5, color = "red", linetype = 2) +
 theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 18), axis.title.x = (element_text(size = 20)), axis.title.y = (element_text(size = 20)), axis.text.x =  (element_text(size = 18)),axis.text.y =  (element_text(size = 18)),
                      plot.title=element_text(hjust = 0.5),  legend.margin=margin(0,0,0,0),
                     plot.caption = element_text(hjust= 0.5, size = 12)) +
  labs( caption = "ß value liberal = 20, ß ethnic conservative = 20\n ß ethnic liberal = 0") +
  theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))


ggsave("bas_sec_sqr.jpg",plot = last_plot(),
  device = NULL,
  path = NULL,
  scale = 1,
  width = 11,
  height = 6,
  units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)




 
```




# Asymmetric CONDITIONS

```{r asymmetricmech5050, fig.pos="H", include=TRUE,fig.cap="Ethnic asymmetric condition. 80% local, 20% minority. Both 50% liberal", echo=FALSE}
# 
# ethnia.labs <- c("Local: 80% population", "Minority: 20% population")
# names(ethnia.labs) <- c("aaaaa", "minority")


majority_bsa %>%   filter(circle_orange == 50, secondary_circle == 0, secondary_square == 0)  %>%  gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>% mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min"), "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative")), 
    `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals: 80% population | 50% liberals" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% population | 50% liberals" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals: 80% population | 50% liberals" )) %>% 
  
  
  
  ggplot( aes(x = dominant, y = Segra, color = `segregation`, shape = `group`)) + 
  geom_line() + geom_point(size = 3) +           scale_x_discrete(limits= seq(0,20 ,by = 1)) +
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
 #  scale_y_continuous(limits=c(0,1), breaks = c(0.2,0.5,0.8),position = "right") +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
# sec.axis = sec_axis( trans=~.*10, name="Second Axis")

  facet_wrap(~ `ethnia`,nrow =2 , dir = "v") +
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   xlab("ß Dominant all agents\n ß Secondary all agents = 0") + 
  ylab("Segregation") +   
   theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y = (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x = (element_text(size = 12)), #   element_blank(), # 
                      axis.text.x = (element_text(size = 11)),
                      axis.text.y =  (element_text(size = 11)),
                      plot.title=element_text(hjust = 0.5),  
                      legend.margin=margin(0,2,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 

ggsave("diffsize.jpg",plot = last_plot(),
  device = NULL,
  path = NULL,
  scale = 1,
  width = 5.5,
  height = 5,
 # units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)


```



```{r asymmetricmech5020, fig.pos="H", include=TRUE,fig.cap="Ethnic asymmetric condition. 80% local, 20% minority. Both 80% liberal", echo=FALSE}
# 
# ethnia.labs <- c("Local: 80% population", "Minority: 20% population")
# names(ethnia.labs) <- c("aaaaa", "minority")

majority_bsa %>%   filter(circle_orange == 20, secondary_circle == 0, secondary_square == 0)  %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>% mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min"), "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative")), 
    `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals: 80% population | 50% liberals" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% population | 20% liberals" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals: 80% population | 50% liberals" )) %>% 
  
  
  
  ggplot( aes(x = dominant, y = Segra, color = `segregation`, shape = `group`)) + 
  geom_line() + geom_point(size = 3) +           scale_x_discrete(limits= seq(0,20 ,by = 1)) +
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
 #  scale_y_continuous(limits=c(0,1), breaks = c(0.2,0.5,0.8),position = "right") +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
# sec.axis = sec_axis( trans=~.*10, name="Second Axis")

  facet_wrap(~ `ethnia`,nrow =2 , dir = "v") +
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   xlab("ß Dominant all agents\n ß Secondary all agents = 0") + 
  ylab("Segregation") +   
   theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y = (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x = (element_text(size = 12)), #   element_blank(), # 
                      axis.text.x = (element_text(size = 11)),
                      axis.text.y =  (element_text(size = 11)),
                      plot.title=element_text(hjust = 0.5),  
                      legend.margin=margin(0,2,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 


ggsave("diffsize20.jpg",plot = last_plot(),
  device = NULL,
  path = NULL,
  scale = 1,
  width = 5.5,
  height = 5,
 # units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)

# +
#  scale_shape_manual(values = c(16,15), guide = guide_legend(title="")) +

```



```{r asymmetricmech5080, fig.pos="H", include=TRUE,fig.cap="Ethnic asymmetric condition. 80% local, 20% minority. Both 50% liberal", echo=FALSE}
# 
# ethnia.labs <- c("Local: 80% population", "Minority: 20% population")
# names(ethnia.labs) <- c("aaaaa", "minority")

majority_bsa %>%   filter(circle_orange == 80, secondary_circle == 0, secondary_square == 0)  %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>% mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min"), "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative")), 
    `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals: 80% population | 50% liberals" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% population | 80% liberals" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals: 80% population | 50% liberals" )) %>% 
  
  
  
  ggplot( aes(x = dominant, y = Segra, color = `segregation`, shape = `group`)) + 
  geom_line() + geom_point(size = 3) +           scale_x_discrete(limits= seq(0,20 ,by = 1)) +
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
# sec.axis = sec_axis( trans=~.*10, name="Second Axis")

  facet_wrap(~ `ethnia`,nrow =2 , dir = "v") +
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
    xlab("ß Dominant all agents\n ß Secondary all agents = 0") + 
  ylab("Segregation") +   
   theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y = (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x = (element_text(size = 12)), #   element_blank(), # 
                      axis.text.x = (element_text(size = 11)),
                      axis.text.y =  (element_text(size = 11)),
                      plot.title=element_text(hjust = 0.5),  
                      legend.margin=margin(0,2,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 

ggsave("diffsize80.jpg",plot = last_plot(),
  device = NULL,
  path = NULL,
  scale = 1,
  width = 5.5,
  height = 5,
 # units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)


# +
#  scale_shape_manual(values = c(16,15), guide = guide_legend(title="")) +

```

## Asymmetric dominant = secondary





```{r asym_sens database, fig.pos="H",include=TRUE,fig.cap="Dominant = Secondary; Migrants change", echo=FALSE}

# Change only in Migrants

domsec_min <- read.csv("maj/sens_asym_min.csv")
ID <- rep("min", length(domsec_min$run))
domsec_min <- cbind(ID,domsec_min)

domsec_maj <- read.csv("maj/sens_asym_maj.csv")
ID <- rep("maj", length(domsec_min$run))
domsec_maj <- cbind(ID,domsec_maj)

dataset_maj <- rbind(domsec_min,domsec_maj)
  
dominant_locals.labs <- c("ß Dominant Locals: 0", "ß Dominant Locals: 5","ß Dominant Locals: 10")
names(dominant_locals.labs) <- c("0", "5", "10")
circle_orange_labs <- c("20% Liberal Migrants", "50% Liberal Migrants","80% Liberal Migrants")
names(circle_orange_labs) <- c("20", "50", "80")
dominant_migrants.labs <- c("ß Dominant Migrants: 0", "ß Dominant Migrants: 5","ß Dominant Migrants: 10")
names(dominant_migrants.labs) <- c("0", "5", "10")
dominant_locals.labs <- c("ß Dominant Locals: 0", "ß Dominant Locals: 5","ß Dominant Locals: 10")
names(dominant_locals.labs) <- c("0", "5", "10")

```




```{r asym_dom_min, fig.pos="H",include=TRUE,fig.cap="Sensitivity assymetry", echo=FALSE}


## Comparison


loc_0 <- dataset_maj  %>% filter(ID == "min") %>% filter(circle_orange == 50) %>% filter(dominant_locals == 0) 
loc_5 <- dataset_maj  %>% filter(ID == "min") %>% filter(circle_orange == 50) %>% filter(dominant_locals == 5) 
loc_10 <- dataset_maj  %>% filter(ID == "min") %>% filter(circle_orange == 50) %>% filter(dominant_locals == 10) 

df <- loc_10
name_min <- paste0("loc_10",".jpg")

df %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>% mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."),`group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic population | 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic population | 50% liberal" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic population | 50% liberal" ))  %>%
  
  ggplot( aes(x = dominant_migrants, y = Segra, color = `segregation`, shape = `group`)) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= seq(0,20 ,by = 1)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_wrap( ~ `ethnia`,
             nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   ylab("Segregation") +   
  xlab("ß Dominat Migrants\n ß secondary all agents:0") + 
#  guides(color = FALSE, shape = FALSE) +
  ggtitle(paste0("ß dominant locals: ", df$dominant_locals)) +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y = (element_text(size = 12)), #     
                      axis.title.x = (element_text(size = 12)), #   element_blank(),  
                      
                     #  axis.title.y = element_blank(),
                     #  axis.title.x = element_blank(),
                      
                      axis.text.x = (element_text(size = 11)),
                      axis.text.y =  (element_text(size = 11)),
                      plot.title=element_text(hjust = 0.5),  
                      legend.margin=margin(0,2,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 


ggsave(name_min,plot = last_plot(),
  device = NULL,
  path = NULL,
  scale = 1,
  width = 5.5,
  height = 5,
 # units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)

```




```{r asym_dom_min_dislib, fig.pos="H",include=TRUE,fig.cap="Sensitivity assymetry minority, effect distribution liberal minority", echo=FALSE}


loc_0 <- dataset_maj  %>% filter(ID == "min") %>% filter(circle_orange == 50) %>% filter(dominant_locals == 0) 
loc_5 <- dataset_maj  %>% filter(ID == "min") %>% filter(circle_orange == 20|circle_orange == 50 | circle_orange == 80) %>% filter(dominant_locals == 5)
loc_10 <- dataset_maj  %>% filter(ID == "min") %>% filter(circle_orange == 20|circle_orange == 50 | circle_orange == 80) %>% filter(dominant_locals == 10) 

df <- loc_10
name_min <- paste0("loc_10","_dislib.jpg")

df %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>% mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."),`group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = dominant_migrants, y = Segra, color = `segregation`, shape = `group`)) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= seq(0,20 ,by = 1)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid( `ethnia` ~ circle_orange, labeller = labeller(circle_orange = circle_orange_labs)) + 
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   ylab("Segregation") +   
  xlab("ß Dominat Migrants\n ß secondary all agents:0") + 
# guides(color = FALSE, shape = FALSE) +
 ggtitle(paste0("ß dominant locals: ", df$dominant_locals)) +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                     axis.title.y = (element_text(size = 12)), #     
                     axis.title.x = (element_text(size = 12)), #   element_blank(),  
                      
                      #  axis.title.y = element_blank(),
                      #  axis.title.x = element_blank(),
                      
                      axis.text.x = (element_text(size = 9)),
                      axis.text.y =  (element_text(size = 9)),
                      plot.title=element_text(hjust = 0.5),  
                      legend.margin=margin(0,2,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 


ggsave(name_min,plot = last_plot(),
  device = NULL,
  path = NULL,
  scale = 1.5,
  width = 8, #7.3,
  height = 4, #3.8,
 # units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)

```


```{r asym_dom_maj, fig.pos="H",include=TRUE,fig.cap="Sensitivity assymetry majority locals", echo=FALSE}


mig_0 <- dataset_maj  %>% filter(ID == "maj") %>% filter(circle_orange == 50) %>% filter(dominant_migrants == 0) 
mig_5 <- dataset_maj  %>% filter(ID == "maj") %>% filter(circle_orange == 50) %>% filter(dominant_migrants == 5) 
mig_10 <- dataset_maj  %>% filter(ID == "maj") %>% filter(circle_orange == 50) %>% filter(dominant_migrants == 10) 

dfm <- mig_5
name_maj <- paste0("mig_5",".jpg")

dfm %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>% mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic population | 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic population | 50% liberal" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic population | 50% liberal" ))  %>%
  
  ggplot( aes(x = dominant_locals, y = Segra, color = `segregation`, shape = `group`)) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= seq(0,20 ,by = 1)) +
  
scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_wrap( ~ `ethnia`,
             nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   ylab("Segregation") +   
  xlab("ß Dominat Locals\n ß secondary all agents:0") + 
# guides(color = FALSE, shape = FALSE) +
  ggtitle(paste0("ß dominant migrants: ", dfm$dominant_migrants)) +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                     # axis.title.y = (element_text(size = 12)), #     
                     #  axis.title.x = (element_text(size = 12)), #   element_blank(),  
                      
                     axis.title.y = element_blank(),
                      axis.title.x = element_blank(),
                      axis.text.x = (element_text(size = 11)),
                      axis.text.y =  (element_text(size = 11)),
                      plot.title=element_text(hjust = 0.5),  
                      legend.margin=margin(0,2,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 


ggsave(name_maj,plot = last_plot(),
  device = NULL,
  path = NULL,
  scale = 1,
  width = 5.5,
  height = 5,
 # units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)



```


```{r asym_dom_maj_dislib, fig.pos="H",include=TRUE,fig.cap="Sensitivity assymetry majority locals, effect liberal migrants distribution", echo=FALSE}


# mig_0 <- dataset_maj  %>% filter(ID == "maj") %>% filter(circle_orange == 50) %>% filter(dominant_migrants == 0) 
mig_5 <- dataset_maj  %>% filter(ID == "maj") %>% filter(circle_orange == 20 | circle_orange == 50 |circle_orange == 80) %>% filter(dominant_migrants == 5) 
mig_10 <- dataset_maj  %>% filter(ID == "maj") %>% filter(circle_orange == 20 | circle_orange == 50 |circle_orange == 80) %>% filter(dominant_migrants == 10) 

dfm <- mig_5
name_maj <- paste0("mig_5","_dislib.jpg")

dfm %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>% mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."),`group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = dominant_locals, y = Segra, color = `segregation`, shape = `group`)) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= seq(0,20 ,by = 1)) +
  
scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid( `ethnia` ~ circle_orange, labeller = labeller(circle_orange = circle_orange_labs)) + 
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   ylab("Segregation") +   
  xlab("ß Dominat Locals\n ß secondary all agents:0") + 
# guides(color = FALSE, shape = FALSE) +
  ggtitle(paste0("ß dominant migrants: ", dfm$dominant_migrants)) +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y = (element_text(size = 12)), #     
                      axis.title.x = (element_text(size = 12)), #   element_blank(),  
                      
                    # axis.title.y = element_blank(),
                    #   axis.title.x = element_blank(),
                      axis.text.x = (element_text(size = 11)),
                      axis.text.y =  (element_text(size = 11)),
                      plot.title=element_text(hjust = 0.5),  
                      legend.margin=margin(0,2,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 



ggsave(name_maj, plot = last_plot(),
  device = NULL,
  path = NULL,
  scale = 1.5,
  width = 8,
  height = 4,
 # units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)

```



# Increase in ethnnic liberal

```{r libethn database, fig.width= 7,fig.height= 6, fig.pos="H",include=TRUE,fig.cap="Increase in  ethnic liberal", echo=FALSE}

hc_hc <- read.csv("maj/maj_min_20-20-table.csv", sep = ",", skip = 6)
names(hc_hc) <- pull(read.csv("maj/leg_maj_sens.csv"))
ID <- rep("hc_hc", length(hc_hc$run))
hc_hc <- cbind(ID,hc_hc)

hc_lc <- read.csv("maj/maj_min_20-5-table.csv", sep = ",", skip = 6)
names(hc_lc) <- pull(read.csv("maj/leg_maj_sens.csv"))
ID <- rep("hc_lc", length(hc_lc$run))
hc_lc <- cbind(ID,hc_lc)

lc_hc <- read.csv("maj/maj_min_5-20-table.csv", sep = ",", skip = 6)
names(lc_hc) <- pull(read.csv("maj/leg_maj_sens.csv"))
ID <- rep("lc_hc",length(lc_hc$run))
lc_hc <- cbind(ID,lc_hc)

lc_lc <- read.csv("maj/maj_min_5-5-table.csv", sep = ",", skip = 6)
names(lc_lc) <- pull(read.csv("maj/leg_maj_sens.csv"))
ID <- rep("lc_lc",length(lc_lc$run))
lc_lc <- cbind(ID,lc_lc)

df_eth_loc <- rbind(hc_hc,hc_lc,lc_hc,lc_lc)
#rm(hc_hc,hc_lc,lc_hc,lc_lc)


```


# Final


```{r rand50, fig.width= 8,fig.height= 7, fig.pos="H",include=TRUE,fig.cap="Individual comparison rand 50", echo=FALSE}



eth_min_lib.labs <- c("ß Ethnic liberal migrants: 0", "ß Ethnic liberal migrants: 1", "ß Ethnic liberal migrants: 2","ß Ethnic liberal migrants: 3","ß Ethnic liberal migrants: 4","ß Ethnic liberal migrants: 5","ß Ethnic liberal migrants: 10","ß Ethnic liberal migrants: 15","ß Ethnic liberal migrants: 20")
names(eth_min_lib.labs) <- c("0","1","2","3","4", "5","10","15","20")
eth_loc_lib.labs <- c("ß Ethnic liberal locals: 0", "ß Ethnic liberal locals: 1", "ß Ethnic liberal locals: 2","ß Ethnic liberal locals: 3","ß Ethnic liberal locals: 4","ß Ethnic liberal locals: 5","ß Ethnic liberal locals: 10","ß Ethnic liberal locals: 15","ß Ethnic liberal locals: 20")
names(eth_loc_lib.labs) <-  c("0","1","2","3","4", "5","10","15","20")



# Intermediate randomness Migrants x-axys

 df_eth_loc  %>% filter(ID == "lc_hc") %>% filter(circle_orange == 50)  %>% filter(eth_loc_lib == 0 | eth_loc_lib == 1 | eth_loc_lib == 3 | eth_loc_lib == 5) %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic\n 50% liberal" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_min_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5,10,15,20)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ eth_loc_lib, labeller = labeller(eth_loc_lib = eth_loc_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   ylab("Segregation") +   
  xlab("Ethnic liberal migrants") + 
#  guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant migrants: 20\nß dominant locals: 5") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 




ggsave("lc_hc5_min.jpg",last_plot(),
  device = NULL,
  path = NULL,
  scale = 2,
  width = 6,
  height = 3,
 # units = ("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)


# Intermediate randomness Locals x-axys

df_eth_loc  %>% filter(ID == "hc_lc") %>% filter(circle_orange == 50)  %>% filter(eth_min_lib == 0 | eth_min_lib == 1 | eth_min_lib == 3 |   eth_min_lib == 5) %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic\n 50% liberal" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_loc_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5,10,15,20)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ eth_min_lib, labeller = labeller(eth_min_lib = eth_min_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   ylab("Segregation") +   
  xlab("ethnic liberal locals") + 
# guides(color = FALSE, shape = FALSE) +
xlab("Ethnic liberal locals") + 
# guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant locals: 20\nß dominant migrants: 5") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 

# 
# comb <- ggarrange(mig,loc, nrow =  2, common.legend = TRUE, legend = "bottom")
# annotate_figure(comb, 
#                # top = text_grob("Dominant ß: 5",  face = "bold", size = 12),
#                left = text_grob("Segregation", rot = 90, size = 12),
#                 bottom = text_grob("ß value conservative both group: 0", hjust = 1, x = 1, size = 12),
#                 )


ggsave("lc_hc5_maj.jpg",last_plot(),
  device = NULL,
  path = NULL,
   scale = 2,
  width = 6,
  height = 3,
 # units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)

```




```{r det50, fig.width= 8,fig.height= 7, fig.pos="H",include=TRUE,fig.cap="Individual comparison determinism beta 20", echo=FALSE}



eth_min_lib.labs <- c("ß Ethnic liberal migrants: 0", "ß Ethnic liberal migrants: 1", "ß Ethnic liberal migrants: 2","ß Ethnic liberal migrants: 3","ß Ethnic liberal migrants: 4","ß Ethnic liberal migrants: 5","ß Ethnic liberal migrants: 10","ß Ethnic liberal migrants: 15","ß Ethnic liberal migrants: 20")
names(eth_min_lib.labs) <- c("0","1","2","3","4", "5","10","15","20")
eth_loc_lib.labs <- c("ß Ethnic liberal locals: 0", "ß Ethnic liberal locals: 1", "ß Ethnic liberal locals: 2","ß Ethnic liberal locals: 3","ß Ethnic liberal locals: 4","ß Ethnic liberal locals: 5","ß Ethnic liberal locals: 10","ß Ethnic liberal locals: 15","ß Ethnic liberal locals: 20")
names(eth_loc_lib.labs) <-  c("0","1","2","3","4", "5","10","15","20")



# Intermediate randomness Migrants x-axys

 df_eth_loc  %>% filter(ID == "hc_hc") %>% filter(circle_orange == 50)  %>% filter(eth_loc_lib == 0 | eth_loc_lib == 5 | eth_loc_lib == 10 | eth_loc_lib == 20) %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic\n 50% liberal" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_min_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5,10,15,20)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ eth_loc_lib, labeller = labeller(eth_loc_lib = eth_loc_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   ylab("Segregation") +   
  xlab("Ethnic liberal migrants") + 
# guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant migrants: 20\nß dominant locals: 20") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 




ggsave("hc_hc5_min.jpg",last_plot(),
  device = NULL,
  path = NULL,
  scale = 2,
  width = 6,
  height = 3,
 # units = ("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)


# Intermediate randomness Locals x-axys

df_eth_loc  %>% filter(ID == "hc_hc") %>% filter(circle_orange == 50)  %>%  filter(eth_min_lib == 0 | eth_min_lib == 5 | eth_min_lib == 10 | eth_min_lib == 20)  %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic\n 50% liberal" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_loc_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5,10,15,20)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ eth_min_lib, labeller = labeller(eth_min_lib = eth_min_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   ylab("Segregation") +   
  xlab("ethnic liberal locals") + 
# guides(color = FALSE, shape = FALSE) +
xlab("Ethnic liberal locals") + 
 guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant locals: 20\nß dominant migrants: 20") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 


ggsave("hc_hc5_maj.jpg",last_plot(),
  device = NULL,
  path = NULL,
   scale = 2,
  width = 6,
  height = 3,
 # units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)



#######
#######


# Intermediate randomness Migrants x-axys

 df_eth_loc  %>% filter(ID == "lc_lc") %>% filter(circle_orange == 50)  %>% filter(eth_loc_lib == 0 | eth_loc_lib == 1 | eth_loc_lib == 3 | eth_loc_lib == 5) %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic\n 50% liberal" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_min_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ eth_loc_lib, labeller = labeller(eth_loc_lib = eth_loc_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   ylab("Segregation") +   
  xlab("Ethnic liberal migrants") + 
# guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant migrants: 5\nß dominant locals: 5") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 




ggsave("lc_lc5_min.jpg",last_plot(),
  device = NULL,
  path = NULL,
  scale = 2,
  width = 6,
  height = 3,
 # units = ("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)


# Intermediate randomness Locals x-axys

df_eth_loc  %>% filter(ID == "lc_lc") %>% filter(circle_orange == 50)  %>%  filter(eth_min_lib == 0 | eth_min_lib == 1 | eth_min_lib == 3 | eth_min_lib == 5)  %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic\n 50% liberal" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_loc_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ eth_min_lib, labeller = labeller(eth_min_lib = eth_min_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   ylab("Segregation") +   
  xlab("ethnic liberal locals") + 
# guides(color = FALSE, shape = FALSE) +
xlab("Ethnic liberal locals") + 
# guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant migrants: 5\nß dominant locals: 5") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 


ggsave("lc_lc5_maj.jpg",last_plot(),
  device = NULL,
  path = NULL,
   scale = 2,
  width = 6,
  height = 3,
 # units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)


##### RANDOM dislib

 df_eth_loc  %>% filter(ID == "lc_lc")   %>% filter(eth_loc_lib == 5) %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_min_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ circle_orange, labeller = labeller(eth_loc_lib = eth_loc_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
 ylab("Segregation") +   
 xlab("ß ethnic liberal migrants") + 
# guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant migrants: 5; ß dominant locals: 5\nß ethnic liberal locals: 5") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 

ggsave("lc_lc_dis_min.jpg",last_plot(),
  device = NULL,
  path = NULL,
   scale = 2,
  width = 5,
  height = 3,
 # units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)

# maj

df_eth_loc  %>% filter(ID == "lc_lc")   %>% filter(eth_min_lib == 5) %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_loc_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5,10,15,20)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ circle_orange, labeller = labeller(eth_loc_lib = eth_loc_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
 ylab("Segregation") +   
 xlab("ß ethnic liberal locals") + 
# guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant locals: 5; ß dominant migrants: 5\nß ethnic liberal migrants: 5") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 

ggsave("lc_lc_dis_maj.jpg",last_plot(),
  device = NULL,
  path = NULL,
   scale = 2,
  width = 5,
  height = 3,
 # units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)






```



```{r comparison baseline asym, fig.width= 8,fig.height= 7, fig.pos="H",include=TRUE,fig.cap="50% lib migrant", echo=FALSE}



eth_min_lib.labs <- c("ß Ethnic liberal migrants: 0", "ß Ethnic liberal migrants: 1", "ß Ethnic liberal migrants: 2","ß Ethnic liberal migrants: 3","ß Ethnic liberal migrants: 4","ß Ethnic liberal migrants: 5","ß Ethnic liberal migrants: 10","ß Ethnic liberal migrants: 15","ß Ethnic liberal migrants: 20")
names(eth_min_lib.labs) <- c("0","1","2","3","4", "5","10","15","20")
eth_loc_lib.labs <- c("ß Ethnic liberal locals: 0", "ß Ethnic liberal locals: 1", "ß Ethnic liberal locals: 2","ß Ethnic liberal locals: 3","ß Ethnic liberal locals: 4","ß Ethnic liberal locals: 5","ß Ethnic liberal locals: 10","ß Ethnic liberal locals: 15","ß Ethnic liberal locals: 20")
names(eth_loc_lib.labs) <-  c("0","1","2","3","4", "5","10","15","20")


lc_hc_dis_min <-  df_eth_loc  %>% filter(ID == "hc_lc")   %>% filter(eth_loc_lib == 20) %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_min_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5,10,15,20)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ circle_orange, labeller = labeller(eth_loc_lib = eth_loc_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
 ylab("Segregation") +   
 xlab("ß ethnic liberal migrants") + 
# guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant migrants: 20; ß dominant locals: 5\nß ethnic liberal locals: 5") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 

ggsave("lc_hc_dis_min.jpg",lc_hc_dis_min,
  device = NULL,
  path = NULL,
   scale = 2,
  width = 5,
  height = 3,
 # units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)





hc_lc_dis_maj <-  df_eth_loc  %>% filter(ID == "hc_lc")   %>% filter(eth_min_lib == 5) %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_loc_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5,10,15,20)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ circle_orange, labeller = labeller(eth_loc_lib = eth_loc_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
 ylab("Segregation") +   
 xlab("ß ethnic liberal locals") + 
# guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant locals: 20; ß dominant migrants: 5\nß ethnic liberal migrants: 5") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 

ggsave("hc_lc_dis_maj.jpg",hc_lc_dis_maj,
  device = NULL,
  path = NULL,
   scale = 2,
  width = 5,
  height = 3,
 # units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)


# Determinism


hc_hc_dis_min <-  df_eth_loc  %>% filter(ID == "hc_hc")   %>% filter(eth_loc_lib == 20) %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_min_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5,10,15,20)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ circle_orange, labeller = labeller(eth_loc_lib = eth_loc_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
 ylab("Segregation") +   
 xlab("ß ethnic liberal migrants") + 
guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant migrants: 20; ß dominant locals: 20\nß ethnic liberal locals: 20") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 



ggsave("hc_hc_dis_min.jpg",hc_hc_dis_min,
  device = NULL,
  path = NULL,
   scale = 2,
  width = 5,
  height = 3,
 # units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)


hc_hc_dis_maj <-  df_eth_loc  %>% filter(ID == "hc_hc")   %>% filter(eth_min_lib == 20) %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_loc_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5,10,15,20)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ circle_orange, labeller = labeller(eth_loc_lib = eth_loc_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
 ylab("Segregation") +   
 xlab("ß ethnic liberal locals") + 
# guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant locals: 20; ß dominant migrants: 20\nß ethnic liberal migrants: 20") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 



ggsave("hc_hc_dis_maj.jpg",hc_hc_dis_maj,
  device = NULL,
  path = NULL,
   scale = 2,
  width = 5,
  height = 3,
 # units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)
```







```{r rand20, fig.width= 8,fig.height= 7, fig.pos="H",include=TRUE,fig.cap="Individual comparison rand 20", echo=FALSE}



eth_min_lib.labs <- c("ß Ethnic liberal migrants: 0", "ß Ethnic liberal migrants: 1", "ß Ethnic liberal migrants: 2","ß Ethnic liberal migrants: 3","ß Ethnic liberal migrants: 4","ß Ethnic liberal migrants: 5","ß Ethnic liberal migrants: 10","ß Ethnic liberal migrants: 15","ß Ethnic liberal migrants: 20")
names(eth_min_lib.labs) <- c("0","1","2","3","4", "5","10","15","20")
eth_loc_lib.labs <- c("ß Ethnic liberal locals: 0", "ß Ethnic liberal locals: 1", "ß Ethnic liberal locals: 2","ß Ethnic liberal locals: 3","ß Ethnic liberal locals: 4","ß Ethnic liberal locals: 5","ß Ethnic liberal locals: 10","ß Ethnic liberal locals: 15","ß Ethnic liberal locals: 20")
names(eth_loc_lib.labs) <-  c("0","1","2","3","4", "5","10","15","20")



# Intermediate randomness Migrants x-axys

 df_eth_loc  %>% filter(ID == "lc_hc") %>% filter(circle_orange == 20)  %>% filter(eth_loc_lib == 0 | eth_loc_lib == 1 | eth_loc_lib == 3 | eth_loc_lib == 5) %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic\n 20% liberal" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_min_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5,10,15,20)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ eth_loc_lib, labeller = labeller(eth_loc_lib = eth_loc_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   ylab("Segregation") +   
  xlab("Ethnic liberal migrants") + 
 guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant migrants: 20\nß dominant locals: 5") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 




ggsave("lc_hc2_min.jpg",last_plot(),
  device = NULL,
  path = NULL,
  scale = 2,
  width = 6,
  height = 3,
 # units = ("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)


# Intermediate randomness Locals x-axys

df_eth_loc  %>% filter(ID == "hc_lc") %>% filter(circle_orange == 20)  %>% filter(eth_min_lib == 0 | eth_min_lib == 1 | eth_min_lib == 3 |   eth_min_lib == 5) %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic\n 20% liberal" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_loc_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5,10,15,20)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ eth_min_lib, labeller = labeller(eth_min_lib = eth_min_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   ylab("Segregation") +   
  xlab("ethnic liberal locals") + 
# guides(color = FALSE, shape = FALSE) +
xlab("Ethnic liberal locals") + 
# guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant locals: 20\nß dominant migrants: 5") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 

# 
# comb <- ggarrange(mig,loc, nrow =  2, common.legend = TRUE, legend = "bottom")
# annotate_figure(comb, 
#                # top = text_grob("Dominant ß: 5",  face = "bold", size = 12),
#                left = text_grob("Segregation", rot = 90, size = 12),
#                 bottom = text_grob("ß value conservative both group: 0", hjust = 1, x = 1, size = 12),
#                 )


ggsave("lc_hc2_maj.jpg",last_plot(),
  device = NULL,
  path = NULL,
   scale = 2,
  width = 6,
  height = 3,
 # units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)

```



```{r rand80, fig.width= 8,fig.height= 7, fig.pos="H",include=TRUE,fig.cap="Individual comparison rand 80", echo=FALSE}



eth_min_lib.labs <- c("ß Ethnic liberal migrants: 0", "ß Ethnic liberal migrants: 1", "ß Ethnic liberal migrants: 2","ß Ethnic liberal migrants: 3","ß Ethnic liberal migrants: 4","ß Ethnic liberal migrants: 5","ß Ethnic liberal migrants: 10","ß Ethnic liberal migrants: 15","ß Ethnic liberal migrants: 20")
names(eth_min_lib.labs) <- c("0","1","2","3","4", "5","10","15","20")
eth_loc_lib.labs <- c("ß Ethnic liberal locals: 0", "ß Ethnic liberal locals: 1", "ß Ethnic liberal locals: 2","ß Ethnic liberal locals: 3","ß Ethnic liberal locals: 4","ß Ethnic liberal locals: 5","ß Ethnic liberal locals: 10","ß Ethnic liberal locals: 15","ß Ethnic liberal locals: 20")
names(eth_loc_lib.labs) <-  c("0","1","2","3","4", "5","10","15","20")



# Intermediate randomness Migrants x-axys

 df_eth_loc  %>% filter(ID == "lc_hc") %>% filter(circle_orange == 80)  %>% filter(eth_loc_lib == 0 | eth_loc_lib == 1 | eth_loc_lib == 3 | eth_loc_lib == 5) %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic\n 80% liberal" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_min_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5,10,15,20)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ eth_loc_lib, labeller = labeller(eth_loc_lib = eth_loc_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   ylab("Segregation") +   
  xlab("Ethnic liberal migrants") + 
 guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant migrants: 20\nß dominant locals: 5") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 




ggsave("lc_hc8_min.jpg",last_plot(),
  device = NULL,
  path = NULL,
  scale = 2,
  width = 6,
  height = 3,
 # units = ("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)


# Intermediate randomness Locals x-axys

df_eth_loc  %>% filter(ID == "hc_lc") %>% filter(circle_orange == 80)  %>% filter(eth_min_lib == 0 | eth_min_lib == 1 | eth_min_lib == 3 |   eth_min_lib == 5) %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic\n 80% liberal" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_loc_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5,10,15,20)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ eth_min_lib, labeller = labeller(eth_min_lib = eth_min_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   ylab("Segregation") +   
  xlab("ethnic liberal locals") + 
# guides(color = FALSE, shape = FALSE) +
xlab("Ethnic liberal locals") + 
# guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant locals: 20\nß dominant migrants: 5") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 

# 
# comb <- ggarrange(mig,loc, nrow =  2, common.legend = TRUE, legend = "bottom")
# annotate_figure(comb, 
#                # top = text_grob("Dominant ß: 5",  face = "bold", size = 12),
#                left = text_grob("Segregation", rot = 90, size = 12),
#                 bottom = text_grob("ß value conservative both group: 0", hjust = 1, x = 1, size = 12),
#                 )


ggsave("lc_hc8_maj.jpg",last_plot(),
  device = NULL,
  path = NULL,
   scale = 2,
  width = 6,
  height = 3,
 # units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)

```




```{r det20, fig.width= 8,fig.height= 7, fig.pos="H",include=TRUE,fig.cap="Individual comparison determinism beta 20", echo=FALSE}



eth_min_lib.labs <- c("ß Ethnic liberal migrants: 0", "ß Ethnic liberal migrants: 1", "ß Ethnic liberal migrants: 2","ß Ethnic liberal migrants: 3","ß Ethnic liberal migrants: 4","ß Ethnic liberal migrants: 5","ß Ethnic liberal migrants: 10","ß Ethnic liberal migrants: 15","ß Ethnic liberal migrants: 20")
names(eth_min_lib.labs) <- c("0","1","2","3","4", "5","10","15","20")
eth_loc_lib.labs <- c("ß Ethnic liberal locals: 0", "ß Ethnic liberal locals: 1", "ß Ethnic liberal locals: 2","ß Ethnic liberal locals: 3","ß Ethnic liberal locals: 4","ß Ethnic liberal locals: 5","ß Ethnic liberal locals: 10","ß Ethnic liberal locals: 15","ß Ethnic liberal locals: 20")
names(eth_loc_lib.labs) <-  c("0","1","2","3","4", "5","10","15","20")



# Intermediate randomness Migrants x-axys

 df_eth_loc  %>% filter(ID == "hc_hc") %>% filter(circle_orange == 20)  %>% filter(eth_loc_lib == 0 | eth_loc_lib == 5 | eth_loc_lib == 10 | eth_loc_lib == 20) %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic\n 20% liberal" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_min_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5,10,15,20)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ eth_loc_lib, labeller = labeller(eth_loc_lib = eth_loc_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   ylab("Segregation") +   
  xlab("Ethnic liberal migrants") + 
 guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant migrants: 20\nß dominant locals: 20") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 




ggsave("hc_hc2_min.jpg",last_plot(),
  device = NULL,
  path = NULL,
  scale = 2,
  width = 6,
  height = 3,
 # units = ("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)


# Intermediate randomness Locals x-axys

df_eth_loc  %>% filter(ID == "hc_hc") %>% filter(circle_orange == 20)  %>% filter(eth_min_lib == 0 | eth_min_lib == 5 | eth_min_lib == 10 | eth_min_lib == 20) %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic\n 20% liberal" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_loc_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5,10,15,20)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ eth_min_lib, labeller = labeller(eth_min_lib = eth_min_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   ylab("Segregation") +   
  xlab("ethnic liberal locals") + 
# guides(color = FALSE, shape = FALSE) +
xlab("Ethnic liberal locals") + 
# guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant locals: 20\nß dominant migrants: 20") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 

# 
# comb <- ggarrange(mig,loc, nrow =  2, common.legend = TRUE, legend = "bottom")
# annotate_figure(comb, 
#                # top = text_grob("Dominant ß: 5",  face = "bold", size = 12),
#                left = text_grob("Segregation", rot = 90, size = 12),
#                 bottom = text_grob("ß value conservative both group: 0", hjust = 1, x = 1, size = 12),
#                 )


ggsave("hc_hc2_maj.jpg",last_plot(),
  device = NULL,
  path = NULL,
   scale = 2,
  width = 6,
  height = 3,
 # units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)

```



```{r det80, fig.width= 8,fig.height= 7, fig.pos="H",include=TRUE,fig.cap="Individual comparison determinism beta 20", echo=FALSE}



eth_min_lib.labs <- c("ß Ethnic liberal migrants: 0", "ß Ethnic liberal migrants: 1", "ß Ethnic liberal migrants: 2","ß Ethnic liberal migrants: 3","ß Ethnic liberal migrants: 4","ß Ethnic liberal migrants: 5","ß Ethnic liberal migrants: 10","ß Ethnic liberal migrants: 15","ß Ethnic liberal migrants: 20")
names(eth_min_lib.labs) <- c("0","1","2","3","4", "5","10","15","20")
eth_loc_lib.labs <- c("ß Ethnic liberal locals: 0", "ß Ethnic liberal locals: 1", "ß Ethnic liberal locals: 2","ß Ethnic liberal locals: 3","ß Ethnic liberal locals: 4","ß Ethnic liberal locals: 5","ß Ethnic liberal locals: 10","ß Ethnic liberal locals: 15","ß Ethnic liberal locals: 20")
names(eth_loc_lib.labs) <-  c("0","1","2","3","4", "5","10","15","20")



# Intermediate randomness Migrants x-axys

 df_eth_loc  %>% filter(ID == "hc_hc") %>% filter(circle_orange == 80)  %>% filter(eth_loc_lib == 0 | eth_loc_lib == 5 | eth_loc_lib == 10 | eth_loc_lib == 20) %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic\n 80% liberal" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_min_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5,10,15,20)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ eth_loc_lib, labeller = labeller(eth_loc_lib = eth_loc_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   ylab("Segregation") +   
  xlab("Ethnic liberal migrants") + 
 guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant migrants: 20\nß dominant locals: 20") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 




ggsave("hc_hc8_min.jpg",last_plot(),
  device = NULL,
  path = NULL,
  scale = 2,
  width = 6,
  height = 3,
 # units = ("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)


# Intermediate randomness Locals x-axys

hc_hc8_maj <- df_eth_loc  %>% filter(ID == "hc_hc") %>% filter(circle_orange == 80)  %>% filter(eth_min_lib == 0 | eth_min_lib == 5 | eth_min_lib == 10 | eth_min_lib == 20) %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic\n 80% liberal" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_loc_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5,10,15,20)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ eth_min_lib, labeller = labeller(eth_min_lib = eth_min_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   ylab("Segregation") +   
  xlab("ethnic liberal locals") + 
# guides(color = FALSE, shape = FALSE) +
xlab("Ethnic liberal locals") + 
# guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant locals: 20\nß dominant migrants: 20") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 
# 
# comb <- ggarrange(mig,loc, nrow =  2, common.legend = TRUE, legend = "bottom")
# annotate_figure(comb, 
#                # top = text_grob("Dominant ß: 5",  face = "bold", size = 12),
#                left = text_grob("Segregation", rot = 90, size = 12),
#                 bottom = text_grob("ß value conservative both group: 0", hjust = 1, x = 1, size = 12),
#                 )


ggsave("hc_hc8_maj.jpg",hc_hc8_maj,
  device = NULL,
  path = NULL,
   scale = 2,
  width = 6,
  height = 3,
 # units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)

```


# TRASH


```{r rand50locals, fig.width= 8,fig.height= 7, fig.pos="H",include=TRUE,fig.cap="Individual comparison rand 50", echo=FALSE}



eth_min_lib.labs <- c("ß Ethnic liberal migrants: 0", "ß Ethnic liberal migrants: 1", "ß Ethnic liberal migrants: 2","ß Ethnic liberal migrants: 3","ß Ethnic liberal migrants: 4","ß Ethnic liberal migrants: 5","ß Ethnic liberal migrants: 10","ß Ethnic liberal migrants: 15","ß Ethnic liberal migrants: 20")
names(eth_min_lib.labs) <- c("0","1","2","3","4", "5","10","15","20")
eth_loc_lib.labs <- c("ß Ethnic liberal locals: 0", "ß Ethnic liberal locals: 1", "ß Ethnic liberal locals: 2","ß Ethnic liberal locals: 3","ß Ethnic liberal locals: 4","ß Ethnic liberal locals: 5","ß Ethnic liberal locals: 10","ß Ethnic liberal locals: 15","ß Ethnic liberal locals: 20")
names(eth_loc_lib.labs) <-  c("0","1","2","3","4", "5","10","15","20")



# Intermediate randomness Migrants x-axys

 df_eth_loc  %>% filter(ID == "lc_hc") %>% filter(circle_orange == 50)  %>% filter(eth_min_lib == 0 | eth_min_lib == 5 | eth_min_lib == 10 | eth_min_lib == 20) %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic\n 50% liberal" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_loc_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5,10,15,20)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ eth_min_lib, labeller = labeller(eth_min_lib = eth_min_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   ylab("Segregation") +   
  xlab("Ethnic liberal locals") + 
#  guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant migrants: 20\nß dominant locals: 5") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 




ggsave("lc_hc5_min.jpg",last_plot(),
  device = NULL,
  path = NULL,
  scale = 2,
  width = 6,
  height = 3,
 # units = ("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)


# Intermediate randomness Locals x-axys

df_eth_loc  %>% filter(ID == "hc_lc") %>% filter(circle_orange == 50)  %>% filter(eth_min_lib == 0 | eth_min_lib == 1 | eth_min_lib == 3 |   eth_min_lib == 5) %>% gather(key = subgroup, value = Segra, eth_sqr_loc, eth_sqr_min, eth_crl_loc, eth_crl_min, val_sqr_loc,val_sqr_min,val_crl_loc, val_crl_min) %>%mutate(`segregation` = fct_relevel(fct_collapse(subgroup,"ethnic seg." = c("eth_sqr_loc","eth_sqr_min","eth_crl_loc","eth_crl_min"), "value seg." = c("val_sqr_loc","val_sqr_min","val_crl_loc", "val_crl_min")), "ethnic seg."), `group` = fct_relevel(fct_collapse(subgroup, "liberal" = c("eth_crl_loc","eth_crl_min","val_crl_loc", "val_crl_min"), "conservative" = c("eth_sqr_loc","eth_sqr_min","val_sqr_loc","val_sqr_min")), "liberal"), 
  `ethnia` = fct_relevel(fct_collapse(subgroup, "Locals:80% ethnic\n 50% liberal" = c("eth_sqr_loc","eth_crl_loc","val_sqr_loc","val_crl_loc"), "Migrants: 20% ethnic\n 50% liberal" = c("eth_sqr_min","eth_crl_min","val_sqr_min","val_crl_min")),"Locals:80% ethnic\n 50% liberal" ))  %>%
  
  ggplot( aes(x = eth_loc_lib, y = Segra, color = `segregation`, shape = `group` )) + geom_line() + geom_point(size = 3) + 
  
  scale_x_discrete(limits= c(0,1,2,3,4,5,10,15,20)) +
  
  scale_y_continuous(limits=c(0,1), breaks = c(0,0.2,0.5,0.8,1)) +
  geom_vline(xintercept = c(1,5,10,20), color = "red") +
    geom_hline(yintercept = c(0.5), color = "red", linetype = 2) +
      geom_hline(yintercept = c(0.8), color = "purple", linetype = 5) +
      geom_hline(yintercept = c(0.2), color = "purple", linetype = 2) +
  facet_grid(`ethnia` ~ eth_min_lib, labeller = labeller(eth_min_lib = eth_min_lib.labs, circle_orange = circle_orange_labs)) +
               #nrow =2 , dir = "v")  +
  
 scale_color_manual(values = c("purple","dark green"), guide = guide_legend(title= "")) + # ,nrow=2, byrow = TRUE)) +
 scale_shape_manual(values = c("circle","square"), guide = guide_legend(title= "")) + #,nrow=2, byrow = TRUE)) + 
   ylab("Segregation") +   
  xlab("ethnic liberal locals") + 
# guides(color = FALSE, shape = FALSE) +
xlab("Ethnic liberal locals") + 
# guides(color = FALSE, shape = FALSE) +
ggtitle("ß dominant locals: 20\nß dominant migrants: 5") +
  theme_bw() +  theme(legend.position = "bottom", legend.title = element_blank(), panel.grid.minor.x = element_blank(),legend.text = element_text(size = 12),
                      axis.title.y =   (element_text(size = 12)), # element_blank(),  # 
                      axis.title.x =  (element_text(size = 14)), #   element_blank(),  # 
                      axis.text.x = (element_text(size = 10)),
                      axis.text.y =  (element_text(size = 10)),
                      plot.title=element_text(face="bold", size = 14),   
                      legend.margin=margin(0,0,0,0), panel.spacing = unit(0.8, "lines"), 
                      strip.text.x = element_text(size = 15),  strip.text.y = element_text(size = 15),
                      plot.caption = element_text(hjust= 0.5, size = 12)) +
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm")) 

# 
# comb <- ggarrange(mig,loc, nrow =  2, common.legend = TRUE, legend = "bottom")
# annotate_figure(comb, 
#                # top = text_grob("Dominant ß: 5",  face = "bold", size = 12),
#                left = text_grob("Segregation", rot = 90, size = 12),
#                 bottom = text_grob("ß value conservative both group: 0", hjust = 1, x = 1, size = 12),
#                 )


ggsave("lc_hc5_maj.jpg",last_plot(),
  device = NULL,
  path = NULL,
   scale = 2,
  width = 6,
  height = 3,
 # units = c("in", "cm", "mm"),
  dpi = 300,
  limitsize = TRUE)

```
--> 









