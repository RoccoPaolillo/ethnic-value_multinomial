---
output:
  bookdown::pdf_document2:
    toc: false
 #   keep_tex: false
    fig_caption: yes
title: "Preferences interact: what consequences for a Schelling scenario?"
# subtitle: "Target: BIGSSS Research Day"
author:  Rocco Paolillo, Andreas Flache, Jan Lorenz
# date:  "`r  as.Date(Sys.time(), '%d %B %Y')`"
# "`r  as.Date(Sys.time(), '%d %B %Y')`"
language: en-GB
bibliography: "references.bib"
always_allow_html: yes
header-includes:
- \usepackage{float}
- \usepackage{multirow}
- \usepackage{xcolor} 
- \usepackage{amsmath}
- \usepackage{graphicx}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.lp="fig:",warning = FALSE)

# install.packages("tinytex", repos = "https://cloud.r-project.org" )
library(tidyverse)
library(ggplot2)
library(gridExtra)
library(tidyr)
library(plyr)
library(dplyr)




 f_spk <- function(i_e,x,n){      # utility function as single-peaked
  if (x > n){
    U <- NA}else{
    if (x < (n*i_e)){
  U <- (x / (n*i_e))
     }else if (x > (n*i_e)){
        U <- i_e + (((1- (x/n))*(1-i_e))/(1-i_e))
       }else{
    U <- 1}
       round(U,digits = 3)
     }
}

 f_thr <- function(i_e,x,n){  # to plot threshold function
  if (x >= (n*i_e)){
    U <- 1}else{
   U <- 0 }
 }
 

   

 # install.packages("tinytex", repos = "https://cloud.r-project.org" ) #, try if debug needed

 
 
```

\abstract{}


# Introduction {-}

* Schelling's model and previous work. Interaction of preferences.
Schelling's model
Literature update
@paolillo2018 Diverse dimensions can define individuals and their similarity. Results from @paolillo2018
@hedstrom2009oxford, chapter 11, 12


* Why an additional characteristic than ethnicity, literature in residential studies


* Update: justification for random utility models, literature in ABM
Better define the individual  decision process
Link with empirical data
@huang2014review
@klabunde2016decision
@bruch2019choice






* Research question
How would the interaction between $\beta$ for different dimensions affect Schelling's scenarios



# Model and Experiments

The model^[The model can be found here:https://github.com/RoccoPaolillo/BIGSSS_ResearchDay.git] was built in NetLogo 6.1.0 and extends work by @paolillo2018.
Agents interact on a regular grid 51 times 51 with periodic boundary conditions (torus world). Each node of the grid can host 1 agent or being empty. Agents represents individuals who relocate and are  defined by two static and overlapping variables: ethnicity and value orientation. Ethnicity is modeled through color tag. Agents with blue color represent the local population, agents with orange color represent the minority group. Value orientation through shape tag. 

We define value orientation as the common membership of agents sharing same beliefs, preferences etc. potentially subject to change and independent of their attributed ethnicity. As such value orientation relates to value homophily compared to ethncity related to ascribed status homophily.
Each agent hold a preference for the ethnic composition and the value composition of each neighborhood.
Neighborhoods are defined as a Moore distance.
At each step, an agent randomly selected compares its current location to a number of alternative ones, calculates utility for each and decides which location they prefer.

* Calculation utility and probability function


To explore what levels of $\beta$ should not be excluded from the manipulations, I built a specific model with a unique beta for ethnic composition ($\beta_{ie}$ ) that does not change among agents. At each run I incremented degree of $\beta_{ie} \in[0,100]$ and let run for 1000 ticks with agents asynchronously relocating (not 1 agent for 1 tick, all to complete the procedure to restart). In each condition linear function was used: the preference peak of agents was $100\%$ for ethnically similar


To explore what levels of $\beta$ should not be excluded from the manipulations, I made a specific model "rum_eth.nlogo" (in material), with a unique $\beta$ for all agents. I run the simulation for 1000 ticks (not 1 agent 1 tick):
* linear function: peak preference for all agents at $100 \%$
* density == $70 \%$
* equal distribution of value orientation in each ethnic group
* changing $beta_ie$ at each run $beta_ie \in[0,100]$

```{r one-beta, fig.cap="Comparison of ethnic segregation for one beta-ethnic, not interaction. Used one-beta.csv from simulation rum-eth.nlogo" , include=TRUE}



a <- read.csv("one-beta.csv",sep = ",",skip = 6)
names(a)[names(a) == "mean..count..turtles.on.neighbors..with..ethnicity....ethnicity..of.myself....count..turtles.on.neighbors....of.turtles.with..count..turtles.on.neighbors.....1." ] <- "eth_seg"

a %>% filter(ticks == 0  | ticks == 500  | ticks == 100 | ticks == 1000)  %>%  filter(beta.ie >= 0 & beta.ie <= 15) %>% ggplot(aes(x = beta.ie, y = eth_seg)) + geom_bar(stat="identity") + facet_wrap(~ ticks, labeller = label_both)

```


```{r att_income , include=TRUE}

f_att <- function(i,b){   # utility function as single-peaked
 A <- 1 / (1 + exp(-b(i)))
}

  b <- 0.5
  
a_0 <- f_cst(a,0)
a_1 <- f_cst(a,0.1)
a_2 <- f_cst(a,0.2)
a_3 <- f_cst(a,0.3)
a_4 <- f_cst(a,0.4)
a_5 <- f_cst(a,0.5)
a_6 <- f_cst(a,0.6)
a_7 <- f_cst(a,0.7)
a_8 <- f_cst(a,0.8)
a_9 <- f_cst(a,0.9)
a_10 <- f_cst(a,1)

Prob_A <- c(a_0,a_1,a_2,a_3,a_4,a_5,a_6,a_7,a_8,a_9,a_10)
income <- seq(0,i, by = 0.1)

plot(price,na.omit(utility),ylab = "utility_ec",xlab="price", main = paste0("income =",i))




```

















```{r income_price , include=TRUE}

# tentative of utility economic, given by the difference (income - price), so to represent how convenient a location is. 
# ideally identity equation: if income < price, probability would be 0. If beta is negative, the probability could still be computed, which is nonsense

f_cst <- function(i,p){   # utility function as single-peaked
 if (i < p){
    U <- NA}else{
  U <- ((i - p) / i)}
}

  i <- 0.5
  
i_0 <- f_cst(i,0)
i_1 <- f_cst(i,0.1)
i_2 <- f_cst(i,0.2)
i_3 <- f_cst(i,0.3)
i_4 <- f_cst(i,0.4)
i_5 <- f_cst(i,0.5)
i_6 <- f_cst(i,0.6)
i_7 <- f_cst(i,0.7)
i_8 <- f_cst(i,0.8)
i_9 <- f_cst(i,0.9)
i_10 <- f_cst(i,1)

utility <- c(i_0,i_1,i_2,i_3,i_4,i_5,i_6,i_7,i_8,i_9,i_10)
price <- seq(0,i, by = 0.1)

plot(price,na.omit(utility),ylab = "utility_ec",xlab="price", main = paste0("income =",i))




```





# Results


# References