---
output:
  bookdown::pdf_document2:
    toc: false
 #   keep_tex: false
    fig_caption: yes
title: "Tolerant  to ethnic diversity, intolerant to intolerance"
subtitle: "Title to define"
author:  Rocco Paolillo, Andreas Flache
# date:  "`r  as.Date(Sys.time(), '%d %B %Y')`"
# "`r  as.Date(Sys.time(), '%d %B %Y')`"
language: en-GB
bibliography: "references.bib"
always_allow_html: yes
header-includes:
- \usepackage{float}
- \usepackage{multirow}
- \usepackage{xcolor} 
- \usepackage{amsmath}
- \usepackage{graphicx}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.lp="fig:",warning = FALSE)

# install.packages("tinytex", repos = "https://cloud.r-project.org" )
library(tidyverse)
library(ggplot2)
library(gridExtra)
library(tidyr)
library(plyr)
library(dplyr)


# Beta distribution parameters mean and standard deviation
# https://stats.stackexchange.com/questions/12232/calculating-the-parameters-of-a-beta-distribution-using-the-mean-and-variance

 f_spk <- function(i_e,x,n){      # utility function as single-peaked
  if (x > n){
    U <- NA}else{
    if (x < (n*i_e)){
  U <- (x / (n*i_e))
     }else if (x > (n*i_e)){
        U <- i_e + (((1- (x/n))*(1-i_e))/(1-i_e))
       }else{
    U <- 1}
       round(U,digits = 3)
     }
}

 f_thr <- function(i_e,x,n){  # to plot threshold function
  if (x >= (n*i_e)){
    U <- 1}else{
   U <- 0 }
 }
 

   

 # install.packages("tinytex", repos = "https://cloud.r-project.org" ) #, try if debug needed

 
 
```

\newcommand{\rocco}[1]{\textcolor{red}{{Rocco:}#1}} 

\abstract{}

# INTRO FOCUSED ON SCHELLING, MUST BE ON HYBRID SEGREGATION

# Introduction {-}

<!-- STRESS A LINEARITY APPROACH vs SYSTEMIC APPROACH. Residential segregation can be defined as the unequal and non random distribution of people  belonging to different groups within the spatial units of a city [@bruch2009segregation;@clark2008understanding]. The interest of the social sciences on the topic is due the consequences it can have on the chance of interaction and integration between groups [@bolt2010linking], with exclusion of minorities in deprived neighborhoods and perpetuation of inequalities through generations [@van2012understanding]. A key research question in literature is on the dynamics of emergence of residential segregation. Two hystorical hypothesis are the spatial assimilation theory and the place stratification theory. According to the former, spatial distance reflects the social distance between groups, and can change as effect of social moblity (@coulter2019ethnic), while the latter focuses on the strategies of gatekeepers, e.g. sellers, to prevent undesired newcomers to neighborhood (@horr2018ethnic). Both have in common the assumption that residential  segregation is the intended result of individual behavior. A third perspective can be that of social complexity and Schelling's agent-based model of residential segregation, which addresses residential segregation as a stable property of the aggregated behavior of people who seek to satisfy even mild homophily preferences within spatial constraints [@schelling1969;@schelling1971;@schelling1978]. The paper here presented follows this stream of literature and aims at contributing to Schelling's type dynamics. \rocco{this paragraph should be more in medias res: explaining the approach of Schelling and random utility models on the question how different degrees of segregation can be reduced out of ethnic diversity}-->

* Increasing diversity in city, segregation and integration do not apply equally to stratum and places of society
    1. diversity and ethnic tolerance in cities
    2. interplay and potential factors: ses-ethnicity, relative group sizes
    3. our interest: different taste


Societies are increasingly diverse
people segregate along different dimensions

Residential segregation can be defined as the unequal and non random distribution of people  belonging to different groups within the spatial units of a city [@bruch2009segregation;@clark2008understanding]. A main dimension of interest in the social sciences and housing policies is that of ethnic segregation, considering ethnicity as a salient dimension of in-group/out-group membership and consideration of disadvanted minorities in deprived neighbrohoods. In residential move, a simple explanatory variable that is implemented also to explain ethnic concentration is that of spatial sorting or homophily preference, i.e. the preference to aggregate with people of the same ethnic group. Nevertheless, in modern and diverse societies the effect of ethnicity as the main factor in inter-ethnic relations and social integration could not be taken straightforward [@alba2014twilight] for a number of reasons. First of all, the concept of superdiversity highlights how most western cities nowadays have reached tremendous degree of ethnic diversity and the dimensions that define category of people are  numerous and overlapping. As a matter of fact, literature is much unanimous that in the last decades socio-economic segregation has increased while racial-ethnic ethnic segregation as decreased. Indeed, this would highlight the effect of income inequalities in relocation costs and relate to other mechanisms of relocation choice as neighborhood attainment. As a matter of fact, also remaning within the assumption of homophily preferences, these can vary within the same ethnic group due to different economic distribution [@andersson2007mix].

In this paper, we focus on two concepts associated with ethnic diversity in modern societies when considering relocation choice, i.e. heterogeneity and tolerance in ethnic preferences at individual and groupal level, and preferences for other dimensions that can interact with ethnicity. As a rational choice and at individual level, people can differ in their degree of preference for ethnic composition. Literature shows how preferences for ethnic composition vary within the same ethnic group according to other characteristics as socio-economic status. At a group level, acceptance of diversity is one necessary component to foster social cohesion and can be the result of social policies or embedded in culture. @weldon2006institutional countries can vary in their degree of tolerance toward minority, and policy orientation of countries toward assimilation or multiculturalism affect the degree of tolerance of citizens. As culture, some groups are more likely to blur the boundaries towards more similar cultures than others (@albeda2018symbolic).

Having less preference for ethnic composition, does  not neglect the preference for other dimensions of similarity. Here the theoretical framework of ethnic boundary making is relevant. The framework is built upon the dynamic and symbolic boundaries that distinguish between "us" and "them" [@bail2008configuration] and that are built by individuals in the interaction between groups [@wimmer2013ethnic]. The role of ethnic boundaries is therefore to define the belonging of individuals to group and orient both individual attribution of similarity and access to  resources between groups [@esser2010assimilation]. Out of this, people can define similarity with individuals despite their ethnicity and based on common characteristics mutually recognized. Taste for diversity can be an example and it would have a straight consequence on the dimension of ethnic neighborhood concentration. @blokland2010people show how people who like diversity prefer to live in neighborhoods with other people who like diversity as well, apart the common interest in utilities for  cultural consumptions (e.g. libraries). @van2019sociocultural address directly sociocultural dispositions (i.e. gender balance in household work) within spatial sorting along income and ethncity and linking different dispositions to social class indepenent of ethnicity. Their result show how sociocultural disposition might predict the willingness to live in a neighborhood. 


In both cases of ethnic preference or sociocultural dispositions, relative group sizes play a critical role in orienting relocation choice and attractiveness of neighborhoods. Within the broad framework of inter-ethnic relations, relative group sizes are critical to inter-ethnic relations and assimilation processes, since the minority group is more likely to be absorbed by majority  not reaching a critical mass [@blau1977macrosociological; @esser2010assimilation]. As regards spatial sorting, the link is immediate  since the proportion of people considered  as similar will be the direct attractor of relocation preference. Considering the overlap of categories people belong to in diverse societies, individuals can belong to both an overrepresented category (e.g. cultural disposition or middle-class), and an underrepresented  one (e.g. minority ethnic group). In both cases the correlation between categories would influence the spatial sorting of people in resulting segregation.


Assuming the critical factors of heterogeneity towards ethnic preference, interaction with other dimensions than ethnicity and relative group sizes, the questions is opened on how they contribute to explain different degree of ethnic segregation for different members of society as effect of relocation choice. The interest of this paper is to formalize such mechanisms, for which agent-based modeling and Schelling's model is justified. Differently from theories as spatial assimilation and place stratification that focus on individual strategies of movers and stake holders, the perspective of social complexity focuses on residential segregation as a complex and dynamic phenomenon that emerge from interaction between residential movers and the contextual parameters of their action. The study of similar phenomena cannot be reduced to individual preferences but requires agent-based computer simulations where such interactions can be implemented, experimented to the aim of formalizing mechanisms underlying macro phenoomena. Schelling's model is an example of this framework and a known agent-based model. Fitting the homophily hypothesis, Schelling described a scenario where people stay  in a neighborhood as long as the concentration of similar ones is not less than a desired threshold (e.g. $50 \%$), leaving to a random relocation otherwise. Given the spatial constraint to relocate, e.g. due to density of population, the interplay of people pursuing the same behavior would cause high level of segregation, even if the desired concentration of similar ones is extremely low. Schelling's model has been subject to many applications and extensions in literature. In recent years, some extensions aim at implementing random utility models of agents' behavior that better simulate the utility functions used in relocation choice. Random utility models are not new in relocation choice. Stemming from microeconomics, they reflect the utility maximization of consumers who must select between options (i.e. neighborhoods where to relocate). Being utility a random variable unknown to researchers, this can be derived by the observed characteristics of options people selected from, using these as predictor to the probability to select one neighborhood in addition to randomness in the choice. Out of regression models that allow such calculations, @mcfadden1973conditional's conditional logit has received ample attention in residential studies, since it allows to estimate through coefficients of regression (parameter $\beta$) indicating how important one dimension of utility was to relocation choice compared to random term and correlate these to demographic characteristics of the population.


A critical example is by Elizabeth E. Bruch and Robert D. Mare @bruch2006neighborhood @bruch2009preferences \rocco{to trace back the paper history} who implemented  @mcfadden1973conditional's conditional logit within Schelling's dynamic and substitute threshold function with utility linear function, meaning agents become sensitive to fine-grained change in neighborhood ethnic composition. Following this trend, other studies have extended Schelling to fit ethnically diverse scenarios as stressed above. @xie2012modeling uses random utility models and threshold function, but introduce heterogeneity at individual level of agents to reproduce whites heterogeneity for ethnic composition in U.S. survey. Their result show how increasing heterogeneity can reduce ethnic concentration compared to @bruch2009preferences. Although not with random utility models, @hatna2014combining reproduce heterogeneity of thresholds not at individual level, but within groups, presenting more tolerant agents in each ethnic group, with tolerant agents holding the same theshold, so to formalize how this combination can lead to hybrid combination of integration and segregation. @paolillo2018 were the first to the best of our knowledge to adapt Schelling's homophily preferences to ethnic composition and value composition. In their adaptation, agents of both ethnic groups were divided into ethnicity-oriented agents, who considered as similar agents of their ethnicity, regardless their values, and value-oriented agents who considered similar those agents sharing similar values regardless of their ethncity. The authors explored how the inclusion of value-oriented agents reduced ethnic segregation compared to Schelling, and under which threshold both agents would be satisfied with their neighborhoods, including role of relative group sizes. The main discover was a spillover effect so that ethnicity-oriented in minority condition would find attractive ethnically mixed neighborhood formed by value-oriented agents, because of availability of ethnically similar ones, until the point their concentration caused value-oriented to leave. 


In this paper, we want to extend @paolillo2018 differentiation between value-oriented and ethnically-oriented agents to explain different integration degree for members of the same group, adapting it to random utility models as proposed by @bruch2006neighborhood. Following @bruch2009preferences, random utility models in observed preferences and agent-based models have a critical difference. While utility functions and parameters beta can be estimated by observed characteristics of the options, they remain ultimately unknown, whereas in the agent-based modeling framework these components are expressly built within the cognitive process of simulated agents. We want to take advantage of this for what concerns the role of $\beta$ parameters for value orientation and ethnic membership in agents' relocation, and keeping the linear function for concentration of similar ones. We believe this strategy  opens up more distinguished scenarios than in @xie2012modeling and  @hatna2014combining where only the threshold preference changes, but weight in the relocation choice relies only on the ethnic composition. By varying $\beta$ indicators of agents for both ethnicity and value dimension, we expect to better observe the interdependence of the two dimensions. To this aim, we explore the heterogeneity for ethnic and value preferences at individual level (with agents holding higher beta thant the other) and between groups (with one group showing more ethnic tolerance that the other). In addition, the role of relative group sizes for both dimensions.



```{r model, fig.pos ='h!',out.width='50%',out.height='90%',fig.show='hold',fig.align='center', fig.cap= "Draft of agents attribution and emerging segregations, to revise.",  echo = FALSE, include=TRUE}
knitr::include_graphics("C:/Users/rocpa/OneDrive/Desktop/AF/ethnic-value_multinomial/material/model_pr.jpg")
```

# Model

The model^[The model can be found here:https://github.com/RoccoPaolillo/BIGSSS_ResearchDay.git] was built in NetLogo 6.1.0 and extends work by @paolillo2018.
Agents interact on a regular grid 51 times 51 with periodic boundary conditions (torus world). Each node of the grid can host 1 agent or being empty. Agents represents individuals who relocate and are  defined by two static and overlapping variables: ethnicity and value orientation. Ethnicity is modeled through color tag. Agents with blue color represent the local population, agents with orange color represent the minority group. Value orientation through shape tag. 

We define value orientation as the common membership of agents sharing same beliefs, preferences etc. potentially subject to change and independent of their attributed ethnicity. As such value orientation relates to value homophily compared to ethncity related to ascribed status homophily.
Each agent hold a preference for the ethnic composition and the value composition of each neighborhood.
Neighborhoods are defined as a Moore distance.
At each step, an agent randomly selected compares its current location to a number of alternative ones, calculates utility for each and decides which location they prefer.

$\beta^\Box_e \geq \beta^\circ_e$

# Experiments

Study 1: heterogeneity of ethnic preferences in agents \par
* 1.1 Tune $\beta_e$ for all agents, with condition $\beta^\Box_e \geq \beta^\circ_e$, no difference between agents
* 1.2 Change  $\beta_e$ between groups (supported by literature on which group is going to be more conservative, or anyway argumented).
Observe the emergence of ethnic segregation first
* Same conditions, increase $\beta_v$ Either with first 1.1 and then compar, either compare first the effect of ethnic preference heterogeneity between groups over within group
In both cases, the effect of relative group sizes

\vspace{10pt}

@hatna2015combining: in previous studies, they had a "F critical", maybe we could use on the critical $\beta$?

\vspace{10pt}



The concept of heterogeneity is reflected into the experiments: \par
* individual: $\beta^\Box_e \geq \beta^\Box_v$, $\beta^\circ_v \geq \beta^\circ_e$  \par
* within ethnic group:  $\beta^\Box_e \geq \beta^\circ_e$, $\beta^\circ_v \geq \beta^\Box_v$, should specify the ethnic group  \par
NO * between ethnic group: $\beta^{\Box B}_e \geq \beta^{\Box R}_e$ (and implying $\beta^{\Box B}_e \geq \beta^{\circ R}_e$  ) NO \par

These are the conditions kept in the experiments, ranging $\beta \in{0,10}$  \par

Think about it.

If a society is "conservative", the less ethnic-oriented of that society/scenario would have high level as well. In the end, you could narrow down so to have 3 conditions for each low, medium, high beta (e.g. 1, 5, 10), and calculate the $\beta_e$ of less ethnicity-oriented agents out of a ratio, e.g. min $n/n$,  $n/(n:2)$ (check), max $n/1$ \par
* 1 = 1,0.5,1 (check)
* 5 = 1,2.5,5
* 10 = 1,5,10

Dependent measure:

* ethnic segregation exposure as Schelling (color)
* value segregation exposure as Schelling (shape)
* C index in @hatna2012schelling, to check

**beta-binomial distribution? Discrete values deriving from beta distribution but not limit [0,1] @hatna2015combining** 

# Results

# Conclusions/ further ideas

@van2019sociocultural introduction: social homophily as due to preferences and constraints' approach. They also use social class as proxy for  socio-cultural differentiation


# References
