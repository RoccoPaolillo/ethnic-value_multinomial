---
title: "Tolerant  to ethnic diversity, intolerant to intolerance"
subtitle: "Title to define"
author:  "Rocco Paolillo, Andreas Flache"
date:  "`r  as.Date(Sys.time(), '%d %B %Y')`"
output:
  word_document:
   # keep_tex: true

# "`r  as.Date(Sys.time(), '%d %B %Y')`"
#language: en-GB
bibliography: "references.bib"
# always_allow_html: yes
#fig_caption: yes
header-includes:
- \usepackage{float}
- \usepackage{multirow}
- \usepackage{xcolor} 
- \usepackage{amsmath}
- \usepackage{graphicx}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.lp="fig:",warning = FALSE)

install.packages("tinytex", repos = "https://cloud.r-project.org" )
library(tidyverse)
library(ggplot2)
library(gridExtra)
library(tidyr)
library(plyr)
library(dplyr)


# Beta distribution parameters mean and standard deviation
# https://stats.stackexchange.com/questions/12232/calculating-the-parameters-of-a-beta-distribution-using-the-mean-and-variance

 f_spk <- function(i_e,x,n){      # utility function as single-peaked
  if (x > n){
    U <- NA}else{
    if (x < (n*i_e)){
  U <- (x / (n*i_e))
     }else if (x > (n*i_e)){
        U <- i_e + (((1- (x/n))*(1-i_e))/(1-i_e))
       }else{
    U <- 1}
       round(U,digits = 3)
     }
}

 f_thr <- function(i_e,x,n){  # to plot threshold function
  if (x >= (n*i_e)){
    U <- 1}else{
   U <- 0 }
 }
 

 nrml <- function(mx,mn,x,s){
  
  s <- ((x - mn) / (mx-mn))
}

 bt_10 <- for (x in seq(5,10,by=1)) {
  
  mx <- 10
  mn <- 5
  
  s <- nrml(mx,mn,x,s)
  print(c(x,s))
  
}

 bt_5 <- for (x in seq(0,5,by=1)) {
  
  mx <- 5
  mn <- 0
  
  s <- nrml(mx,mn,x,s)
  print(c(x,s))
  
}
 
   

 # install.packages("tinytex", repos = "https://cloud.r-project.org" ) #, try if debug needed

 
 
```

\newcommand{\rocco}[1]{\textcolor{red}{{Rocco:}#1}} 
<!-- Read Laurie & Jaggi, 2003 -->

\abstract{}

# Introduction {-}

<!-- X segregation is complex process, traditionally Schelling etc has been used to understand the complex micro-macro interaction involved-->
<!-- X however, Schelling typically assume that people only care for ethnic composition -->
Residential segregation can be defined as the unequal and non random distribution of people  belonging to different groups within the spatial units of a city [@bruch2009segregation;@clark2008understanding]. Researhers are interested in the dynamics of this complex process and several theories have been elaborated. 
\rocco{maybe here to supersynthetize and explain in detail in theory/modeling section} In a couple of influential papers, @schelling1969models [-@schelling1971dynamic] proposed an alternative explanation to racial discrimination as cause of residential segregation. His intention was to demonstrate how segregation can be an emergent property of the "interplay of individual choices" [@schelling1969models, p. 488] of people within the spatial constraints of a city. He proposed a model of individual behavior and preferences for neighborhood composition based on a threshold behavior: people would stay in a neighborhood as long as the ratio of the members of the other group to the members of the own group does not exceed a desired threshold. For instance, a threshold $\theta =0.50$ would mean that the in-group should not be in a condition of minority, a threshold of $\theta = 0.40$ would mean people would be happy until the minority does not exceed the $40 \%$ of neighborhood composition. Individual relocations of people trying to satisfy such preferences within the spatial constraints of a city would generate stable spatial combination that define residential segregation. The complexity of Schelling model is that this simple behavior can generate high level of segregation even for mild preferences for similar ones. Schelling so proposed a model of unorganized segregation [@haw2018dynamical], meaning that residential segregation would self-organize from the interplay of individual moves of citizens, and as a matter of fact, one of the first agent-based models [@epstein1996growing]. One condition that Schelling imposed to his reasoning was that similarity was defined as a "twofold, exhaustive and recognizable distinction" [@schelling1969models, p. 488]. Although not in his original intentions, this specification has caused many to interpret only ethnic segregation as dimension relevant to neighborhood preferences and spatial dynamics. Nevertheless, the model found wide application in understanding the complexity of residential segregation, not only in the field of complex systems, but also in empirical studies of spatial sorting [@magi2016types;@muller2018residential]. In detail, the focus on ethnic membership let Schelling model found an easy application to the hypothesis of homophily behavior, i.e. the tendency to aggregate and show a preference for those considered as similar, in this case based on the shared ascribed status of ethnic membership [@mcpherson2001birds]. However, only considering the dimension of ethnic similarity in Schelling dynamics might hinder its application to modern and diverse societies and contribution. Current trends in integration literature stress out how ethnicity is experiencing a constant decline [@alba2014twilight] as only dimension able to explain the integration processes and social composition of Western societies. As for residential segregation, there is quite unanimous agreement that despite ethnic segregation persists, it is generally decreased compared to levels in the 1970's in Europe and U.S. compared to otherd dimensions such as socio-economic segregation [@clark2015residential]. Members of the same ethnic group differing for other socio-demographic characteristics can experience different degree of segregation not only along ethnicity, and due to increased heteorogeneity of preferences and different access to resources [@clark2002residential]. In this paper we refer to this as "hybrid segregation" and we want to extend Schelling model to explain such a scenario.
 \vspace{10pt}
Literature provides different inputs to the causes of hybrid scenarios of segregation for members of the same ethnic group in modern and diverse societies. First of all, a common trait of Western societies is that of super-diversity. Originally formulated by @vertovec2007super in the UK context, the term now describes the complexity of most of Western receiving countries as effect of second and further generations of migrants, as well as ease of new migration flows from different parts of the world. As a consequence, much more than two ethnic groups will cohabit and influence the chances to segregate, along with change in the population due to new generations. A commonn trait of modern societies as  effect of mixed marriage is the rise of mixed households @ellis2012agents, plus the occurrence that the size of migrant population through generations equal the local populatin. The result is that the receiving context of new generations of migrants will not be a homogeneous ethnic majority, but an "amalgam" of ehtnic groups, in addition to different cohorts and social classes [@crul2016super, p.57]. Second, new generations can differ from previous ones in terms of residential preferences and resources to relocate. Although inequalities can depend on the degree of integration of parents, e.g. neighborhood where children live and capital to their social mobility [@Esser2010assimilation], societies who have long experienced migration became more resilient in adopting strategies to guarantee equal education [@crul2016super]. The result is that new generations are likely to reach higher level of educational attainment and professional success than their parents [@crul2017upcoming], so to have higher resources to relocate to more affluent neighborhoods and possibly different tastes. The consequence is that more evident differences in integration can occurr between cohorts of the same ethnic group rather than between ethnic groups, and in any case related to unequal access to resources to relocate [@crul2016super]. The differences in income can explain the different degree of integration for members of the same group: while well-off generations move to more affluent and more integrated neighborhoods, low-income members of the same ethnic group experience hyper-segregation in deprived neighborhoods @clark2002residential. Finally, the concept of super-diversity stresses out how people in diverse societies can differ and find similarities along many dimensions that add to ethnic membership, such as social class, cultural practices etc. In this multitude of definitions of the self and groups, people are more likely to use individual characteristics to navigate diversity and define similarity and inclusion, rather than a rigid division in ethnic categorizations [@crul2016super]. Ethnic boundaries become fluid and socially constructed, so that other criteria than ethnicity can mark the limit of in-group and out-group inclusion [@albeda2018symbolic]. Shared values, defined as common beliefs, preferences or expectations on acceptable behavior can become one of this criteria for the definition of acceptance and inclusion across the boundaries of ethnic membership [@wimmer2013ethnic]. This last point becomes critical to define how spatial sorting based on homophily behavior would work in diverse societies to explain scenarios of hybrid segregation. A growing number of studies confirm that people consider different dimensions of neighborhood composition, such as ethnic similarity and shared values, though each dimension can matter differently depending on individual characteristics. For instance, @van2019sociocultural use similarity for sociocultural dispositions (i.e. gender balance in household tenure) as predictor to leave the neighborhood, compared to ethnic membership and income similarity, with socio-cultural dispositions resulting the most influential. @blokland2010people, using survey methodology in The Netherlands, show how people who are attracted  by diversity in neighborhood selection tend to live close to other people who like diversity as well. @clark2018can estimate with census-track the preferences of mixed-race young generation in Los Angeles, who prefer ethnically integrated and well-off neighborhood.

 \vspace{10pt}
In sum, there is evidence that homophily behavior in spatial sorting in modern and diverse societies spans along different dimensions. Among these, the interplay of value similarity and ethnic similarity can intuitevely be useful in describing hybrid segregation of members of the same group. Although such complexity is addressed in empirical studies of segregation, it has been rarely considered in complexity models of segregation stemming from Schelling. We want to add to this line of research by proposing a model where agents assess neighborhood composition both for value and ethnic similarity in their relocation choice, and focusing on heterogeneous preferences for the two dimensions to explain hybrid segregation. To this aim, we collect from recent models that have  implemented discrete choice in Schelling dynamics along with heterogeneous preferences. \rocco{should the next part going into theory/modeling section?} Studies as  @bruch2009preferences  have tested the consequences of implementing not random relocation, but a discrete choice, implementing a different utility function than threshold. @xie2012modeling extended the updated model by @bruch2009preferences for discrete choice to reflect the heterogeneity in whites' tolerance towards blacks in U.S., both as categorical classes with different threshold preferences each, and continuous heterogenous preferences. In both cases heterogeneity between agents, and a class of agent indifferent to ethnic composition resulted in less segregated scenarios due to mutual adaptation of agents. Similarly, @haw2020dynamical conclude that integration can  be reached by structural conditions of small minority and large tolerant majority, and letting tolerance in each neighborhood increase linearly as function of the proportion of other race under the desired threshold. Though not with discrete choice models,  @hatna2014combining focused on heterogenous preferences between groups, using an increasing linear function until the desired proportion, and dividing each ethnic group in two subgroups of agents more tolerant and less tolerant due to difference in ethnic threshold. The results showed mixed patterns of integration and segregation rather than a dycothomous scenario. @paolillo2018 address specifically the interaction of different homophily preferences in Schelling. Keeping threshold behavior as in the original model, they split the population into intolerant ethnic-oriented agents, defining similarity based on shared ethnicity, and tolerant value-oriented agents defining similarity on shared values for tolerance towards diversity, and explored  their adaptation in different conditions of relative group sizes.  The intention of the authors was to introduce value similarity as a cross-ethnic category, investingating under what conditions this would have fostered or hindered ethnic spatial sorting. The introduction of value-oriented agents decreased ethnic segregation compared to the original model. The main discover was a spillover effect for ethnicity-oriented agents in the minority condition who found attractive ethnically mixed neighborhoods formed by value-oriented agents, because of availability of ethnically similar ones, until the point that their concentration caused value-oriented to leave.

In the next section, we extend the intuition of @paolillo2018 for different homophily dimensions to heterogeneous preferences as @xie2012modeling and @hatna2014combining within the framework of discrete choice, which allows us to calibrate the weight of value or ethnic similarity in the relocation choice for different types of agents.


# Theory: Modeling Discrete Choice in Schelling Framework

Schelling described preferences for neighborhood composition and tolerance to the presence of outgroups as a threshold behavior representing the desired ratio between similar ones and not. For instance, a threshold $\theta =0.50$ would mean that the in-group should not be in a condition of minority, a threshold of $\theta = 0.40$ would mean people would be happy until the minority does not exceed the $40 \%$ of neighborhood composition. The space below such threshold $\theta$ constitutes the tolerance schedule of how many members of the other group would be tolerated until a person would randomly relocate to another neighborhood. Given the spatial constraints of  a city, only a few conditions might satisfy  most of the population, which become points of convergence [@schelling1971dynamic;@haw2020dynamical] and lead to stable equilibria in residential segregation. The key point of Schelling complexity is that even mild preferences expressed by low threshold would bring to high levels of residential segregation. Schelling proved his mathematical models through  graphical models of spatial proximity on a one-dimension linear distribution of agents [@schelling1971dynamic, p. 149], referred to as "dots and stars model" and on a bi-dimensional area distribution  [@schelling1971dynamic, p. 154] which is commonly know as "bounded neighborhood model" [@hatna2012schelling,@haw2018dynamical], which has become the common and most studied version of Schelling model in lattice models.
\par
From here, extensions to discrete choice and random utility models. Describing regression model and mathematical formulations of what we need to model: \par
\par
- utility function\par
- heterogeneity\par
- different preferences\par
- relative group size -> probability of interaction\par

A brief description of model to summarize\par
Selection of cases to show interesting results of mixed segregation 


Here discrete choice, to formulate more mathematically and use their explanation to describe the model \par

We want to contribute to those studies focusing on random utility models for discrete choice in Schelling's dynamics and ethnically diverse scenarios. Simply stated, discrete choice models allow to deduce prerefernces in utility by observing the difference between neighoborhood chosen and alternative ones  [@train2009discrete;@frankhauser2016deciding]. Among regression models for the execution of random utility models, @mcfadden1973conditional's conditional logit allow to estimate the parameters of utility for different characteristics of neighborhoods ($\beta$ parameters) and sort them according to socio-demographic characteristics of movers [@boschman2015neighbourhood]. @zhang2004 was among the first to implement the conditional logit within Schelling's dynamics, although @bruch2006neighborhood moved forward by matching discrete choice of agents with parameters calculated from empirical data, along with a continuous linear function instead of Schelling's threshold. Despite pitfalls in the code implementation of their model [@van2009neighborhood] and consequent corrections [@bruch2009preferences], extensions resulted in agents being more sensitive to fine-grained change in neighborhood ethnic composition. Adopting a similar discrete choice method would benefit the chance of the model to disentangle the relative effect of different preferences.

Since we are focusing on a spatial sorting mechanism, relative group sizes remains a critical factor. @blau1977macrosociological defines relative group sizes as the structural conditions that can influence inter-ethnic relations, not matter what socio-psychological drivers guide such interactions. Minority groups are per definition more at risk of incorporation from the majority [@Esser2010assimilation]. Considering the overlap category between ethnicity and taste for ethnic diversity, the concept of relative group size becomes much complex. For instance, a person might belong to the ethnic minority group, but to the majority of tolerant people in the broad society. Different distributions of people along the categories of ethnic membership and preferences for diversity/homogeneity is noteworthy.


```{r model, fig.pos ='h!',out.width='50%',out.height='90%',fig.show='hold',fig.align='center', fig.cap= "Prototype of the model",  echo = FALSE, include=TRUE}
knitr::include_graphics("C:/Users/rocpa/OneDrive/Desktop/AF/ethnic-value_multinomial-master/material/model_pr.jpg")
```


# Model
\rocco{probably to include into modeling above}

The model^[The model can be found here:https://github.com/RoccoPaolillo/ethnic-value_multinomial.git] was built in NetLogo 6.1.0 and extends work by @paolillo2018.
Agents interact on a regular grid 51 times 51 with periodic boundary conditions (torus world). Each node of the grid can host 1 agent or being empty. Agents represents individuals who relocate and are  defined by two static and overlapping variables: ethnicity and value orientation. Ethnicity is modeled through color tag. Agents with blue color represent the local population, agents with orange color represent the minority group. Value orientation through shape tag. 

We define value orientation as the common membership of agents sharing same beliefs, preferences etc. potentially subject to change and independent of their attributed ethnicity. As such value orientation relates to value homophily compared to ethncity related to ascribed status homophily.
Each agent hold a preference for the ethnic similarity and the value similarity of each neighborhood.
Neighborhoods are defined as a Moore distance.
At each step, an agent randomly selected compares its current location to a number of alternative ones, calculates utility for each and decides which location they prefer.

$\beta^\Box_e \geq \beta^\circ_e$

# Case studies

```{r test-utility,  echo = FALSE, include=TRUE}


 f_spk <- function(i_e,x,n){      # utility function as single-peaked
  if (x > n){
    U <- NA}else{
    if (x < (n*i_e)){
  U <- (x / (n*i_e))
     }else if (x > (n*i_e)){
        U <- i_e + (((1- (x/n))*(1-i_e))/(1-i_e))
       }else{
    U <- 1}
       round(U,digits = 3)
     }
}


for (y in seq(0,8,by=1)) {
  i_e = 0.9
 p <- f_spk(i_e,y,8)
  print(c(y,p))
}








```


- heterogeneous ethnic preferences, value preferences and relative group sizes \par

IDEA: Since generations have been introduced, what about including scenarios for each generations, manipulating relative group sizes and preferences between generations?\par



# Results

# Conclusions/ further ideas


# References
