---
output:
  bookdown::pdf_document2:
    toc: false
 #   keep_tex: false
    fig_caption: yes
title: "Tolerant  to ethnic diversity, intolerant to intolerance"
subtitle: "Title to define"
author:  Rocco Paolillo, Andreas Flache
# date:  "`r  as.Date(Sys.time(), '%d %B %Y')`"
# "`r  as.Date(Sys.time(), '%d %B %Y')`"
language: en-GB
bibliography: "references.bib"
always_allow_html: yes
header-includes:
- \usepackage{float}
- \usepackage{multirow}
- \usepackage{xcolor} 
- \usepackage{amsmath}
- \usepackage{graphicx}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.lp="fig:",warning = FALSE)

# install.packages("tinytex", repos = "https://cloud.r-project.org" )
library(tidyverse)
library(ggplot2)
library(gridExtra)
library(tidyr)
library(plyr)
library(dplyr)


# Beta distribution parameters mean and standard deviation
# https://stats.stackexchange.com/questions/12232/calculating-the-parameters-of-a-beta-distribution-using-the-mean-and-variance

 f_spk <- function(i_e,x,n){      # utility function as single-peaked
  if (x > n){
    U <- NA}else{
    if (x < (n*i_e)){
  U <- (x / (n*i_e))
     }else if (x > (n*i_e)){
        U <- i_e + (((1- (x/n))*(1-i_e))/(1-i_e))
       }else{
    U <- 1}
       round(U,digits = 3)
     }
}

 f_thr <- function(i_e,x,n){  # to plot threshold function
  if (x >= (n*i_e)){
    U <- 1}else{
   U <- 0 }
 }
 

   

 # install.packages("tinytex", repos = "https://cloud.r-project.org" ) #, try if debug needed

 
 
```

\abstract{}

# INTRO FOCUSED ON SCHELLING, MUST BE ON HYBRID SEGREGATION

# Introduction {-}

STRESS A LINEARITY APPROACH vs SYSTEMIC APPROACH. Residential segregation can be defined as the unequal and non random distribution of people  belonging to different groups within the spatial units of a city [@bruch2009segregation;@clark2008understanding]. The interest of the social sciences on the topic is due the consequences it can have on the chance of interaction and integration between groups [@bolt2010linking], with exclusion of minorities in deprived neighborhoods and perpetuation of inequalities through generations [@van2012understanding]. A key research question in literature is on the dynamics of emergence of residential segregation. Two hystorical hypothesis are the spatial assimilation theory and the place stratification theory. According to the former, spatial distance reflects the social distance between groups, and can change as effect of social moblity (@coulter2019ethnic), while the latter focuses on the strategies of gatekeepers, e.g. sellers, to prevent undesired newcomers to neighborhood (@horr2018ethnic). Both have in common the assumption that residential  segregation is the intended result of individual behavior. A third perspective can be that of social complexity and Schelling's agent-based model of residential segregation, which addresses residential segregation as a stable property of the aggregated behavior of people who seek to satisfy even mild homophily preferences within spatial constraints [@schelling1969;@schelling1971;@schelling1978]. The paper here presented follows this stream of literature and aims at contributing to Schelling's type dynamics. \par

Diversity in cities: how to navigate the difference: Heterogeneity in ethnic preferences and competing preferences

Lead Question (ex):
* how can we explain hybrid ethnic segregation patterns? (The Economist)
* hybrid segregation on value and ethnic for different types of people

Assumption: 
* people differ in their degree of ethnic preferences (lit. @xie2012modeling, @hatna2015combining)
* peole have different preferences and sort out of different factors [@bruch2009segregation]

@xie2012modeling: use different threshold size according to class from Guttman, the 6th class not conforming to Guttman linear function and rum. Their concept of heterogeneity is on the different threshold levels (within 5 classes, with the 5th being tolerant to $57 \%$ to $100 \%$) black, so indifferent), with the consequence to decrease segregation. This trend holds also when continuous preferences are included, meaning cumulative threshold between agents. We would modify $\beta$, decomposing a random utility model, assuming the desired concentration peak 1 and varying $\beta$ \par

In  the definition of competing preferences, stress that the value-orientation across ethnicity is defiant to Schelling's dichotomous definition of similarity (see @clark1991residential for a critical view)



@clark1991residential old: for historical excursus
@chen2005emergence: good perspective to position with value similarity (not in their paper). Update literature, consider heterogeneity within the same race

Define need of value similarity 


Role of relative group size for both the ethnic and the value dimension

```{r model, fig.pos ='h!',out.width='50%',out.height='90%',fig.show='hold',fig.align='center', fig.cap= "Draft of agents attribution and emerging segregations, to revise.",  echo = FALSE, include=TRUE}
knitr::include_graphics("C:/Users/rocpa/OneDrive/Desktop/AF/ethnic-value_multinomial/material/model_pr.jpg")
```

# Model

The model^[The model can be found here:https://github.com/RoccoPaolillo/BIGSSS_ResearchDay.git] was built in NetLogo 6.1.0 and extends work by @paolillo2018.
Agents interact on a regular grid 51 times 51 with periodic boundary conditions (torus world). Each node of the grid can host 1 agent or being empty. Agents represents individuals who relocate and are  defined by two static and overlapping variables: ethnicity and value orientation. Ethnicity is modeled through color tag. Agents with blue color represent the local population, agents with orange color represent the minority group. Value orientation through shape tag. 

We define value orientation as the common membership of agents sharing same beliefs, preferences etc. potentially subject to change and independent of their attributed ethnicity. As such value orientation relates to value homophily compared to ethncity related to ascribed status homophily.
Each agent hold a preference for the ethnic composition and the value composition of each neighborhood.
Neighborhoods are defined as a Moore distance.
At each step, an agent randomly selected compares its current location to a number of alternative ones, calculates utility for each and decides which location they prefer.

$\beta^\Box_e \geq \beta^\circ_e$

# Experiments

Study 1: heterogeneity of ethnic preferences in agents \par
* Tune $\beta_e$ for all agents, with condition $\beta^\Box_e \geq \beta^\circ_e$
* Same conditions, increase $\beta_v$

The concept of heterogeneity is reflected into the experiments: \par
* individual: $\beta^\Box_e \geq \beta^\Box_v$, $\beta^\circ_v \geq \beta^\circ_e$  \par
* within ethnic group:  $\beta^\Box_e \geq \beta^\circ_e$, $\beta^\circ_v \geq \beta^\Box_v$, should specify the ethnic group  \par
NO * between ethnic group: $\beta^{\Box B}_e \geq \beta^{\Box R}_e$ (and implying $\beta^{\Box B}_e \geq \beta^{\circ R}_e$  ) NO \par

These are the conditions kept in the experiments, ranging $\beta \in{0,10}$  \par

Think about it.



# Results


# References
