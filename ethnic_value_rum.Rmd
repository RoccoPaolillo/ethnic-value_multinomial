---
title: "Tolerant  to ethnic diversity, intolerant to intolerance"
subtitle: "Title to define"
author:  "Rocco Paolillo, Andreas Flache"
date:  "`r  as.Date(Sys.time(), '%d %B %Y')`"
# "`r  as.Date(Sys.time(), '%d %B %Y')`"
language: en-GB
bibliography: "references.bib"
always_allow_html: yes
output: pdf_document
    # toc: false
 #   keep_tex: false
#fig_caption: yes
header-includes:
- \usepackage{float}
- \usepackage{multirow}
- \usepackage{xcolor} 
- \usepackage{amsmath}
- \usepackage{graphicx}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.lp="fig:",warning = FALSE)

install.packages("tinytex", repos = "https://cloud.r-project.org" )
library(tidyverse)
library(ggplot2)
library(gridExtra)
library(tidyr)
library(plyr)
library(dplyr)


# Beta distribution parameters mean and standard deviation
# https://stats.stackexchange.com/questions/12232/calculating-the-parameters-of-a-beta-distribution-using-the-mean-and-variance

 f_spk <- function(i_e,x,n){      # utility function as single-peaked
  if (x > n){
    U <- NA}else{
    if (x < (n*i_e)){
  U <- (x / (n*i_e))
     }else if (x > (n*i_e)){
        U <- i_e + (((1- (x/n))*(1-i_e))/(1-i_e))
       }else{
    U <- 1}
       round(U,digits = 3)
     }
}

 f_thr <- function(i_e,x,n){  # to plot threshold function
  if (x >= (n*i_e)){
    U <- 1}else{
   U <- 0 }
 }
 

   

 # install.packages("tinytex", repos = "https://cloud.r-project.org" ) #, try if debug needed

 
 
```

\newcommand{\rocco}[1]{\textcolor{red}{{Rocco:}#1}} 

\abstract{}

# NOTES FOR March 5, to shuffle focusing on Schelling and from ethnicity to value/cosmopolitan

* TO READ: D. J. Haw & S. J. Hogan (2020) A dynamical systems model of unorganized segregation in two neighborhoods, The Journal of Mathematical Sociology, DOI: 10.1080/0022250X.2019.1695608

* We aim at Journal of Mathematical Sociology:
- models and mathematical techniques useful to professional sociologist, connection between disciplines
- emergent complex social structures
- editor -> single-blind peer reviews
- 200 words abstract, 3-5 keywords
- color figures and format OK, fee if color on printed
- DOI dataset, e.g. Zenodo

Read Laurie & Jaggi, 2003

<!-- instructors: https://authorservices.taylorandfrancis.com/tf_quick_guide/ -->

# Introduction {-}


Residential segregation can be defined as the unequal and non random distribution of people  belonging to different groups within the spatial units of a city [@bruch2009segregation;@clark2008understanding]. It is a critical topic due to the consequences on interaction between groups [@bolt2010linking] and perpetuation of inequalities for people living in deprived neighborhoods [@van2012understanding].
<!-- X segregation is complex process, traditionally Schelling etc has been used to understand the complex micro-macro interaction involved-->
@haw2018dynamical: difference between organized segregation and self-organized segregation as Schelling.
@schelling1971dynamic: different threshold level (on x-axys fig. 8),not together,i.e. not heterogeneity, but never a function different than threshold and similarity twofold and binary. Many have focused on the different function, using a linear one, other on heterogeneity, we would blend this together.
On the other side, linear function fully satisfy discrete choic methods that are central in segregation studies.


Segregation is a complex process and researchers have long been interested in understanding the dynamics of segregation patterns. Two hystorical hypothesis are the spatial assimilation theory and the place stratification theory. According to the former, spatial distance reflects the social distance between groups, and can change as effect of social moblity (@coulter2019ethnic), while the latter focuses on the strategies of gatekeepers, e.g. sellers, to prevent undesired newcomers to neighborhood (@horr2018ethnic). Both have in common the assumption that residential  segregation is the intended result of individual behavior. A third perspective can be that of social complexity and Schelling's agent-based model of residential segregation, which addresses residential segregation as a stable property of the aggregated behavior of people who seek to satisfy even mild homophily preferences within spatial constraints [@schelling1969;@schelling1971;@schelling1978]. The paper here presented follows this stream of literature and aims at contributing to Schelling's type dynamics. Although not in its original intention, ethnic composition has been widely considered as main dimension of segregation, both as indicator of in-group/out-group relations and for its correlation with deprived neighborhoods [@VanHam2012]. A simple but long-standing mechanism used in literature to explain ethnic concentration is that of spatial sorting or homophily preferences [@magi2016types;@muller2018residential], i.e. the tendency to aggregate with people of the same ethnic group [@mcpherson2001birds] . 

<!-- X however, Schelling typically assume that people only care for ethnic composition -->

Nevertheless, in modern societies members of the same ethnic group can positionate differently on the continuum between integration and segregation, due to many reasons, and ethnicity per se can be only one of the many dimensions people segregate along.

<!--  In recent decades western societies have come increasingly ethnically diverse and especially second+ generation migrants have assimilated in some ways but still remain different.-->

[@alba2014twilight]. First of all, a growing concept in literature is that of superdiversity that characterizes western societies [@crul2016super], as effect of social mobility, inner-neighborhoods migration flows and multicultural households [@neal2013multiculture; @albeda2018symbolic]. 

Considering the context of multi-ethnic societies, difference between social groups are relevant. Some groups might be innerly more tolerant towards minorities, with consequences on inter-ethnic contacts [@bourhis1997towards] or they  might be likely to blur the boundaries towards specific groups as effect of their cultural similarities [@albeda2018symbolic]. On the other side, tolerance towards ehtnic minorities  of citizens can result from the multicultural or assimilationist policies adopted by different governments [@weldon2006institutional].

Indeed, literature is most unanimous that in the last decades socio-economic segregation has increased at faster rates than racial-ethnic segregation which is generally decreased [@clark2002residential;@clark2015residential].


<!-- X Similarly some parts of the population have become more modern / cosmopolitation. -->

Finally, people within the same ethnic group or social class can vary in their preferences, and differences in affordability give rise to more variegated scenarios  [@andersson2007mix]. In sum, in super-diverse societies ethnic segregation has become a hybrid and complex phenomenon, where ethnicity correlates with other dimensions and people of the same ethnic membership can experience different degree of segregation/integration.


<!-- X There is evidence that people consider both types of similarity when assessing composition of prospective neighborhoods they want to live in, but also that people differ in the extent to which ethnic or value similarity matters to them.  -->

[@van2019sociocultural]
Following this perspective, a taste for ethnic and cultural diversity can serve both to blur  ethnic boundaries and to define similarity with other people despite their ethnic membership. @blokland2010people show how people who like diversity tend to live in ethnically integrated neighborhoods with other people who like diversity as well. @van2019sociocultural use similarity for sociocultural dispositions (i.e. gender balance in household tenure) as predictor to leave the neighborhood, compared to ethnic membership and income similarity, with socio-cultural dispositions resulting the most influential. As people who like diversity can distinguish  ethnic diversity of neighborhood from the concentration of people who share the same tastes and show independent appreciation for both [@blokland2010people;@clark2018can], so people who prefer ethnically concentrated neighborhood can consider an additional value to live close to other ethnically conservative people.






<!-- X -> this multidimensional homophily (Blok et al) has only rarely been considered in complexity models of segregation dynamics (few exceptions). We add to this line of research by proposing a new model that allows to assess how residential segregation patterns depend on the mix of preferences in a heterogeneous population. Unlike earlier models, we assume that everyone prefers both ethnic and value similarity, but different social groups in the population put different weight on each of the aspects of similarity. (in line with survey evidence?) -->


-> we study in this paper what are the consequences of this new form of preference heterogeneity in abm of residential segregation dynamics 
-> whether and under which conditions it can explain the empirical pattern of hybrid residential segregation ..

<!-- goog point -->>
 It can be noteworthy to extend the intuition of @paolillo2018 for different homophily preferences to the scenarios of heterogeneity as presented by @xie2012modeling and  @hatna2014combining and within the framework of discrete choice and linear utility function as in @bruch2009preferences which is consistent with utility maximization. 

<!-- goog point, empirical substain (last paragraph) -->>
In sum, in this paper we propose a Schelling-type agent-based model to identify possible mechanisms that can explain hybrid segregation in modern and diverse societies, i.e. the scenario where some members of the same ethnic group are ethnically integrated while others are ethnically segregated. We focus on a discrete choice model of homophily preferences for spatial sorting to explain such a scenario. We include similarity based on ethnic membership and on shared values towards ethnic diversity or ethnic conservatism.



<!-- In this paper we focus  on the possible mechanisms that underlying hybrid scenarios of residential segregation focusing on two factors, i.e. heterogeneity for ethnic preferences  within and between groups, and preferences for like-minded people who share the same conservative or integrationist attitudes. We advocate for usage of agent-based modeling and proceed by extending previous work on Schelling's model of residential segregation.--> 

<!-- Residential segregation can be defined as the unequal and non random distribution of people  belonging to different groups within the spatial units of a city [@bruch2009segregation;@clark2008understanding]. The interest of the social sciences on the topic is due the consequences it can have on the chance of interaction and integration between groups [@bolt2010linking], with exclusion of minorities in deprived neighborhoods and perpetuation of inequalities through generations [@van2012understanding]. A key research question in literature is on the dynamics of emergence of residential segregation.  -->


With a different focus of tolerance towards diversity, @paolillo2018 investigated the interaction of different homophily preferences in Schelling. Keeping threshold behavior as in the original model, they split the population into intolerant ethnic-oriented agents, defining similarity based on shared ethnicity, and tolerant value-oriented agents defining similarity on shared values for tolerance, and explored  their adaptation in different conditions of relative group sizes. The introduction of value-oriented agents decreased ethnic segregation compared to the original model. The main discover was a spillover effect for ethnicity-oriented agents in the minority condition who found attractive ethnically mixed neighborhoods formed by value-oriented agents, because of availability of ethnically similar ones, until the point that their concentration caused value-oriented to leave.


<!-- The expected advantage of this choice is on the consequences it can have on inner cohesion of groups together with the blurry of boundaries between groups. That is, we model scenarios where both intolerant ethnicity-oriented agents and tolerant value-oriented agents share ethnic preferences and value preferences at some degree. While ethnic preferences would consider as similar members of the same ethnic group despite their value-orientation, members of the same ethnic group with different values would be excluded from the value spatial sorting of agents, in favor of members of the out-group with similar values. We will impose as condition that ethnicity-oriented agents hold higher ethnic preferences than value preferences and vice versa for value-oriented agents. We include relative group sizes for both categories of agents as constraints to neighborhood composition and heterogeneity for both preferences within groups and between groups. Additionally, the case of a more conservative group over another can be included.
The contributions of the paper are that, compared to previous studies that focused on heterogeneous preferences for ethnic composition [@xie2012modeling:@hatna2014combining], the interplay of ethnicity and values introduced by @paolillo2018 may shed deeper insights on the continuum between integration and segregation at the spatial scale. Moreover, not only hybrid segregation would be explored, but also the new form of value segregation and its relation to ethnic segregation, which might serve to describe the sorting of people in diverse societies. The application of random utility models might facilitate the match with quantitative estimate parameters of preferences.-->


<!-- NO Out of many ethnic groups cohabiting in the same city, segregation might imply more than a binary definition between in-group/out-group and tolerance toward diversity become critical to social cohesion [@DragolovIgnaczea2016SocialCohesionin;@clark2018can; @vervoort2011ethnic].  Furthermore, people belong to many and overlapping categories [@roccas2002social] that can prevail that of ethnicity in defining residential preferences as well as similarity in spatial sorting [@van2019sociocultural]. --> 


<!-- NO In this paper, we focus on two concepts associated with ethnic segregation in diverse societies when considering relocation choice, i.e. heterogeneity in ethnic preferences, and preferences for other dimensions that can interact with ethnic membership. As for heterogeneity in preferences, it is intuitive that people of the same group might differ in their preferences [@hess2018revisiting], this can increase when other subdivisions as socio-economic class are taken into account [@bruch2014population;@friedman2019muslim].  As for different preferences that could interact with the dimension of ethnicity, the perspective of ethnic boundary making is relevant. This theoretical framework focuses on the dynamic and symbolic boundaries that distinguish between "us" and "them" [@bail2008configuration], built by individuals in the continuous and different forms of interaction between groups [@wimmer2013ethnic]. The core of ethnic boundary making is to understand how boundaries between in-group and out-group are socially constructed above the categories of ethnic membership, and not as a rigid consequence of them [@esser2010assimilation; @wimmer2013ethnic].  The overlap of these two preferences can have consequences on the different scenarios of segregation.--> 

# Theory: Modeling Discrete Choice in Schelling Framework

Fitting the homophily hypothesis, Schelling described a scenario where people stay  in a neighborhood as long as the proportion between similar ones and others is not less than a desired threshold, leaving to a random relocation otherwise  [@schelling1971;@schelling1969]. Given the spatial constraints to relocate, e.g. unavailability of empty places due to density of population, the interplay of people pursuing the same behavior can cause high level of segregation even for low thresholds. The original Schelling's model has received interest from scholars outside of computational methods due to its contribution to understanding segregation dynamics [@clark1991residential;@clark2008understanding], as well as numerous extensions and studies by complexity scholars. 

- utility function
- heterogeneity
- different preferences



We want to contribute to those studies focusing on random utility models for discrete choice in Schelling's dynamics and ethnically diverse scenarios. Simply stated, discrete choice models allow to deduce prerefernces in utility by observing the difference between neighoborhood chosen and alternative ones  [@train2009discrete;@frankhauser2016deciding]. Among regression models for the execution of random utility models, @mcfadden1973conditional's conditional logit allow to estimate the parameters of utility for different characteristics of neighborhoods ($\beta$ parameters) and sort them according to socio-demographic characteristics of movers [@boschman2015neighbourhood]. @zhang2004 was among the first to implement the conditional logit within Schelling's dynamics, although @bruch2006neighborhood moved forward by matching discrete choice of agents with parameters calculated from empirical data, along with a continuous linear function instead of Schelling's threshold. Despite pitfalls in the code implementation of their model [@van2009neighborhood] and consequent corrections [@bruch2009preferences], extensions resulted in agents being more sensitive to fine-grained change in neighborhood ethnic composition. Adopting a similar discrete choice method would benefit the chance of the model to disentangle the relative effect of different preferences. @xie2012modeling extended the model by @bruch2009preferences to reflect the heterogeneity in whites' tolerance towards blacks in US, both as categorical classes with different threshold preferences each, and continuous heterogenous preferences. In both cases heterogeneity between agents, and a class of agent indifferent to ethnic composition resulted in less segregated scenarios due to mutual adaptation of agents. Though not with discrete choice models,  @hatna2014combining focused on heterogenous preferences between groups, using an increasing linear function until the desired proportion, and dividing each ethnic group in two subgroups of agents more tolerant and less tolerant due to difference in ethnic threshold. 


Since we are focusing on a spatial sorting mechanism, relative group sizes remains a critical factor. @blau1977macrosociological defines relative group sizes as the structural conditions that can influence inter-ethnic relations, not matter what socio-psychological drivers guide such interactions. Minority groups are per definition more at risk of incorporation from the majority [@esser2010assimilation]. Considering the overlap category between ethnicity and taste for ethnic diversity, the concept of relative group size becomes much complex. For instance, a person might belong to the ethnic minority group, but to the majority of tolerant people in the broad society. Different distributions of people along the categories of ethnic membership and preferences for diversity/homogeneity is noteworthy.


<!--
```{r model, fig.pos ='h!',out.width='50%',out.height='90%',fig.show='hold',fig.align='center', fig.cap= "Draft of agents attribution and emerging segregations, to revise.",  echo = FALSE, include=TRUE}
knitr::include_graphics("C:/Users/rocpa/OneDrive/Desktop/AF/ethnic-value_multinomial/material/model_pr.jpg")
```
-->









# Model




The model^[The model can be found here:https://github.com/RoccoPaolillo/ethnic-value_multinomial.git] was built in NetLogo 6.1.0 and extends work by @paolillo2018.
Agents interact on a regular grid 51 times 51 with periodic boundary conditions (torus world). Each node of the grid can host 1 agent or being empty. Agents represents individuals who relocate and are  defined by two static and overlapping variables: ethnicity and value orientation. Ethnicity is modeled through color tag. Agents with blue color represent the local population, agents with orange color represent the minority group. Value orientation through shape tag. 

We define value orientation as the common membership of agents sharing same beliefs, preferences etc. potentially subject to change and independent of their attributed ethnicity. As such value orientation relates to value homophily compared to ethncity related to ascribed status homophily.
Each agent hold a preference for the ethnic composition and the value composition of each neighborhood.
Neighborhoods are defined as a Moore distance.
At each step, an agent randomly selected compares its current location to a number of alternative ones, calculates utility for each and decides which location they prefer.

$\beta^\Box_e \geq \beta^\circ_e$

# Experiments

Study 1: heterogeneity of ethnic preferences in agents \par
* 1.1 Tune $\beta_e$ for all agents, with condition $\beta^\Box_e \geq \beta^\circ_e$, no difference between agents
* 1.2 Change  $\beta_e$ between groups (supported by literature on which group is going to be more conservative, or anyway argumented).
Observe the emergence of ethnic segregation first
* Same conditions, increase $\beta_v$ Either with first 1.1 and then compar, either compare first the effect of ethnic preference heterogeneity between groups over within group
In both cases, the effect of relative group sizes

\vspace{10pt}

@hatna2014combining: in previous studies, they had a "F critical", maybe we could use on the critical $\beta$?

\vspace{10pt}



The concept of heterogeneity is reflected into the experiments: \par
* individual: $\beta^\Box_e \geq \beta^\Box_v$, $\beta^\circ_v \geq \beta^\circ_e$  \par
* within ethnic group:  $\beta^\Box_e \geq \beta^\circ_e$, $\beta^\circ_v \geq \beta^\Box_v$, should specify the ethnic group  \par
NO * between ethnic group: $\beta^{\Box B}_e \geq \beta^{\Box R}_e$ (and implying $\beta^{\Box B}_e \geq \beta^{\circ R}_e$  ) NO \par

These are the conditions kept in the experiments, ranging $\beta \in{0,10}$  \par

Think about it.

If a society is "conservative", the less ethnic-oriented of that society/scenario would have high level as well. In the end, you could narrow down so to have 3 conditions for each low, medium, high beta (e.g. 1, 5, 10), and calculate the $\beta_e$ of less ethnicity-oriented agents out of a ratio, e.g. min $n/n$,  $n/(n:2)$ (check), max $n/1$ \par
* 1 = 1,0.5,1 (check)
* 5 = 1,2.5,5
* 10 = 1,5,10

Dependent measure:

* ethnic segregation exposure as Schelling (color)
* value segregation exposure as Schelling (shape)
* C index in @hatna2012schelling, to check

**beta-binomial distribution? Discrete values deriving from beta distribution but not limit [0,1] @hatna2015combining** 

# Results

# Conclusions/ further ideas

@van2019sociocultural introduction: social homophily as due to preferences and constraints' approach. They also use social class as proxy for  socio-cultural differentiation


# References
